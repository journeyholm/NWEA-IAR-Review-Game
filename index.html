<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ELA Legends: Mastery Protocol</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;900&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'], mono: ['Space Grotesk', 'monospace'] },
                    animation: { 'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite' }
                }
            }
        }
    </script>

<style>
    /* 1. GLOBAL AESTHETICS */
    body {
        background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
        min-height: 100vh;
        overflow-x: hidden;
        color: #1e293b;
    }
    .dark body {
        background: radial-gradient(circle at 50% 0%, #1e1b4b 0%, #0f172a 100%);
        color: #f1f5f9;
    }
    
    /* 2. NOISE TEXTURE OVERLAY */
    .noise-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 0; opacity: 0.4;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.15'/%3E%3C/svg%3E");
    }

    /* 3. GLASSMORPHISM PANELS */
    .glass-panel {
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }
    .dark .glass-panel {
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.4);
    }

    /* 4. 3D BUTTONS */
    .btn-3d {
        transition: all 0.1s;
        position: relative;
        top: 0;
    }
    .btn-3d:active {
        top: 4px;
        box-shadow: none !important;
        transform: scale(0.98);
    }

    /* 5. ANIMATIONS */
    .animate-enter { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    
    /* 6. SCROLLBARS & TYPOGRAPHY */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    .dark ::-webkit-scrollbar-thumb { background: #475569; }
    
    #game-passage {
        font-family: 'Georgia', serif;
        font-size: 1.2rem;
        line-height: 1.8;
    }

    /* COMBO ANIMATIONS */
@keyframes firePulse {
    0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); transform: scale(1); }
    70% { box-shadow: 0 0 0 10px rgba(245, 158, 11, 0); transform: scale(1.05); }
    100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); transform: scale(1); }
}
.combo-active {
    animation: firePulse 2s infinite;
    border-color: #f59e0b !important; /* Amber color */
    background: #fffbeb !important;
}

/* BOSS HEALTH BAR ANIMATIONS */
        .boss-container {
            position: relative;
            background: #1e1b4b; /* Dark Navy */
            border: 4px solid #ef4444; /* Red Border */
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
            border-radius: 1rem;
            overflow: hidden;
            margin-bottom: 2rem;
        }
        .health-fill {
            height: 2.5rem;
            background: linear-gradient(90deg, #b91c1c 0%, #ef4444 100%);
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        .health-fill::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(0,0,0,0.1) 10px,
                rgba(0,0,0,0.1) 20px
            );
        }

        #sticker-grid {
            display: grid !important;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)) !important;
            gap: 1rem;
            width: 100%;
        }

        /* MOBILE OPTIMIZATIONS */
    * { 
        -webkit-tap-highlight-color: transparent; /* Removes the gray box when tapping */
        touch-action: manipulation; /* Removes the 300ms delay on clicks */
    }
    body { 
        overscroll-behavior-y: none; /* Stops the screen from bouncing on scroll */
        user-select: none; /* Prevents text highlighting */
        -webkit-user-select: none;
    }
    /* Re-enable text selection for specific areas if needed */
    .selectable-text { user-select: text; -webkit-user-select: text; }
</style>

</head>

<body class="transition-colors duration-300">

<div class="noise-overlay"></div>

<div id="welcome-screen" class="screen w-full min-h-screen flex flex-col items-center justify-center p-4 relative z-10">
    
    <div class="w-full max-w-6xl flex justify-between items-center mb-8 animate-enter">
        <div class="glass-panel rounded-full p-2 pr-6 flex items-center gap-4 hover:scale-105 transition-transform cursor-pointer" onclick="renderProfile()">
            <div id="player-avatar" class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-2xl shadow-lg border-2 border-white dark:border-slate-700">üßô‚Äç‚ôÇÔ∏è</div>
            <div class="flex flex-col leading-tight">
                <span class="text-[10px] font-black uppercase tracking-widest opacity-60">Rank</span>
                <span class="text-sm font-bold" id="main-level-display">Level 1</span>
            </div>
        </div>

        <div class="flex gap-3">
            <div class="glass-panel px-4 py-2 rounded-full flex items-center gap-2 border-2 border-amber-400/30">
                <span class="text-lg">üí∞</span>
                <span id="main-token-display" class="font-mono font-bold text-amber-600 dark:text-amber-400">0</span>
            </div>
            <button onclick="document.documentElement.classList.toggle('dark')" class="glass-panel w-10 h-10 rounded-full flex items-center justify-center hover:bg-white/50">üåì</button>
            <button onclick="showDirections()" class="glass-panel w-10 h-10 rounded-full flex items-center justify-center text-indigo-500 font-bold hover:bg-white/50">?</button>
        </div>
    </div>

    <div class="text-center mb-10 animate-enter">
        <h1 class="text-7xl md:text-9xl font-black mb-2 tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 drop-shadow-sm">
            ELA LEGENDS
        </h1>
        <p class="text-xl font-medium opacity-60 tracking-wide uppercase">Test Prep Readiness</p>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 w-full max-w-5xl animate-enter" style="animation-delay: 0.1s">
        
        <button id="start-calibration-button" class="btn-3d col-span-2 row-span-2 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-[2rem] p-8 text-left shadow-[0_8px_0_0_#1e40af] border-2 border-blue-400 group relative overflow-hidden">
            <div class="absolute right-[-20px] bottom-[-20px] text-9xl opacity-20 rotate-12 group-hover:rotate-0 transition-transform duration-500">üßô‚Äç‚ôÇÔ∏è</div>
            <div class="relative z-10 flex flex-col justify-between h-full">
                <div>
                    <span class="bg-white/20 px-2 py-1 rounded text-[10px] font-black uppercase tracking-widest">Start Here</span>
                    <h2 class="text-4xl font-black uppercase italic tracking-tighter mt-2">Calibration</h2>
                </div>
                <p class="font-medium opacity-90 text-sm">Diagnostic test to analyze skill & set rank.</p>
            </div>
        </button>

        <button id="missions-button" class="btn-3d col-span-2 bg-gradient-to-br from-emerald-500 to-teal-600 text-white rounded-[2rem] p-6 text-left shadow-[0_6px_0_0_#0f766e] border-2 border-emerald-400 group relative overflow-hidden">
            <div class="absolute right-[-10px] bottom-[-15px] text-8xl opacity-20 group-hover:scale-110 transition-transform">üìú</div>
            <h3 class="text-3xl font-black uppercase tracking-tight">Missions</h3>
            <p class="text-xs opacity-80 font-bold uppercase tracking-widest mt-1">Campaign Mode</p>
        </button>

        <button onclick="startSurvival()" class="btn-3d col-span-1 bg-gradient-to-br from-red-500 to-rose-600 text-white rounded-[2rem] p-4 flex flex-col justify-center items-center text-center shadow-[0_6px_0_0_#be123c] border-2 border-red-400 group">
            <span class="text-4xl mb-2 group-hover:animate-bounce">üíÄ</span>
            <span class="font-black uppercase text-sm tracking-tight">Gauntlet</span>
        </button>

        <button id="shop-button" class="btn-3d col-span-1 bg-gradient-to-br from-amber-400 to-orange-500 text-white rounded-[2rem] p-4 flex flex-col justify-center items-center text-center shadow-[0_6px_0_0_#c2410c] border-2 border-amber-300 group">
            <span class="text-4xl mb-2 group-hover:rotate-12 transition-transform">üõçÔ∏è</span>
            <span class="font-black uppercase text-sm tracking-tight">Shop</span>
        </button>

        <button id="progress-button" class="btn-3d col-span-1 bg-gradient-to-br from-violet-500 to-purple-600 text-white rounded-[2rem] p-4 flex flex-col justify-center items-center text-center shadow-[0_6px_0_0_#6d28d9] border-2 border-violet-400 group">
            <span class="text-4xl mb-2 group-hover:scale-110 transition-transform">üìí</span>
            <span class="font-black uppercase text-sm tracking-tight">Stickers</span>
        </button>

        <button onclick="openArchive()" class="btn-3d col-span-1 bg-gradient-to-br from-pink-500 to-rose-500 text-white rounded-[2rem] p-4 flex flex-col justify-center items-center text-center shadow-[0_6px_0_0_#be185d] border-2 border-pink-400 group">
            <span class="text-4xl mb-2 group-hover:animate-pulse">‚ö†Ô∏è</span>
            <span class="font-black uppercase text-sm tracking-tight">Glitches</span>
        </button>

        <button id="profile-button" class="btn-3d col-span-2 bg-white dark:bg-slate-800 text-slate-800 dark:text-white rounded-[2rem] p-6 flex items-center justify-between shadow-[0_6px_0_0_#94a3b8] dark:shadow-[0_6px_0_0_#020617] border-2 border-slate-200 dark:border-slate-700 group">
            <div class="text-left">
                <h3 class="text-xl font-black uppercase tracking-tight">Profile</h3>
                <p class="text-xs text-slate-400 font-bold uppercase tracking-widest mt-1">View Stats</p>
            </div>
            <div class="text-4xl group-hover:scale-110 transition-transform">üìä</div>
        </button>
    </div>
    
    <div class="mt-12">
        <button onclick="resetGame()" class="text-xs font-mono text-slate-400 hover:text-red-500 transition-colors uppercase tracking-widest">Reset System State</button>
    </div>
</div>

    <!-- Screen Containers -->
    <div id="calibration-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        <h2 class="text-3xl font-bold mb-8 text-center mt-12 text-gray-800 dark:text-white uppercase tracking-tighter">Diagnostic Calibration</h2>
        <div id="calibration-content" class="max-w-4xl mx-auto bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-xl">
            <div id="question-area"></div>
            <div class="flex justify-end mt-6">
                <button id="submit-answer-button" class="button bg-blue-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg uppercase tracking-widest">Analyze Protocol</button>
            </div>
        </div>
        <div id="calibration-results" class="hidden text-center mt-8">
            <h3 class="text-4xl font-bold text-green-600 mb-4 uppercase">Rank Attained!</h3>
            <p class="text-2xl mb-6 dark:text-white">Your Rank: <span id="ela-level-display" class="font-black text-indigo-600"></span></p>
            <button id="start-missions-button" class="button bg-green-500 text-white font-bold py-4 px-12 rounded-xl text-xl shadow-xl">Proceed to Mission Hub</button>
        </div>
    </div>

<div id="missions-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        
        <div class="max-w-6xl mx-auto mt-12">
            <h2 class="text-4xl font-black mb-2 text-center text-gray-800 dark:text-white uppercase">Campaign Map</h2>
            <p class="text-center text-gray-500 mb-8 font-bold">Select a Sector to view objectives.</p>

            <div class="flex overflow-x-auto space-x-4 mb-8 pb-4 justify-start md:justify-center px-4">
                <button onclick="switchZone(1)" id="zone-btn-1" class="flex-shrink-0 px-6 py-3 rounded-xl font-black uppercase tracking-widest transition-all bg-indigo-600 text-white shadow-lg shadow-indigo-500/30">Sector 1</button>
                <button onclick="switchZone(2)" id="zone-btn-2" class="flex-shrink-0 px-6 py-3 rounded-xl font-black uppercase tracking-widest transition-all bg-white dark:bg-gray-800 text-gray-400 border-2 border-transparent">Sector 2</button>
                <button onclick="switchZone(3)" id="zone-btn-3" class="flex-shrink-0 px-6 py-3 rounded-xl font-black uppercase tracking-widest transition-all bg-white dark:bg-gray-800 text-gray-400 border-2 border-transparent">Sector 3</button>
                <button onclick="switchZone(4)" id="zone-btn-4" class="flex-shrink-0 px-6 py-3 rounded-xl font-black uppercase tracking-widest transition-all bg-white dark:bg-gray-800 text-gray-400 border-2 border-transparent">Sector 4</button>
                <button onclick="switchZone(5)" id="zone-btn-5" class="flex-shrink-0 px-6 py-3 rounded-xl font-black uppercase tracking-widest transition-all bg-white dark:bg-gray-800 text-gray-400 border-2 border-transparent">The Core</button>
            </div>

            <div id="missions-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-12 animate-fade-in"></div>
        </div>
    </div>

    <div id="game-play-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 max-w-6xl mx-auto pt-12">
            <h2 id="game-title" class="text-2xl font-black text-gray-800 dark:text-white uppercase">Mission</h2>
            <div class="flex items-center gap-4">
                <div id="inventory-bar" class="flex gap-2"></div>
                <div class="bg-white dark:bg-gray-800 px-6 py-2 rounded-full shadow-lg border border-gray-100 dark:border-gray-700 flex items-center gap-6">
                    <span id="game-timer" class="font-mono font-bold text-indigo-600">00:00</span>
                    <span class="font-bold text-gray-700 dark:text-gray-300">Score: <span id="mission-score-display">0</span>/10</span>
                </div>
            </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-6xl mx-auto">
            <div id="game-passage" class="bg-white/80 dark:bg-gray-800/80 p-8 rounded-2xl shadow-xl border border-white/20 text-lg leading-relaxed font-serif overflow-y-auto max-h-[60vh]"></div>
            <div id="game-questions-area" class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-2xl border-t-8 border-indigo-500"></div>
        </div>
    </div>

    <div id="profile-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        <div class="max-w-5xl mx-auto mt-12">
            <div class="flex flex-col md:flex-row items-center gap-8 mb-12 bg-white/40 dark:bg-gray-800/40 p-8 rounded-3xl backdrop-blur-md border border-white/20 shadow-xl">
                <div id="profile-avatar" class="w-32 h-32 bg-white dark:bg-gray-700 rounded-3xl flex items-center justify-center text-6xl shadow-2xl border-4 border-indigo-500">üßô‚Äç‚ôÇÔ∏è</div>
                <div class="text-center md:text-left flex-1">
                    <h2 class="text-4xl font-black text-gray-800 dark:text-white uppercase tracking-tighter mb-1">Scholar Profile</h2>
                    <p class="text-xl text-indigo-600 dark:text-indigo-400 font-bold mb-4">Mastery Rank: <span id="profile-rank">Uncalibrated</span></p>
                    <div class="flex flex-wrap justify-center md:justify-start gap-3">
                        <div class="bg-white dark:bg-gray-800 px-4 py-2 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
                            <span class="text-[10px] text-gray-500 block uppercase font-bold tracking-widest">Total Tokens</span>
                            <span id="profile-tokens" class="text-xl font-black">0</span>
                        </div>
                        <div class="bg-white dark:bg-gray-800 px-4 py-2 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
                            <span class="text-[10px] text-gray-500 block uppercase font-bold tracking-widest">Protocol Level</span>
                            <span id="profile-level" class="text-xl font-black">1</span>
                        </div>
                        <div id="profile-accuracy-badge" class="bg-green-100 dark:bg-green-900/40 text-green-700 dark:text-green-300 px-4 py-2 rounded-xl border border-green-200">
                             <span class="text-[10px] block uppercase font-bold tracking-widest">Efficiency</span>
                             <span id="profile-accuracy" class="text-xl font-black">0%</span>
                        </div>
                    </div>
                </div>
                <button onclick="generateReport()" class="bg-indigo-600 text-white font-black px-8 py-4 rounded-2xl shadow-lg hover:bg-indigo-700 transition-all uppercase tracking-widest text-xs">Print Diagnostic Report</button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pb-10">
                <div class="stat-card p-6 rounded-3xl shadow-lg">
                    <h3 class="text-xl font-black mb-4 uppercase tracking-tighter dark:text-white">Standards Mastery</h3>
                    <div id="standards-grid" class="space-y-4"></div>
                </div>
                <div class="stat-card p-6 rounded-3xl shadow-lg">
                    <h3 class="text-xl font-black mb-4 uppercase tracking-tighter dark:text-white">Mission History</h3>
                    <div id="history-list" class="space-y-3 max-h-[400px] overflow-y-auto pr-2"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="sticker-book-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        <h2 class="text-4xl font-black mb-2 text-center mt-12 text-gray-800 dark:text-white uppercase tracking-tighter">Legendary Archive</h2>
        <p class="text-center text-gray-600 dark:text-gray-400 mb-8">Full collection acquired through mission mastery.</p>
        <div id="sticker-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 max-w-5xl mx-auto bg-white/20 p-8 rounded-3xl backdrop-blur-md"></div>
    </div>

    <div id="shop-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        <div class="max-w-5xl mx-auto mt-12">
            <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
                <div>
                    <h2 class="text-5xl font-black text-gray-800 dark:text-white uppercase">The Vault</h2>
                    <p class="text-gray-600 dark:text-gray-400 font-bold italic">restricted upgrades for high-level legends.</p>
                </div>
                <div class="bg-yellow-400 text-yellow-900 px-8 py-3 rounded-2xl font-black text-2xl shadow-lg flex items-center gap-3">
                    üí∞ <span id="shop-token-display">0</span>
                </div>
            </div>
            
            <div class="flex border-b border-gray-300 dark:border-gray-700 mb-8 overflow-x-auto whitespace-nowrap">
                <button onclick="switchShopTab('avatars')" id="tab-avatars" class="px-6 py-3 font-bold uppercase tracking-widest shop-tab-active">Avatars</button>
                <button onclick="switchShopTab('stickers')" id="tab-stickers" class="px-6 py-3 font-bold uppercase tracking-widest text-gray-500">Stickers</button>
                <button onclick="switchShopTab('items')" id="tab-items" class="px-6 py-3 font-bold uppercase tracking-widest text-gray-500">Items</button>
            </div>

            <div id="shop-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 pb-20"></div>
        </div>
    </div>

    <div id="archive-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        <h2 class="text-3xl font-bold mb-2 text-red-600 text-center mt-12 uppercase tracking-tighter">System Glitches</h2>
        <div id="archive-list" class="max-w-3xl mx-auto space-y-6"></div>
        <div id="archive-empty-msg" class="hidden text-center mt-12 bg-white/40 p-12 rounded-2xl border-2 border-dashed border-white">
            <span class="text-6xl mb-4 block">‚ú®</span>
            <h3 class="text-2xl font-bold">System Integrity: 100%</h3>
            <p class="text-gray-600">No logical discrepancies detected in the protocol memory.</p>
        </div>
    </div>

    <!-- Modals -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black/60 flex items-center justify-center p-4 hidden z-[100] backdrop-blur-sm">
        <div id="modal-box" class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-md w-full text-center border-t-8 transition-all duration-300 scale-100">
            <h3 id="modal-title" class="text-2xl font-black mb-4 dark:text-white uppercase tracking-tighter"></h3>
            <p id="modal-message" class="text-gray-700 dark:text-gray-300 mb-6 leading-relaxed"></p>
            <button id="modal-ok-btn" class="button bg-indigo-600 text-white font-bold py-3 px-12 rounded-xl shadow-lg uppercase tracking-widest text-xs">Verify Data</button>
        </div>
    </div>

    <script>
let gameState = {
    currentScreen: 'welcome',
    currentZone: 1,
    currentMission: null,
    currentQuestionIndex: 0,
    missionScore: 0,
    consecutiveCorrect: 0,
    currentShopTab: 'avatars',
    survivalQueue: [],
    missionAnswers: {}, // Stores answers for review
    user: {
        xp: 0, level: 1, elaLevel: 1, tokens: 0, history: [],
        missedQuestions: [], stickers: [], avatars: ['a1', 'a2', 'a3'], // Default owned avatars 
        inventory: { lens: 0, freezer: 0, shield: 0 },
        standardsReport: {},
        completedIds: [],
        missionBestScores: {} // <--- ADD THIS NEW LINE HERE
    }
};

// --- NEW DIRECTIONS & STANDARDS SYSTEM ---

// 1. Logic to switch tabs inside the modal
window.switchGuideTab = function(tabName) {
    // Hide all contents
    document.getElementById('guide-tab-content-play').classList.add('hidden');
    document.getElementById('guide-tab-content-standards').classList.add('hidden');
    
    // Reset buttons
    document.getElementById('guide-btn-play').className = "flex-1 py-2 text-gray-500 border-b-2 border-transparent font-bold hover:text-indigo-500";
    document.getElementById('guide-btn-standards').className = "flex-1 py-2 text-gray-500 border-b-2 border-transparent font-bold hover:text-indigo-500";

    // Activate selected
    document.getElementById(`guide-tab-content-${tabName}`).classList.remove('hidden');
    document.getElementById(`guide-btn-${tabName}`).className = "flex-1 py-2 text-indigo-600 border-b-4 border-indigo-600 font-black uppercase tracking-widest";
};

// 2. The Main Function
function showDirections() {
    // Generate Standards List Dynamically from your allMissions array
    let standardsHtml = '<div class="space-y-4 text-left h-64 overflow-y-auto pr-2">';
    
    // Group by Level (Sector)
    for (let level = 1; level <= 5; level++) {
        const sectorMissions = allMissions.filter(m => m.minLevel === level);
        if (sectorMissions.length > 0) {
            let sectorName = level === 1 ? "Foundations" : (level === 2 ? "Intermediate" : (level === 3 ? "Advanced" : (level === 4 ? "Mastery" : "The Core")));
            
            standardsHtml += `
                <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-xl">
                    <h4 class="font-black text-indigo-600 dark:text-indigo-300 uppercase text-xs mb-2">Sector ${level}: ${sectorName}</h4>
                    <ul class="space-y-2">
            `;
            
            sectorMissions.forEach(m => {
                // Split description to get Standard ID (e.g., "RL.8.1")
                const parts = m.description.split(':');
                const stdId = parts[0] || "Gen";
                const desc = parts[1] || m.description;
                
                standardsHtml += `
                    <li class="text-xs flex justify-between items-center border-b border-gray-200 dark:border-gray-600 pb-1 last:border-0">
                        <span class="font-bold text-gray-700 dark:text-gray-200">${m.title}</span>
                        <span class="bg-white dark:bg-gray-800 px-2 py-0.5 rounded border text-[10px] font-mono">${stdId}</span>
                    </li>`;
            });
            
            standardsHtml += `</ul></div>`;
        }
    }
    standardsHtml += '</div>';

    // Build the Modal Content with Tabs
    const msg = `
        <div class="w-full">
            <div class="flex border-b border-gray-200 dark:border-gray-700 mb-4">
                <button id="guide-btn-play" onclick="switchGuideTab('play')" class="flex-1 py-2 text-indigo-600 border-b-4 border-indigo-600 font-black uppercase tracking-widest">How to Play</button>
                <button id="guide-btn-standards" onclick="switchGuideTab('standards')" class="flex-1 py-2 text-gray-500 border-b-2 border-transparent font-bold hover:text-indigo-500">Standards Map</button>
            </div>

            <div id="guide-tab-content-play" class="text-left space-y-3 text-sm h-64 overflow-y-auto pr-2">
                <p><b>üéØ Purpose:</b> Master Grade 8 Standards to defeat the "System Glitch" and fill your Sticker Book.</p>
                <hr class="border-gray-100 dark:border-gray-700">
                <div class="grid grid-cols-1 gap-2">
                    <div class="bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg border border-blue-100">
                        <span class="font-bold text-blue-700 dark:text-blue-300">üßô‚Äç‚ôÇÔ∏è Calibration</span>
                        <p class="text-xs mt-1">Take this diagnostic test first! It analyzes your skill level and assigns you a Rank.</p>
                    </div>
                    <div class="bg-green-50 dark:bg-green-900/20 p-2 rounded-lg border border-green-100">
                        <span class="font-bold text-green-700 dark:text-green-300">üìú Missions</span>
                        <p class="text-xs mt-1">Travel through 5 Sectors. Each mission targets a specific skill (Reading, Writing, Research).</p>
                    </div>
                    <div class="bg-red-50 dark:bg-red-900/20 p-2 rounded-lg border border-red-100">
                        <span class="font-bold text-red-700 dark:text-red-300">üíÄ The Gauntlet</span>
                        <p class="text-xs mt-1">Survival mode. Answer random questions until you miss one. High risk, high XP rewards.</p>
                    </div>
                    <div class="bg-pink-50 dark:bg-pink-900/20 p-2 rounded-lg border border-pink-100">
                        <span class="font-bold text-pink-700 dark:text-pink-300">‚ö†Ô∏è Glitch Archive</span>
                        <p class="text-xs mt-1">Review your mistakes. Fix the "glitch" to regain lost points.</p>
                    </div>
                </div>
            </div>

            <div id="guide-tab-content-standards" class="hidden">
                ${standardsHtml}
            </div>
        </div>
    `;
    
    showModal("System Database", msg, 'info');
}

const shopCatalog = {
        avatars: [
            // SYSTEM THEMED (The "Serious" ones)
            { id: 'a1', name: 'The Glitch', icon: 'üëæ', cost: 500, type: 'avatar' },
            { id: 'a2', name: 'Cyber Punk', icon: 'ü§ñ', cost: 300, type: 'avatar' },
            { id: 'a3', name: 'The Brain', icon: 'üß†', cost: 250, type: 'avatar' },
            
            // FANTASY & FUN (The "Fun" ones)
            { id: 'a4', name: 'Wizard', icon: 'üßô‚Äç‚ôÇÔ∏è', cost: 200, type: 'avatar' },
            { id: 'a5', name: 'Ninja', icon: 'ü•∑', cost: 200, type: 'avatar' },
            { id: 'a6', name: 'Royalty', icon: 'üëë', cost: 1000, type: 'avatar' },
            { id: 'a7', name: 'Detective', icon: 'üïµÔ∏è', cost: 150, type: 'avatar' },
            { id: 'a8', name: 'Artist', icon: 'üé®', cost: 150, type: 'avatar' },
            
            // ANIMALS
            { id: 'a9', name: 'Cool Cat', icon: 'üòº', cost: 100, type: 'avatar' },
            { id: 'a10', name: 'Panda', icon: 'üêº', cost: 100, type: 'avatar' },
            { id: 'a11', name: 'Dragon', icon: 'üê≤', cost: 500, type: 'avatar' },
            { id: 'a12', name: 'Ghost', icon: 'üëª', cost: 300, type: 'avatar' }
        ],
        stickers: [
            // SPECIALS
            { id: 's1', name: 'Mystery Crate', icon: '‚ùì', cost: 200, type: 'crate', description: 'Contains 1 Random Rare Sticker' },
            { id: 's_rare', name: 'The Diamond', icon: 'üíé', cost: 1000, type: 'sticker' },
            { id: 's_trophy', name: 'Gold Cup', icon: 'üèÜ', cost: 800, type: 'sticker' },

            // RETRO & TECH
            { id: 's2', name: 'Holo-Disk', icon: 'üíø', cost: 100, type: 'sticker' },
            { id: 's3', name: 'Retro Game', icon: 'üïπÔ∏è', cost: 150, type: 'sticker' },
            { id: 's4', name: 'Controller', icon: 'üéÆ', cost: 150, type: 'sticker' },
            { id: 's5', name: 'Headphones', icon: 'üéß', cost: 100, type: 'sticker' },
            
            // FOOD COURT
            { id: 's6', name: 'Pizza Slice', icon: 'üçï', cost: 50, type: 'sticker' },
            { id: 's7', name: 'Burger', icon: 'üçî', cost: 50, type: 'sticker' },
            { id: 's8', name: 'Donut', icon: 'üç©', cost: 50, type: 'sticker' },
            { id: 's9', name: 'Taco', icon: 'üåÆ', cost: 50, type: 'sticker' },
            { id: 's10', name: 'Ice Cream', icon: 'üç¶', cost: 75, type: 'sticker' },

            // RANDOM FUN
            { id: 's11', name: 'Cool Cat', icon: 'üòé', cost: 125, type: 'sticker' },
            { id: 's12', name: 'Alien Head', icon: 'üëΩ', cost: 300, type: 'sticker' },
            { id: 's13', name: 'Unicorn', icon: 'ü¶Ñ', cost: 400, type: 'sticker' },
            { id: 's14', name: 'Rainbow', icon: 'üåà', cost: 100, type: 'sticker' },
            { id: 's15', name: 'Fire', icon: 'üî•', cost: 200, type: 'sticker' }
        ],
        items: [
            { id: 'i1', name: 'Focus Lens', icon: 'üîç', cost: 50, type: 'consumable', key: 'lens', description: 'Removes 2 wrong answers' },
            { id: 'i2', name: 'Time Freeze', icon: '‚ùÑÔ∏è', cost: 75, type: 'consumable', key: 'freezer', description: 'Resets the question timer' },
            { id: 'i3', name: 'Logic Shield', icon: 'üõ°Ô∏è', cost: 100, type: 'consumable', key: 'shield', description: 'Blocks one wrong answer penalty' }
        ]
    };

const itemBank = [
    // =================================================================
    // SECTION 1: EXPANDED LITERARY TEXTS (Updated with Micro-Lessons)
    // =================================================================
    { 
        id: 'rok-lit-confetti', 
        passage: `<h3 class="text-xl font-bold mb-2">The Dinner Experiment (Full Excerpt)</h3>
        <p class="mb-4"><b>1</b> Mom always had after-school projects waiting for me. "Can you help me with these vocabulary flash cards?" she‚Äôd ask, or "Let's organize the spice rack alphabetically." But since she passed, it‚Äôs just Dad and me. And Dad‚Äôs projects are‚Ä¶ different.</p>
        <p class="mb-4"><b>2</b> Tonight, he stood at the stove, humming off-key. He wore his "Kiss the Cook" apron, which was stained with three distinct shades of tomato sauce. "Tonight," he announced, waving a wooden spoon like a scepter, "we are having <i>Pasta √† la Dad</i>." He beamed at me, eyes crinkling behind his glasses. "And while we eat, we can review your vocabulary words for the SATs. I found my old study guide in the basement. It‚Äôs vintage!"</p>
        <p class="mb-4"><b>3</b> I stared at the book he had placed next to my plate. The cover was torn, and the pages smelled of mildew. "Dad, I‚Äôm in eighth grade. I don't take the SATs for three years."</p>
        <p class="mb-4"><b>4</b> "Never too early to prepare!" he chirped. He tapped the book. "Let's start with a good one. <i>Superfluous</i>. Adjective. Exceeding what is sufficient or necessary. Extra."</p>
        <p class="mb-4"><b>5</b> "Like the cheese on this pasta?" I mumbled.</p>
        <p class="mb-4"><b>6</b> "Ha! Good one. But no." He turned serious, abandoning the sauce. "Your mother‚Ä¶ she loved words. She wanted you to have all the words." He looked at me, really looked at me, and for a second, the goofy 'Dad' mask slipped, revealing the tired, lonely man underneath. "I‚Äôm just trying to keep that going, honey."</p>
        <p class="mb-4"><b>7</b> I felt a sharp pang in my chest. I looked at the congealed pasta. I looked at his hopeful face. But the anger was there, too‚Äîanger that he turned every dinner into a lesson, every silence into a quiz. It was exhausting being his project.</p>
        <p class="mb-4"><b>8</b> "I'm not hungry," I said, pushing my chair back. </p>
        <p class="mb-4"><b>9</b> "Vanessa, sit down," he said, his voice dropping that 'teacher' tone. "We need to eat. We need to talk."</p>
        <p class="mb-4"><b>10</b> "I have homework," I lied. Deliberately, I picked up his precious vocabulary book. I didn't open it. I didn't read the definition. I placed it squarely on my nightstand, picked up my glass of sweating ice water, and set it right on top of the cover. I used it as a coaster. The condensation pooled at the base of the glass, forming a perfect, damp ring on the cardboard.</p>
        <p class="mb-4"><b>11</b> Dad didn't notice. He was too busy searching the cabinets for the parmesan cheese, humming that terrible song again, lost in his own world of words.</p>`, 
        items: [
            { id: 'c1', stem: "<b>Part A:</b> What is the narrator's primary conflict with her father?", options: ["She feels he prioritizes academic achievement over emotional connection.", "She hates his cooking.", "She wants to study math instead of vocabulary.", "She is angry about the dirty apron."], correct_answer: "She feels he prioritizes academic achievement over emotional connection.", rationale: "<b>Lesson: Analyzing Conflict.</b> Conflict isn't just fighting; it's a mismatch of desires. He wants to teach; she wants to be understood. When identifying conflict, ask: 'What does Character A want that Character B is not giving?'", standard: "RL.8.3", difficulty: 4 },
            { id: 'c2', stem: "<b>Part B:</b> Which paragraph best supports the answer to Part A?", options: ["Paragraph 7 ('...anger that he turned every dinner into a lesson...')", "Paragraph 2", "Paragraph 11", "Paragraph 4"], correct_answer: "Paragraph 7 ('...anger that he turned every dinner into a lesson...')", rationale: "<b>Lesson: Citing Evidence.</b> You identified the conflict in Part A; now prove it. Paragraph 7 explicitly states her anger comes from him turning dinner (a time for connection) into a lesson. Always match the <i>emotion</i> in the evidence to the <i>claim</i> in your answer.", standard: "RL.8.1", difficulty: 3 },
            { id: 'c3', stem: "How does the author use the word <i>superfluous</i> in the text?", options: ["Ironically, to highlight the unnecessary pressure the father places on the narrator.", "To show that the pasta has too much sauce.", "To teach the reader a new word.", "To show the father is smart."], correct_answer: "Ironically, to highlight the unnecessary pressure the father places on the narrator.", rationale: "<b>Lesson: Tone & Irony.</b> 'Superfluous' means extra or unnecessary. The dad thinks the SAT words are essential, but to the narrator, the <i>lesson itself</i> is superfluous. The author uses the word to highlight this gap in their perspectives.", standard: "RL.8.4", difficulty: 6 },
            { id: 'c4', stem: "The narrator's action of using the book as a coaster (Paragraph 10) can best be described as:", options: ["Passive-aggressive defiance.", "Careless accident.", "Helpful cleaning.", "Scientific experiment."], correct_answer: "Passive-aggressive defiance.", rationale: "<b>Lesson: Character Motivation.</b> Actions speak louder than words. She doesn't yell at him; she ruins his book <i>deliberately</i> but quietly. This is the definition of passive-aggressive behavior‚Äîexpressing anger indirectly.", standard: "RL.8.3", difficulty: 5 },
            { id: 'c5', stem: "In Paragraph 6, the 'Dad mask' slipping reveals:", options: ["His grief and vulnerability.", "His anger.", "His happiness.", "His face paint."], correct_answer: "His grief and vulnerability.", rationale: "<b>Lesson: Inference.</b> When a 'mask slips,' it reveals the character's true internal state. The text describes him as 'tired and lonely,' which points to grief over the mother's death. Good readers look for these brief moments of honesty.", standard: "RL.8.6", difficulty: 5 }
        ]
    },
    { 
        id: 'rok-lit-tortilla', 
        passage: `<h3 class="text-xl font-bold mb-2">The Chisel and the Map</h3>
        <p class="mb-4"><b>1</b> I found Mom in the kitchen, attacking a block of ice with a chisel. <i>Whack. Whack.</i> Ice chips flew across the linoleum like shrapnel, glinting under the harsh fluorescent light. It wasn't the behavior of someone making a smoothie; it was the behavior of someone demolishing a wall. Her shoulders were tense, her movements jagged and angry.</p>
        <p class="mb-4"><b>2</b> "I'm going to Costa Rica," she said, not looking up. The chisel slipped and gouged the counter, leaving a white scar on the laminate. "For the research grant. They finally approved it. I leave on Tuesday."</p>
        <p class="mb-4"><b>3</b> The words hung in the air, heavy and strange. I stood in the doorway, my backpack sliding off my shoulder. I rolled the words around in my mind: <i>Costa Rica. Research. Leaving.</i> They felt like marbles in my mouth‚Äîhard, cold, and impossible to swallow. This wasn't just a trip; it was an abandonment.</p>
        <p class="mb-4"><b>4</b> "For how long?" I asked. My voice sounded small, like a lost balloon drifting helplessly toward a spinning ceiling fan.</p>
        <p class="mb-4"><b>5</b> "Three months. Maybe four." She finally set the chisel down and turned to me. Her eyes were bright, too bright‚Äîmanic with an excitement I couldn't share. "It‚Äôs for the better, Izzy. This is the break I‚Äôve been waiting for. You can stay with Nana. She loves having you."</p>
        <p class="mb-4"><b>6</b> <i>For the better.</i> Adults always said that when they were blowing up your life. I looked at the map magnet-clipped to the fridge, at the tiny jagged line of Central America. It looked fragile, like a thread that was about to snap under the weight of her ambition.</p>`, 
        items: [
            { id: 't1', stem: "In Paragraph 4, the simile 'like a lost balloon' suggests the narrator feels:", options: ["Untethered, powerless, and vulnerable.", "Happy and light.", "Full of hot air.", "Colorful and bright."], correct_answer: "Untethered, powerless, and vulnerable.", rationale: "<b>Lesson: Figurative Language.</b> A balloon without a string drifts aimlessly and is easily popped (the fan). This simile perfectly captures the narrator's feeling of having no control over her situation.", standard: "RL.8.4", difficulty: 4 },
            { id: 't2', stem: "<b>Part A:</b> How does the narrator react to the news?", options: ["She processes it slowly and feels a sense of betrayal.", "She screams in anger.", "She helps chop the ice.", "She packs her bags immediately."], correct_answer: "She processes it slowly and feels a sense of betrayal.", rationale: "<b>Lesson: Analyzing Reactions.</b> Look at the verbs: she 'rolled the words around,' they felt 'hard' and 'impossible.' She defines the trip not as an opportunity, but as 'abandonment.' This indicates slow processing and betrayal.", standard: "RL.8.1", difficulty: 6 },
            { id: 't3', stem: "<b>Part B:</b> Which phrase supports the answer to Part A?", options: ["'They felt like marbles in my mouth... impossible to swallow.'", "'I found Mom in the kitchen.'", "'Three months.'", "'For the research grant.'"], correct_answer: "'They felt like marbles in my mouth... impossible to swallow.'", rationale: "<b>Lesson: Supporting Evidence.</b> This sensory detail describes the physical sensation of being unable to accept (swallow) the news. It matches the 'slow processing' identified in Part A.", standard: "RL.8.1", difficulty: 5 },
            { id: 't5', stem: "The phrase 'For the better' in Paragraph 6 is viewed by the narrator with:", options: ["Cynicism and bitterness.", "Hope and joy.", "Confusion.", "Scientific interest."], correct_answer: "Cynicism and bitterness.", rationale: "<b>Lesson: Point of View.</b> The narrator says, 'Adults always said that when they were blowing up your life.' This shows she doesn't believe the phrase; she is cynical about adult justifications for bad news.", standard: "RL.8.6", difficulty: 5 },
            { id: 't7', stem: "The 'thread that was about to snap' (Paragraph 6) serves as a metaphor for:", options: ["The fragility of the mother-daughter relationship.", "The map falling off the fridge.", "Sewing clothes.", "The flight path."], correct_answer: "The fragility of the mother-daughter relationship.", rationale: "<b>Lesson: Metaphor.</b> While she is literally looking at the map, the context is her mother leaving her. The 'thread' represents the thin, fragile connection keeping them together, which is about to break.", standard: "RL.8.4", difficulty: 6 }
        ]
    },
    {
        id: 'lit-poe-heart',
        passage: `<h3 class="text-xl font-bold mb-2">The Tell-Tale Heart (Enhanced)</h3>
        <p class="mb-4"><b>1</b> True! --nervous --very, very dreadfully nervous I had been and am; but why will you say that I am mad? The disease had sharpened my senses --not destroyed --not dulled them. Above all was the sense of hearing acute. I heard all things in the heaven and in the earth. I heard many things in hell. How, then, am I mad? Hearken! and observe how healthily --how calmly I can tell you the whole story.</p>
        <p class="mb-4"><b>2</b> It is impossible to say how first the idea entered my brain; but once conceived, it haunted me day and night. Object there was none. Passion there was none. I loved the old man. He had never wronged me. He had never given me insult. For his gold I had no desire. I think it was his eye! yes, it was this! He had the eye of a vulture --a pale blue eye, with a film over it. Whenever it fell upon me, my blood ran cold; and so by degrees --very gradually --I made up my mind to take the life of the old man, and thus rid myself of the eye forever.</p>
        <p class="mb-4"><b>3</b> Now this is the point. You fancy me mad. Madmen know nothing. But you should have seen me. You should have seen how wisely I proceeded --with what caution --with what foresight --with what dissimulation I went to work!</p>`,
        items: [
            { id: 'p1', stem: "What is the narrator's primary purpose in the opening paragraph?", options: ["To convince the reader (or listener) that he is sane.", "To confess to the police.", "To brag about the gold.", "To scare the reader."], correct_answer: "To convince the reader (or listener) that he is sane.", rationale: "<b>Lesson: Author's Purpose.</b> The narrator asks, 'Why will you say that I am mad?' and insists he can tell the story 'healthily' and 'calmly.' His goal is to defend his sanity against the accusation of madness.", standard: "RL.8.3", difficulty: 4 },
            { id: 'p3', stem: "The repetition of 'very, very' and the frequent use of dashes (-) creates a tone of:", options: ["Agitated intensity and instability.", "Calm reflection.", "Sadness.", "Boredom."], correct_answer: "Agitated intensity and instability.", rationale: "<b>Lesson: Syntax & Tone.</b> Syntax is the way sentences are built. Broken sentences, dashes, and repetition mimic a racing heartbeat or a stutter. This structure physically shows the reader his unstable mental state.", standard: "RL.8.4", difficulty: 6 },
            { id: 'p5', stem: "<b>Part A:</b> Is the narrator reliable?", options: ["No, he admits to hearing things in 'hell' and is fixated on an eye.", "Yes, he tells the story calmly.", "Yes, he loved the old man.", "No, he is too young."], correct_answer: "No, he admits to hearing things in 'hell' and is fixated on an eye.", rationale: "<b>Lesson: Unreliable Narrator.</b> A narrator is unreliable if their perception of reality is flawed. Hallucinations (hearing things in hell) and obsession with an eye are proof that we cannot trust his version of events.", standard: "RL.8.3", difficulty: 7 },
            { id: 'p6', stem: "<b>Part B:</b> Which quote supports the answer to Part A?", options: ["'I heard many things in hell.'", "'I loved the old man.'", "'Observe how healthily.'", "'For his gold I had no desire.'"], correct_answer: "'I heard many things in hell.'", rationale: "<b>Lesson: Evidence.</b> Claims of hearing sounds from 'hell' are impossible in reality. This is direct textual evidence of his delusion and unreliability.", standard: "RL.8.1", difficulty: 5 },
            { id: 'p10', stem: "Theme:", options: ["Obsession and guilt can fracture a person's reality.", "Eyes are scary.", "Old men are rich.", "Doctors are helpful."], correct_answer: "Obsession and guilt can fracture a person's reality.", rationale: "<b>Lesson: Determining Theme.</b> A theme is a universal truth, not a specific detail. The story isn't just about an eye; it's about how the narrator's obsession breaks his mind. Theme = Subject + Opinion.", standard: "RL.8.2", difficulty: 8 }
        ]
    },
    {
        id: 'lit-jackson-lottery',
        passage: `<h3 class="text-xl font-bold mb-2">The Lottery (Enhanced)</h3>
        <p class="mb-4"><b>1</b> The morning of June 27th was clear and sunny, with the fresh warmth of a full-summer day; the flowers were blossoming profusely and the grass was richly green. The people of the village began to gather in the square, between the post office and the bank, around ten o'clock; in some towns there were so many people that the lottery took two days and had to be started on June 26th.</p>
        <p class="mb-4"><b>2</b> The children assembled first, of course. School was recently over for the summer, and the feeling of liberty sat uneasily on most of them; they tended to gather together quietly for a while before they broke into boisterous play. Bobby Martin had already stuffed his pockets full of stones, and the other boys soon followed his example, selecting the smoothest and roundest stones.</p>
        <p class="mb-4"><b>3</b> The lottery was conducted--as were the square dances, the teen club, the Halloween program--by Mr. Summers, who had time and energy to devote to civic activities. He was a round-faced, jovial man and he ran the coal business, and people were sorry for him because he had no children and his wife was a scold.</p>`,
        items: [
            { id: 'lot1', stem: "The setting description ('clear and sunny', 'flowers') serves to:", options: ["Create a false sense of peace that contrasts with the violence.", "Create a scary mood immediately.", "Show that the author likes flowers.", "Describe a winter scene."], correct_answer: "Create a false sense of peace that contrasts with the violence.", rationale: "<b>Lesson: Juxtaposition.</b> The author places a beautiful, sunny setting next to a violent event. This contrast creates shock. If the setting were dark and stormy, the ending wouldn't be as surprising.", standard: "RL.8.6", difficulty: 6 },
            { id: 'lot2', stem: "The mention of 'stones' in Paragraph 2 is an example of:", options: ["Foreshadowing.", "Flashback.", "Metaphor.", "Simile."], correct_answer: "Foreshadowing.", rationale: "<b>Lesson: Foreshadowing.</b> Foreshadowing gives the reader a hint of what is to come. The boys gathering stones seems like play, but it hints at the weapon used for the execution at the end.", standard: "RL.8.5", difficulty: 5 },
            { id: 'lot9', stem: "In this story, the word 'Lottery' is an example of Situational Irony because:", options: ["It usually implies winning a prize, but here it implies selection for death.", "It is played with stones.", "It happens in summer.", "Mr. Summers runs it."], correct_answer: "It usually implies winning a prize, but here it implies selection for death.", rationale: "<b>Lesson: Situational Irony.</b> This occurs when the outcome is the opposite of what is expected. We expect a lottery to be good (money, prizes). In this village, 'winning' means death. That reversal is the irony.", standard: "RL.8.6", difficulty: 3 },
            { id: 'lot8', stem: "The fact that the boys gather stones implies that the violence is:", options: ["Normalized and learned at an early age.", "A surprise to everyone.", "An accident.", "Self-defense."], correct_answer: "Normalized and learned at an early age.", rationale: "<b>Lesson: Cultural Context.</b> If children treat gathering weapons as a game or a chore, it shows the society has completely accepted the violence. It is part of their normal upbringing.", standard: "RL.8.3", difficulty: 7 }
        ]
    },
    {
        id: 'lit-jacobs-paw',
        passage: `<h3 class="text-xl font-bold mb-2">The Monkey's Paw (Excerpt)</h3><p class="mb-4">"To look at," said the Sergeant-Major, fumbling in his pocket, "it's just an ordinary little paw, dried to a mummy."</p><p class="mb-4">He took the paw, and dangling it between his forefinger and thumb, suddenly threw it upon the fire. White, with a slight cry, stooped down and snatched it off.</p><p class="mb-4">"Better let it burn," said the soldier solemnly.</p><p class="mb-4">"If you don't want it, Morris," said the other, "give it to me."</p><p class="mb-4">"I won't," said his friend doggedly. "I threw it on the fire. If you keep it, don't blame me for what happens. Pitch it on the fire again like a sensible man."</p>`,
        items: [
            { id: 'mp1', stem: "<b>Part A:</b> What does the Sergeant-Major's action of throwing the paw reveal?", options: ["He believes the object is dangerous.", "He is cold.", "He dislikes monkeys.", "It was an accident."], correct_answer: "He believes the object is dangerous.", rationale: "<b>Lesson: Indirect Characterization.</b> The author doesn't say 'Morris was scared.' He shows Morris <i>destroying</i> the object. Actions often reveal a character's true beliefs more than their words.", standard: "RL.8.3", difficulty: 3 },
            { id: 'mp2', stem: "<b>Part B:</b> Which quote supports this?", options: ["'Better let it burn... don't blame me for what happens.'", "'Give it to me.'", "'Ordinary little paw.'", "'Fumbling in his pocket.'"], correct_answer: "'Better let it burn... don't blame me for what happens.'", rationale: "<b>Lesson: Evidence.</b> This quote contains an explicit warning. It connects the action (burning) to the motivation (preventing harm).", standard: "RL.8.1", difficulty: 4 },
            { id: 'mp3', stem: "Mr. White's action of 'snatching' the paw suggests he is:", options: ["Curious and reckless.", "Fearful.", "Helpful.", "Angry."], correct_answer: "Curious and reckless.", rationale: "<b>Lesson: Character Foil.</b> Morris tries to burn it; White saves it. This contrast highlights White's recklessness. He ignores the warning because he is tempted by the power.", standard: "RL.8.3", difficulty: 5 },
            { id: 'mp10', stem: "Genre classification:", options: ["Horror/Suspense", "Comedy", "Romance", "Biography"], correct_answer: "Horror/Suspense", rationale: "<b>Lesson: Genre Elements.</b> The ominous warnings ('don't blame me'), the supernatural object (mummy paw), and the sense of dread are hallmarks of the Horror and Suspense genres.", standard: "RL.8.9", difficulty: 2 }
        ]
    },
    {
        id: 'bio-strayed-wild',
        passage: `<h3 class="text-xl font-bold mb-2">Wild (Enhanced Excerpt)</h3>
        <p class="mb-4"><b>1</b> I gasped when I saw it. My boot... It was gone. It had tumbled off the side of the mountain. I looked down, my heart thumping in my throat. The boot was floating away, bobbing in the white water of the river far below. It was moving fast, disappearing into the foam.</p>
        <p class="mb-4"><b>2</b> I stood there with one boot on, clutching its mate to my chest. It was a heavy leather hiking boot, expensive and broken in perfectly. But without the other one, it was just a weight. A useless anchor.</p>
        <p class="mb-4"><b>3</b> A surge of rage and clarity hit me. I lifted the remaining boot high in the air and threw it too. I watched it arc through the sky and plummet into the trees. They had to be together. If I couldn't have them, the mountain could.</p>`,
        items: [
            { id: 'wild1', stem: "<b>Part A:</b> Why did the narrator throw the second boot?", options: ["It was useless without the other, and the act was a release of frustration.", "She slipped.", "She wanted to litter.", "She was trying to hit a bird."], correct_answer: "It was useless without the other, and the act was a release of frustration.", rationale: "<b>Lesson: Logic & Emotion.</b> The decision is both logical (one boot is dead weight) and emotional (a surge of rage). Good non-fiction analysis recognizes when a character acts on both reason and feeling.", standard: "RI.8.3", difficulty: 4 },
            { id: 'wild5', stem: "<b>Part B:</b> The act of throwing the boot best symbolizes:", options: ["Letting go of what you can't save.", "Giving up completely.", "Hating shoes.", "A game."], correct_answer: "Letting go of what you can't save.", rationale: "<b>Lesson: Symbolism in Memoir.</b> In a memoir, physical objects often represent larger life lessons. Throwing the boot isn't just about shoes; it's about accepting loss and moving forward 'lighter' than before.", standard: "RI.8.4", difficulty: 7 },
            { id: 'wild2', stem: "The phrase 'bobbing in the white water' emphasizes:", options: ["The helplessness of the situation.", "The fun of swimming.", "The cleanliness of the boot.", "The weather."], correct_answer: "The helplessness of the situation.", rationale: "<b>Lesson: Imagery.</b> 'Bobbing' implies a lack of control, and 'white water' implies danger/speed. The imagery emphasizes that the boot is irretrievable.", standard: "RI.8.4", difficulty: 5 }
        ]
    },
    {
        id: 'lit-poe-cask',
        passage: `<b>The Cask of Amontillado</b><br>The thousand injuries of Fortunato I had borne as I best could, but when he ventured upon insult, I vowed revenge. You, who so well know the nature of my soul, will not suppose, however, that I gave utterance to a threat. At length I would be avenged; this was a point definitively settled... I must not only punish, but punish with impunity.`,
        items: [
            { id: 'cask1', stem: "The narrator's motivation is:", options: ["Revenge for an insult", "Money", "Jealousy of a job", "Fear"], correct_answer: "Revenge for an insult", rationale: "<b>Lesson: Textual Evidence.</b> The text explicitly states: 'when he ventured upon insult, I vowed revenge.' Always look for the direct cause-and-effect stated by the narrator.", standard: "RL.8.3", difficulty: 2 },
            { id: 'cask5', stem: "Point of View:", options: ["First-Person (Unreliable)", "Third-Person", "Omniscient", "Second-Person"], correct_answer: "First-Person (Unreliable)", rationale: "<b>Lesson: Point of View.</b> The use of 'I' indicates First-Person. It is 'Unreliable' because he claims 'thousand injuries' but only mentions an insult. His perception is biased by his anger.", standard: "RL.8.6", difficulty: 6 },
            { id: 'cask7', stem: "Tone:", options: ["Chilling/Malicious", "Happy", "Sad", "Funny"], correct_answer: "Chilling/Malicious", rationale: "<b>Lesson: Tone.</b> The narrator is calmly planning a murder ('punish with impunity'). A calm calculation of harm creates a chilling and malicious tone.", standard: "RL.8.4", difficulty: 4 }
        ]
    },

    // =================================================================
    // SECTION 2: EXPANDED INFORMATIONAL TEXTS (RI)
    // =================================================================
    {
id: 'inf-snow-sand',
        passage: `<h3 class="text-xl font-bold mb-2">Paired Texts: Extreme Boarding</h3>
        <div class="mb-6 bg-blue-50 dark:bg-gray-700 p-4 rounded-xl border-l-4 border-blue-500">
            <h4 class="font-bold uppercase text-xs text-blue-600 dark:text-blue-300 mb-2">Source A: "A Beginner's Guide to Snowboarding"</h4>
            <p class="text-sm">So, you're ready to shred? Snowboarding is the ultimate rush. It requires expensive gear‚Äîthermal layers, waterproof shells, and a lift pass that can cost $150 a day‚Äîbut the feeling of carving down fresh powder is priceless. Beginners should beware: ice is unforgiving. You <i>will</i> fall, and it will hurt. But once you catch that edge, you're flying.</p>
        </div>
        <div class="mb-4 bg-orange-50 dark:bg-gray-700 p-4 rounded-xl border-l-4 border-orange-500">
            <h4 class="font-bold uppercase text-xs text-orange-600 dark:text-orange-300 mb-2">Source B: "Sandboarding 101"</h4>
            <p class="text-sm">Forget the cold. Sandboarding is the accessible alternative for thrill-seekers. A board costs $50, and the dunes are free. However, sand has higher friction than snow, meaning you have to wax your board constantly to keep moving. And there are no chairlifts here; you earn your turns by hiking up the dune in the heat. It‚Äôs a workout, not just a ride.</p>
        </div>`,
        items: [
            { id: 'ss1', stem: "<b>Conflicting Information:</b> How do the two sources differ regarding the <b>cost</b> of the sport?", options: ["Source A presents snowboarding as expensive; Source B presents sandboarding as affordable.", "Both say the sports are free.", "Source A says gear is cheap.", "Source B says you need lift tickets."], correct_answer: "Source A presents snowboarding as expensive; Source B presents sandboarding as affordable.", rationale: "<b>Lesson: Comparative Analysis.</b> Source A mentions '$150 a day,' implying high cost. Source B mentions 'dunes are free,' implying affordability. Identifying these opposing data points is key to comparing texts.", standard: "RI.8.9", difficulty: 3 },
            { id: 'ss2', stem: "Which advantage does Source A claim Snowboarding has over Sandboarding (implied in Source B)?", options: ["The fluid speed ('flying') on powder vs the friction of sand.", "It is warmer.", "It is cheaper.", "You don't have to stand up."], correct_answer: "The fluid speed ('flying') on powder vs the friction of sand.", rationale: "<b>Lesson: Inference across Texts.</b> Source A describes 'flying' (high speed). Source B admits sand has 'higher friction' (slower). By synthesizing these details, we infer Snowboarding is faster/smoother.", standard: "RI.8.9", difficulty: 5 },
            { id: 'ss3', stem: "What specific challenge is mentioned in Source B but NOT in Source A?", options: ["The physical exertion of hiking up (no lifts).", "The danger of falling.", "The cost of boots.", "The cold weather."], correct_answer: "The physical exertion of hiking up (no lifts).", rationale: "<b>Lesson: Omitted Details.</b> Source A mentions chairlifts (easy travel). Source B emphasizes 'hiking up... it's a workout.' This physical exertion is a unique challenge to sandboarding.", standard: "RI.8.1", difficulty: 4 },
            { id: 'ss4', stem: "Both authors would likely agree that:", options: ["Board sports require resilience (dealing with falls/hiking).", "Snow is better.", "Sand is better.", "Staying home is best."], correct_answer: "Board sports require resilience (dealing with falls/hiking).", rationale: "<b>Lesson: Synthesizing Perspectives.</b> Even though they prefer different sports, both admit it is hard: Source A warns of painful falls, Source B warns of the hard hike. Both require toughness.", standard: "RI.8.9", difficulty: 4 },
            { id: 'ss5', stem: "The tone of Source A is ________, while Source B is ________.", options: ["Enthusiastic/Intense; Practical/Gritty", "Sad; Happy", "Angry; Bored", "Scientific; Poetic"], correct_answer: "Enthusiastic/Intense; Practical/Gritty", rationale: "<b>Lesson: Tone Analysis.</b> Source A uses words like 'ultimate rush' and 'flying' (Enthusiastic). Source B focuses on 'friction,' 'hiking,' and 'workout' (Practical/Gritty).", standard: "RI.8.6", difficulty: 6 }
        ]
    },
    {
        id: 'arg-school-start',
        passage: `<h3 class="text-xl font-bold mb-2">Editorial: Wake Up to the Science</h3>
        <p class="mb-4"><b>1</b> The alarm buzzes at 6:00 AM. A teenager stumbles out of bed, eyes bleary, brain foggy. This isn't just laziness; it's biology. The circadian rhythms of adolescents shift naturally, causing melatonin (the sleep hormone) to be secreted later at night and fade later in the morning. By forcing an 8:00 AM start time, schools are essentially asking students to perform complex calculus while their brains are physiologically asleep.</p>
        <p class="mb-4"><b>2</b> Critics argue that changing start times would create a logistical nightmare. "What about bus schedules?" they ask. "What about after-school sports?" These are valid concerns, but they prioritize logistics over learning. Bus routes can be redrawn. Sports practices can be shortened. What cannot be fixed is the damage done to a developing brain deprived of rest.</p>
        <p class="mb-4"><b>3</b> The data is undeniable. Districts that have moved start times to 8:30 AM or later have seen improvements in attendance, a reduction in car accidents among teen drivers, and higher standardized test scores. The cost of bus fuel is easily calculated; the cost of a generation's lost potential is incalculable.</p>`,
        items: [
            { id: 'arg1', stem: "<b>Part A:</b> What is the author's primary claim?", options: ["Schools should start later to align with teen biology.", "Bus schedules are too expensive to change.", "Teenagers are lazy.", "Math is too hard at 8 AM."], correct_answer: "Schools should start later to align with teen biology.", rationale: "<b>Lesson: Identifying Claims.</b> The claim is the main argument. The author argues that early start times fight against biology, and therefore should be changed. All other points support this main idea.", standard: "RI.8.8", difficulty: 4 },
            { id: 'arg2', stem: "<b>Part B:</b> Which detail supports the claim in Part A?", options: ["'Melatonin... secreted later at night and fade later in the morning.'", "'What about bus schedules?'", "'Alarm buzzes at 6:00 AM.'", "'Valid concerns.'"], correct_answer: "'Melatonin... secreted later at night and fade later in the morning.'", rationale: "<b>Lesson: Scientific Evidence.</b> To support a claim about biology, the author uses biological facts. The details about melatonin provide the scientific 'why' behind the argument.", standard: "RI.8.1", difficulty: 5 },
            { id: 'arg3', stem: "How does the author respond to the counterclaim regarding sports and buses?", options: ["By acknowledging them but arguing student health is more important.", "By saying sports don't matter.", "By denying that buses exist.", "By agreeing that the schedule shouldn't change."], correct_answer: "By acknowledging them but arguing student health is more important.", rationale: "<b>Lesson: Rebuttal Strategy.</b> A good argument doesn't ignore the other side. The author admits the concerns are 'valid' (Concession) but argues that brain health is a higher priority (Refutation).", standard: "RI.8.8", difficulty: 6 },
            { id: 'arg4', stem: "The phrase 'physiologically asleep' suggests:", options: ["The body is in a sleep state even if the person is walking.", "The student is dreaming.", "The student is lazy.", "The student is in bed."], correct_answer: "The body is in a sleep state even if the person is walking.", rationale: "<b>Lesson: Vocabulary in Context.</b> 'Physiologically' refers to how the body functions. Even if the student is awake (walking/talking), their biological systems are still in 'sleep mode' due to the melatonin.", standard: "RI.8.4", difficulty: 5 },
            { id: 'arg9', stem: "The concluding sentence contrasts:", options: ["Calculable financial costs vs. incalculable human potential.", "Buses vs. Cars.", "Morning vs. Night.", "Teachers vs. Students."], correct_answer: "Calculable financial costs vs. incalculable human potential.", rationale: "<b>Lesson: Rhetorical Devices.</b> The author ends with a strong contrast: money (which is finite) vs. potential (which is infinite). This highlights that the value of students is greater than the value of a budget.", standard: "RI.8.5", difficulty: 7 }
        ]
    },

{
        id: 'voc-roots-lab',
        passage: "<b>The Etymology Lab</b><br>Dr. Morpheme studies words. (1) The <i>benevolent</i> king smiled. (2) The <i>chronometer</i> broke. (3) The <i>cacophony</i> in the cafeteria was unbearable. (4) The politician's speech was <i>ambiguous</i>.",
        items: [
            { id: 'v1', stem: "Based on the root 'bene', 'benevolent' means:", options: ["Kind/Good-willed", "Evil", "Wealthy", "Sick"], correct_answer: "Kind/Good-willed", rationale: "<b>Lesson: Latin Roots.</b> 'Bene' means Good (Benefit, Benefactor). 'Volent' means to wish. So, Benevolent literally means 'wishing good' for others.", standard: "L.8.4.b", difficulty: 3 },
            { id: 'v2', stem: "The root 'chron' in 'chronometer' refers to:", options: ["Time", "Distance", "Heat", "Color"], correct_answer: "Time", rationale: "<b>Lesson: Greek Roots.</b> 'Chronos' means Time. A chronometer measures time (like a watch), just like 'Chronological' order arranges events by time.", standard: "L.8.4.b", difficulty: 4 },
            { id: 'v3', stem: "If 'phon' means sound, 'cacophony' suggests:", options: ["Harsh/Bad noise", "Beautiful music", "Silence", "Whispering"], correct_answer: "Harsh/Bad noise", rationale: "<b>Lesson: Word Construction.</b> 'Caco' means bad + 'Phon' means sound. A cacophony is a mixture of harsh, clashing sounds.", standard: "L.8.4.b", difficulty: 6 },
            { id: 'v4', stem: "The prefix 'ambi' in 'ambiguous' means:", options: ["Both/Around", "One", "None", "Against"], correct_answer: "Both/Around", rationale: "<b>Lesson: Prefixes.</b> 'Ambi' means both (Ambidextrous = uses both hands). If something is ambiguous, it could mean two different things, making it unclear.", standard: "L.8.4.b", difficulty: 5 },
            { id: 'v5', stem: "Which word shares a root with 'spectacle'?", options: ["Inspect", "Special", "Speed", "Space"], correct_answer: "Inspect", rationale: "<b>Lesson: Root Families.</b> Both words share the root 'Spec,' which means 'to look.' A spectacle is something to look at; to inspect is to look closely.", standard: "L.8.4.b", difficulty: 3 },
            { id: 'v6', stem: "Analogy -> Microscope : Small :: Telescope : ?", options: ["Distant", "Large", "Hot", "Space"], correct_answer: "Distant", rationale: "<b>Lesson: Analogies.</b> A microscope helps you see things that are too <i>small</i>. A telescope helps you see things that are too <i>distant</i>.", standard: "L.8.5.b", difficulty: 5 },
            { id: 'v7', stem: "Irony Check: A fire station burns down. This is:", options: ["Situational Irony", "Verbal Irony", "Dramatic Irony", "Coincidence"], correct_answer: "Situational Irony", rationale: "<b>Lesson: Irony Types.</b> Situational irony is when the exact opposite of what is expected happens. You expect a fire station to <i>stop</i> fires, not be destroyed by one.", standard: "L.8.5.a", difficulty: 6 },
            { id: 'v8', stem: "Nuance: Which word implies the strongest anger?", options: ["Furious", "Annoyed", "Upset", "Displeased"], correct_answer: "Furious", rationale: "<b>Lesson: Connotation/Degrees.</b> Synonyms have different intensities. 'Annoyed' is a 2/10. 'Furious' is a 10/10 level of anger.", standard: "L.8.5.c", difficulty: 2 },
            { id: 'v9', stem: "Suffix '-logy' (Biology, Geology) means:", options: ["Study of", "Fear of", "Love of", "Made of"], correct_answer: "Study of", rationale: "<b>Lesson: Suffixes.</b> 'Logy' means 'the study of.' Bio (Life) + Logy = Study of Life. Geo (Earth) + Logy = Study of Earth.", standard: "L.8.4.b", difficulty: 3 },
            { id: 'v10', stem: "Prefix 'anti-' vs 'ante-':", options: ["Against vs Before", "Before vs Against", "Small vs Big", "Love vs Hate"], correct_answer: "Against vs Before", rationale: "<b>Lesson: Confusing Prefixes.</b> Anti = Against (Anti-war). Ante = Before (Antebellum/Before the war). One letter changes the whole meaning!", standard: "L.8.4.b", difficulty: 7 }
        ]
    },
    {
        id: 'media-shark-week',
        passage: "<b>Media Analysis: Shark Safety</b><br><b>Text Article:</b> Lists statistics showing shark attacks are rare (1 in 3 million). Explains shark behavior is usually investigative, not predatory.<br><b>Video Clip Description:</b> Shows a Great White breaching the water in slow motion with ominous music. A narrator shouts, 'Nature's perfect killer!'",
        items: [
            { id: 'med1', stem: "How does the video differ from the text?", options: ["Video relies on fear/drama; Text relies on facts.", "Video is boring.", "Text is scary.", "They are exactly the same."], correct_answer: "Video relies on fear/drama; Text relies on facts.", rationale: "<b>Lesson: Media Formats.</b> Visual media often uses emotion (music, slow-mo) to entertain, while text often uses data (stats) to inform.", standard: "RI.8.7", difficulty: 4 },
            { id: 'med2', stem: "What advantage does the video have over the text?", options: ["Visual impact of power/size.", "More accurate statistics.", "Better vocabulary.", "Easier to carry."], correct_answer: "Visual impact of power/size.", rationale: "<b>Lesson: Medium Advantages.</b> You can't <i>feel</i> the size of a shark from a number. Video provides a visceral sense of scale and power that text cannot match.", standard: "RI.8.7", difficulty: 5 },
            { id: 'med3', stem: "The music in the video is intended to:", options: ["Create a mood of suspense/danger.", "Help sharks dance.", "Relax the viewer.", "Sell boats."], correct_answer: "Create a mood of suspense/danger.", rationale: "<b>Lesson: Audio Cues.</b> Directors use minor keys and bass tones (like the Jaws theme) to subconsciously make the viewer feel afraid.", standard: "RI.8.7", difficulty: 3 },
            { id: 'med4', stem: "The text's purpose is likely:", options: ["To inform/de-escalate fear.", "To scare tourists.", "To sell shark cages.", "To protect fish."], correct_answer: "To inform/de-escalate fear.", rationale: "<b>Lesson: Author's Purpose.</b> By sharing facts about how <i>rare</i> attacks are, the author is trying to calm the reader down using logic.", standard: "RI.8.6", difficulty: 4 },
            { id: 'med5', stem: "Which source is more objective (unbiased)?", options: ["The Text", "The Video", "Neither", "Both"], correct_answer: "The Text", rationale: "<b>Lesson: Bias.</b> The text relies on statistics (facts). The video relies on 'ominous music' and dramatic narration (opinions/feelings). Facts are more objective.", standard: "RI.8.6", difficulty: 6 },
            { id: 'med6', stem: "The phrase 'Nature's perfect killer' is:", options: ["Subjective opinion", "Objective fact", "A statistic", "A lie"], correct_answer: "Subjective opinion", rationale: "<b>Lesson: Fact vs. Opinion.</b> 'Killer' might be a fact, but 'Perfect' is an opinion/judgment. There is no scientific measurement for 'perfection.'", standard: "RI.8.8", difficulty: 5 },
            { id: 'med7', stem: "If you wanted to write a research paper on safety, you would use:", options: ["The Text", "The Video", "A movie poster", "A toy shark"], correct_answer: "The Text", rationale: "<b>Lesson: Selecting Sources.</b> For a research paper, you need verifiable data (1 in 3 million), not emotional entertainment.", standard: "RI.8.8", difficulty: 2 },
            { id: 'med8', stem: "How does the slow motion affect the viewer?", options: ["Emphasizes power and detail.", "Makes the shark look slow.", "Saves time.", "Blurs the image."], correct_answer: "Emphasizes power and detail.", rationale: "<b>Lesson: Visual Techniques.</b> Slow motion stretches time, forcing the viewer to focus on every detail of the shark's muscle and teeth, enhancing the awe/fear.", standard: "RI.8.7", difficulty: 6 },
            { id: 'med9', stem: "What information is likely missing from the video?", options: ["Statistical context of rarity.", "The color of the shark.", "The sound of water.", "The shark's teeth."], correct_answer: "Statistical context of rarity.", rationale: "<b>Lesson: Omission.</b> Sensational videos rarely mention boring facts (like how safe you actually are) because it ruins the excitement.", standard: "RI.8.7", difficulty: 7 },
            { id: 'med10', stem: "Theme shared by both:", options: ["Sharks are powerful creatures.", "Swimming is safe.", "Oceans are cold.", "Music is good."], correct_answer: "Sharks are powerful creatures.", rationale: "<b>Lesson: Synthesis.</b> Even though they have different purposes, both sources agree on the subject's nature: the shark is a powerful apex predator.", standard: "RI.8.9", difficulty: 3 }
        ]
    },
    {
        id: 'bio-douglass',
        passage: "<b>from Narrative of the Life of Frederick Douglass</b><br>I set out with high hope, and a fixed purpose, at whatever cost of trouble, to learn how to read... The plan which I adopted, and the one by which I was most successful, was that of making friends of all the little white boys whom I met in the street. As many of these as I could, I converted into teachers.",
        items: [
            { id: 'bio1', stem: "Douglass's 'fixed purpose' was:", options: ["To learn to read.", "To make friends.", "To escape immediately.", "To buy books."], correct_answer: "To learn to read.", rationale: "<b>Lesson: Textual Evidence.</b> The text explicitly states: 'purpose... to learn how to read.' Always start with the exact words on the page.", standard: "RI.8.1", difficulty: 2 },
            { id: 'bio2', stem: "The phrase 'converted into teachers' implies:", options: ["Resourcefulness and strategy.", "Religious conversion.", "Magic.", "Payment."], correct_answer: "Resourcefulness and strategy.", rationale: "<b>Lesson: Word Choice.</b> Douglass didn't just 'ask' them; he 'converted' them. He transformed a casual interaction into a lesson. This shows his strategic intelligence.", standard: "RI.8.4", difficulty: 5 },
            { id: 'bio3', stem: "What is the irony in his method?", options: ["He used the oppressors' children to gain freedom.", "He didn't like reading.", "The boys were mean.", "He was already a teacher."], correct_answer: "He used the oppressors' children to gain freedom.", rationale: "<b>Lesson: Irony.</b> The white adults tried to keep him ignorant, but their own children became the tool of his liberation. That unexpected reversal is ironic.", standard: "RI.8.6", difficulty: 7 },
            { id: 'bio4', stem: "Tone of the passage:", options: ["Determined and reflective.", "Angry and loud.", "Sad and hopeless.", "Funny."], correct_answer: "Determined and reflective.", rationale: "<b>Lesson: Tone.</b> Phrases like 'high hope,' 'fixed purpose,' and 'whatever cost' create a tone of serious determination.", standard: "RI.8.6", difficulty: 4 },
            { id: 'bio5', stem: "This text is an example of:", options: ["Autobiography/Memoir", "Fantasy", "Science Fiction", "Persuasive Essay"], correct_answer: "Autobiography/Memoir", rationale: "<b>Lesson: Genre.</b> It is a true story written by the person who lived it (First Person 'I'). That is the definition of Autobiography.", standard: "RI.8.1", difficulty: 3 },
            { id: 'bio6', stem: "Which character trait best describes Douglass here?", options: ["Perseverant", "Lucky", "Passive", "Fearful"], correct_answer: "Perseverant", rationale: "<b>Lesson: Characterization.</b> He faces a huge obstacle (illiteracy/slavery) and creates a difficult plan to overcome it. That is perseverance.", standard: "RI.8.3", difficulty: 4 },
            { id: 'bio7', stem: "'High hope' contrasts with:", options: ["The reality of his enslavement.", "The weather.", "His age.", "The cost of books."], correct_answer: "The reality of his enslavement.", rationale: "<b>Lesson: Context.</b> While not explicitly stated in this sentence, the historical context (slavery) makes 'high hope' a rebellious and contrasting emotion.", standard: "RI.8.4", difficulty: 6 },
            { id: 'bio8', stem: "Structure: The passage moves from:", options: ["Goal to Strategy.", "Strategy to Failure.", "Past to Future.", "Anger to Joy."], correct_answer: "Goal to Strategy.", rationale: "<b>Lesson: Text Structure.</b> First he states the <i>Goal</i> ('learn to read'), then he explains the <i>Strategy</i> ('making friends... converted into teachers').", standard: "RI.8.5", difficulty: 5 },
            { id: 'bio9', stem: "Why mention 'whatever cost of trouble'?", options: ["To show the risk involved.", "To complain.", "To mention money.", "To scare the reader."], correct_answer: "To show the risk involved.", rationale: "<b>Lesson: Stakes.</b> For an enslaved person, learning to read was illegal and dangerous. 'Cost of trouble' implies he knew he could be punished but did it anyway.", standard: "RI.8.3", difficulty: 5 },
            { id: 'bio10', stem: "Central Idea:", options: ["Knowledge is the path to freedom.", "Making friends is good.", "Streets are dangerous.", "Reading is hard."], correct_answer: "Knowledge is the path to freedom.", rationale: "<b>Lesson: Central Idea.</b> The specific details are about reading, but the big idea is about <i>empowerment</i>. He seeks knowledge to gain power over his life.", standard: "RI.8.2", difficulty: 6 }
        ]
    },
    {
        id: 'wrt-urban-garden',
        passage: "<b>Student Draft: City Gardens</b><br>(1) Urban gardening is becoming popular in big cities. (2) It turns empty lots into green spaces. (3) My uncle has a farm in Ohio with cows. (4) Furthermore, these gardens provide fresh produce to neighborhoods that lack grocery stores. (5) ________, they bring communities together.",
        items: [
            { id: 'w1', stem: "Which sentence is irrelevant and should be deleted?", options: ["Sentence 1", "Sentence 2", "Sentence 3", "Sentence 4"], correct_answer: "Sentence 3", rationale: "<b>Lesson: Relevance.</b> The topic is 'Urban Gardens' (gardens in cities). A farm in Ohio (rural) with cows is off-topic. Good writers delete irrelevant details to stay focused.", standard: "W.8.2", difficulty: 3 },
            { id: 'w2', stem: "Select the best transition word for the blank in Sentence 5:", options: ["However", "In addition", "Therefore", "On the other hand"], correct_answer: "In addition", rationale: "<b>Lesson: Transitions.</b> Sentence 4 lists a benefit (food). Sentence 5 lists <i>another</i> benefit (community). 'In addition' signals that you are adding more information to the same argument.", standard: "W.8.2.c", difficulty: 4 },
            { id: 'w3', stem: "Which sentence would best conclude this paragraph?", options: ["City gardens are hard work.", "Gardens are great for the environment and the people.", "I hate tomatoes.", "Farms are bigger than gardens."], correct_answer: "Gardens are great for the environment and the people.", rationale: "<b>Lesson: Conclusions.</b> A conclusion should summarize the main points. This option touches on both the green space (environment) and the community/food (people).", standard: "W.8.2.f", difficulty: 4 },
            { id: 'w4', stem: "Where should the sentence 'Plants also help clean the city air.' be placed?", options: ["After Sentence 1", "After Sentence 2", "After Sentence 5", "Before Sentence 1"], correct_answer: "After Sentence 2", rationale: "<b>Lesson: Flow/Organization.</b> Sentence 2 talks about 'green spaces' (environmental). This new sentence adds another environmental benefit (clean air). Keep related ideas together.", standard: "W.8.2.c", difficulty: 6 },
            { id: 'w5', stem: "What is the best way to combine Sentences 1 and 2?", options: ["Urban gardening is popular because it turns empty lots into green spaces.", "Urban gardening is popular, it turns lots green.", "Turning empty lots into green spaces and becoming popular.", "Urban gardening is popular; however, it turns lots green."], correct_answer: "Urban gardening is popular because it turns empty lots into green spaces.", rationale: "<b>Lesson: Sentence Combining.</b> 'Because' creates a clear cause-and-effect relationship. The other options are comma splices or fragments.", standard: "L.8.3.a", difficulty: 5 },
            { id: 'w6', stem: "Identify the author's claim:", options: ["Urban gardens are beneficial.", "Cows are important.", "Grocery stores are far away.", "Cities are dirty."], correct_answer: "Urban gardens are beneficial.", rationale: "<b>Lesson: Claims.</b> The entire paragraph lists positive things about gardens (green space, food, community). The claim is the umbrella statement covering all these points.", standard: "W.8.1", difficulty: 2 },
            { id: 'w7', stem: "Which word is too vague in Sentence 1 ('big cities')?", options: ["Big", "Popular", "Gardening", "None"], correct_answer: "Big", rationale: "<b>Lesson: Precise Language.</b> 'Big' is a weak word. Is it a sprawling city? A dense metropolis? Using precise vocabulary improves the quality of writing.", standard: "L.8.3", difficulty: 7 },
            { id: 'w8', stem: "Tone analysis: The draft is written in a...", options: ["Formal, informative style", "Angry, persuasive style", "Sad, narrative style", "Funny, joking style"], correct_answer: "Formal, informative style", rationale: "<b>Lesson: Style.</b> The text relies on facts and clear statements. It doesn't use slang, jokes, or emotional outbursts.", standard: "W.8.2.e", difficulty: 4 },
            { id: 'w9', stem: "Standard English: Is 'produce' used as a noun or verb in Sentence 4?", options: ["Noun (vegetables)", "Verb (to make)", "Adjective", "Adverb"], correct_answer: "Noun (vegetables)", rationale: "<b>Lesson: Parts of Speech.</b> 'Produce' can be a verb (to make), but here it refers to 'fresh produce' (fruits and veggies). Context determines the part of speech.", standard: "L.8.4", difficulty: 5 },
            { id: 'w10', stem: "Antonym for 'lack' (Sentence 4):", options: ["Possess", "Want", "Need", "Miss"], correct_answer: "Possess", rationale: "<b>Lesson: Antonyms.</b> To 'lack' means to be without. To 'possess' means to have. They are opposites.", standard: "L.8.5", difficulty: 3 }
        ]
    },
    {
        id: 'tech-drone-manual',
        passage: "<b>User Manual: X-200 Drone</b><br><b>Step 1:</b> Charge battery fully (LED turns green).<br><b>Step 2:</b> Sync controller by holding 'Power' for 3 seconds.<br><b>Warning:</b> Do not fly near power lines. Signal interference may cause crash.",
        items: [
            { id: 'tc1', stem: "What must happen before you sync the controller?", options: ["Charge the battery.", "Fly the drone.", "Crash the drone.", "Buy a new battery."], correct_answer: "Charge the battery.", rationale: "<b>Lesson: Sequence.</b> In procedural text, order matters. Step 1 (Charge) comes before Step 2 (Sync). Always follow the numbered list.", standard: "RI.8.3", difficulty: 2 },
            { id: 'tc2', stem: "What is the consequence of ignoring the Warning?", options: ["Signal interference/Crash", "The LED turns red", "The drone flies faster", "The battery explodes"], correct_answer: "Signal interference/Crash", rationale: "<b>Lesson: Cause & Effect.</b> The text explicitly links 'fly near power lines' (Cause) to 'interference may cause crash' (Effect).", standard: "RI.8.5", difficulty: 3 },
            { id: 'tc3', stem: "The word 'Sync' most nearly means:", options: ["Connect/Pair", "Wash", "Throw", "Destroy"], correct_answer: "Connect/Pair", rationale: "<b>Lesson: Technical Vocab.</b> In technology, 'sync' (synchronize) means connecting two devices so they work together.", standard: "L.8.4", difficulty: 4 },
            { id: 'tc4', stem: "Why is the text organized into numbered steps?", options: ["To show correct sequence", "To look pretty", "To confuse the user", "To save paper"], correct_answer: "To show correct sequence", rationale: "<b>Lesson: Text Features.</b> Numbered lists are used when the <i>order</i> of actions is critical. Bullet points are for items where order doesn't matter.", standard: "RI.8.5", difficulty: 3 },
            { id: 'tc5', stem: "Who is the intended audience?", options: ["New owners of the X-200", "Bird watchers", "Pilots of real planes", "Babies"], correct_answer: "New owners of the X-200", rationale: "<b>Lesson: Audience.</b> A manual is written for the person trying to use the product. The content (charging, syncing) is only useful to an owner.", standard: "RI.8.6", difficulty: 2 },
            { id: 'tc6', stem: "If the LED is red, you should:", options: ["Keep charging", "Fly immediately", "Throw it away", "Press Power"], correct_answer: "Keep charging", rationale: "<b>Lesson: Inference.</b> The text says 'Charge... (LED turns green).' We infer that if it is NOT green (red), it is not done charging.", standard: "RI.8.1", difficulty: 5 },
            { id: 'tc7', stem: "The 'Warning' section serves to:", options: ["Ensure safety and prevent damage", "Scare people", "Fill space", "Sell insurance"], correct_answer: "Ensure safety and prevent damage", rationale: "<b>Lesson: Purpose.</b> Warnings are distinct text features designed to protect the user and the equipment from harm.", standard: "RI.8.5", difficulty: 4 },
            { id: 'tc8', stem: "Which text feature helps you find the charging info?", options: ["Bold headings/Steps", "The glossary", "The index", "The author's name"], correct_answer: "Bold headings/Steps", rationale: "<b>Lesson: Navigation.</b> Bold text attracts the eye. Scanning for 'Step 1' or 'Charge' is easier because of the formatting.", standard: "RI.8.5", difficulty: 3 },
            { id: 'tc9', stem: "Meaning of 'interference':", options: ["Disruption/Blocking", "Help", "Speed", "Color"], correct_answer: "Disruption/Blocking", rationale: "<b>Lesson: Context Clues.</b> Power lines cause interference, which leads to a crash. Therefore, interference must be something that disrupts the signal.", standard: "L.8.4", difficulty: 5 },
            { id: 'tc10', stem: "Mode of writing:", options: ["Procedural/Technical", "Persuasive", "Narrative", "Poetic"], correct_answer: "Procedural/Technical", rationale: "<b>Lesson: Modes of Writing.</b> Writing that teaches you 'how to do' something is Procedural or Technical.", standard: "RI.8.1", difficulty: 3 }
        ]
    },
    {
        id: 'rhet-speech-liberty',
        passage: "<b>Speech: The Torch of Liberty</b><br>We do not ask for favor. We do not ask for pity. We ask only for justice. Like a mountain standing against the wind, we shall not be moved. The future is not a gift; it is a prize to be won.",
        items: [
            { id: 'rh1', stem: "Identify the rhetorical device in 'We do not... We do not... We ask...':", options: ["Parallelism/Repetition", "Simile", "Personification", "Irony"], correct_answer: "Parallelism/Repetition", rationale: "<b>Lesson: Parallelism.</b> Repeating the same grammatical structure ('We do not...') creates rhythm and emphasis. It makes the speech sound powerful and memorable.", standard: "L.8.5", difficulty: 6 },
            { id: 'rh2', stem: "The simile 'Like a mountain' suggests:", options: ["Strength and stability", "Coldness", "Height", "Nature"], correct_answer: "Strength and stability", rationale: "<b>Lesson: Simile.</b> A mountain is unmovable. Comparing the people to a mountain emphasizes their resolve and refusal to surrender.", standard: "L.8.5.a", difficulty: 4 },
            { id: 'rh3', stem: "Speaker's tone:", options: ["Resolute and determined", "Sad and begging", "Happy and light", "Confused"], correct_answer: "Resolute and determined", rationale: "<b>Lesson: Tone.</b> The speaker says 'We shall not be moved.' This is the language of determination, not sadness or begging.", standard: "RI.8.6", difficulty: 5 },
            { id: 'rh4', stem: "What distinction is made about 'the future'?", options: ["It must be earned (prize), not given (gift).", "It is expensive.", "It is scary.", "It is boring."], correct_answer: "It must be earned (prize), not given (gift).", rationale: "<b>Lesson: Metaphor.</b> Calling the future a 'prize' means you have to fight/work for it. Calling it a 'gift' would mean it is free.", standard: "RI.8.3", difficulty: 6 },
            { id: 'rh5', stem: "The phrase 'shall not be moved' implies:", options: ["Refusal to surrender", "Physical paralysis", "Laziness", "Being stuck in traffic"], correct_answer: "Refusal to surrender", rationale: "<b>Lesson: Connotation.</b> In the context of a protest or speech, 'not moving' is a symbol of resistance, not literal immobility.", standard: "RI.8.4", difficulty: 5 },
            { id: 'rh6', stem: "Main Claim:", options: ["We deserve justice.", "Mountains are windy.", "Gifts are bad.", "Don't ask questions."], correct_answer: "We deserve justice.", rationale: "<b>Lesson: Main Idea.</b> The repetition highlights the core message: 'We ask only for justice.' Everything else supports this demand.", standard: "RI.8.2", difficulty: 3 },
            { id: 'rh7', stem: "Who is the 'We' likely representing?", options: ["A marginalized/oppressed group", "The mountains", "Rich kings", "Children"], correct_answer: "A marginalized/oppressed group", rationale: "<b>Lesson: Inference.</b> Groups that have to ask for 'justice' and 'pity' are usually those who have been mistreated or oppressed.", standard: "RI.8.1", difficulty: 5 },
            { id: 'rh8', stem: "Function of 'The Torch' in the title:", options: ["Symbol of hope/light", "To burn things", "A flashlight", "Heat"], correct_answer: "Symbol of hope/light", rationale: "<b>Lesson: Symbolism.</b> A torch (like the Statue of Liberty's) symbolizes guiding light, hope, and freedom.", standard: "L.8.5", difficulty: 6 },
            { id: 'rh9', stem: "Which appeal is used most? (Ethos/Pathos/Logos)", options: ["Pathos (Emotional)", "Logos (Logic)", "Ethos (Credibility)", "None"], correct_answer: "Pathos (Emotional)", rationale: "<b>Lesson: Rhetorical Appeals.</b> The speech uses stirring images (mountains, prizes) and strong words (justice, pity) to evoke emotion (Pathos).", standard: "RI.8.6", difficulty: 7 },
            { id: 'rh10', stem: "What is the 'wind' in the mountain metaphor?", options: ["Adversity/Opposition", "Weather", "Air", "Help"], correct_answer: "Adversity/Opposition", rationale: "<b>Lesson: Metaphor Breakdown.</b> If the people are the mountain, the wind beating against them represents the forces trying to push them down (adversity).", standard: "L.8.5", difficulty: 7 }
        ]
    },
    {
        id: 'inf-conflict-zoo',
        passage: "<b>Source A (Press Release):</b> The City Zoo is proud to announce the new 'Lion Habitat.' This safe, modern enclosure mimics the savannah and promotes conservation.<br><b>Source B (Letter to Editor):</b> The new lion pit is a disaster. It is too small, and the 'savannah' is just painted concrete. The money should have been spent on protecting lions in the wild, not trapping them here.",
        items: [
            { id: 'conf1', stem: "How do the two sources differ in their interpretation of the 'Habitat'?", options: ["Source A sees it as modern; Source B sees it as a prison.", "Both love it.", "Source A hates it; Source B loves it.", "Both hate it."], correct_answer: "Source A sees it as modern; Source B sees it as a prison.", rationale: "<b>Lesson: Point of View.</b> The same object (the cage) is described as 'safe' by one side and a 'pit' by the other. This shows how perspective shapes reality.", standard: "RI.8.9", difficulty: 4 },
            { id: 'conf2', stem: "Which fact is emphasized in Source B but missing from Source A?", options: ["The enclosure is made of concrete.", "The zoo is proud.", "Lions live in the savannah.", "It is a new habitat."], correct_answer: "The enclosure is made of concrete.", rationale: "<b>Lesson: Bias by Omission.</b> The Zoo (Source A) leaves out the ugly detail (concrete) to make themselves look better. The critic (Source B) highlights it.", standard: "RI.8.9", difficulty: 5 },
            { id: 'conf3', stem: "Source A uses the word 'Habitat' to suggest:", options: ["A natural, healthy home", "A cage", "A laboratory", "A circus"], correct_answer: "A natural, healthy home", rationale: "<b>Lesson: Euphemism.</b> 'Habitat' sounds scientific and natural. 'Cage' sounds harsh. The Zoo uses the softer word to influence public opinion.", standard: "RI.8.4", difficulty: 3 },
            { id: 'conf4', stem: "Source B's tone can be described as:", options: ["Critical and indignant", "Happy and supportive", "Bored", "Scientific"], correct_answer: "Critical and indignant", rationale: "<b>Lesson: Tone.</b> Words like 'disaster,' 'pit,' and 'trapping' show strong disapproval (critical) and anger (indignant).", standard: "RI.8.6", difficulty: 4 },
            { id: 'conf5', stem: "What is the shared topic of both texts?", options: ["The new lion enclosure", "Tiger food", "Ticket prices", " The weather"], correct_answer: "The new lion enclosure", rationale: "<b>Lesson: Topic vs. Opinion.</b> Both texts talk about the *same thing* (the enclosure), even though they have different *opinions* about it.", standard: "RI.8.9", difficulty: 2 },
            { id: 'conf6', stem: "Source B claims the money should have been used for:", options: ["Wild conservation", "Better paint", "Buying tigers", "Cleaning the concrete"], correct_answer: "Wild conservation", rationale: "<b>Lesson: Counter-Argument.</b> The critic offers an alternative solution: spending money on wild lions instead of captive ones.", standard: "RI.8.1", difficulty: 3 },
            { id: 'conf7', stem: "Which statement best summarizes the conflict?", options: ["Conservation vs. Captivity", "Cats vs. Dogs", "Paint vs. Wood", "Day vs. Night"], correct_answer: "Conservation vs. Captivity", rationale: "<b>Lesson: Thematic Conflict.</b> The core argument isn't about the specific cage; it's about the philosophy of keeping animals (Captivity) vs protecting them in nature (Conservation).", standard: "RI.8.2", difficulty: 6 },
            { id: 'conf8', stem: "If Source A were to respond to Source B, they would likely say:", options: ["Captivity inspires people to donate to the wild.", "You are right, we will close.", "Lions hate grass.", "Concrete is soft."], correct_answer: "Captivity inspires people to donate to the wild.", rationale: "<b>Lesson: Predicting Arguments.</b> Zoos typically defend themselves by claiming that seeing animals inspires people to save them. This is a logical counter-point.", standard: "RI.8.8", difficulty: 7 },
            { id: 'conf9', stem: "The word 'mimics' in Source A implies:", options: ["It is an artificial copy.", "It is real.", "It is broken.", "It is invisible."], correct_answer: "It is an artificial copy.", rationale: "<b>Lesson: Word Nuance.</b> To mimic means to copy or imitate. It admits the habitat isn't real, but claims it is a good copy.", standard: "L.8.4", difficulty: 5 },
            { id: 'conf10', stem: "Which source is likely more objective?", options: ["Neither (both are biased)", "Source A", "Source B", "A Math textbook"], correct_answer: "Neither (both are biased)", rationale: "<b>Lesson: Bias.</b> Both sources have an agenda. The Zoo wants to sell tickets; the Letter writer wants to stop the zoo. Neither is a neutral observer.", standard: "RI.8.6", difficulty: 6 }
        ]
    },
    {
        id: 'lit-satire-lunch',
        passage: "<b>The Gourmet Lunch</b><br>Today's cafeteria specialty was a delight known as 'Mystery Loaf.' It sat on the tray, sweating quietly, accompanied by a gray mush that I was told represented green beans. Truly, a meal fit for royalty‚Äîif that royalty were currently in a dungeon.",
        items: [
            { id: 'sat1', stem: "The narrator describes the loaf as 'sweating quietly' to create a sense of:", options: ["Disgust/Revulsion", "Heat", "Excitement", "Noise"], correct_answer: "Disgust/Revulsion", rationale: "<b>Lesson: Personification.</b> Food shouldn't sweat. Giving it this human trait makes it sound alive and gross, creating a humorous sense of disgust.", standard: "RL.8.4", difficulty: 4 },
            { id: 'sat2', stem: "The phrase 'meal fit for royalty' is an example of:", options: ["Verbal Irony (Sarcasm)", "Literal fact", "Metaphor", "Alliteration"], correct_answer: "Verbal Irony (Sarcasm)", rationale: "<b>Lesson: Sarcasm.</b> Sarcasm is saying the opposite of what you mean to mock something. He calls it 'royal' to highlight how terrible it actually is.", standard: "RL.8.6", difficulty: 5 },
            { id: 'sat3', stem: "What is the true meaning of the last sentence?", options: ["The food is terrible/punishing.", "Kings eat here.", "The narrator is a prince.", "Dungeons are nice."], correct_answer: "The food is terrible/punishing.", rationale: "<b>Lesson: Punchline.</b> The twist‚Äî'if that royalty were in a dungeon'‚Äîreveals the truth: the food is punishment.", standard: "RL.8.6", difficulty: 3 },
            { id: 'sat4', stem: "The tone of the passage is:", options: ["Mock-serious/Humorous", "Depressed", "Angry", "Educational"], correct_answer: "Mock-serious/Humorous", rationale: "<b>Lesson: Satire.</b> Satire uses humor to criticize. The narrator treats the gross food with fake seriousness ('delight,' 'specialty') to make it funny.", standard: "RL.8.4", difficulty: 5 },
            { id: 'sat5', stem: "Why does the author use the word 'represented' regarding the beans?", options: ["To imply they didn't look like real beans.", "To show they were elected.", "To show they were drawings.", "To show they were tasty."], correct_answer: "To imply they didn't look like real beans.", rationale: "<b>Lesson: Diction.</b> If food 'represents' beans, it isn't <i>actually</i> beans. It's just a symbol of beans. This mocks the quality.", standard: "RL.8.4", difficulty: 4 },
            { id: 'sat6', stem: "The author is criticizing:", options: ["School lunch quality", "Dungeons", "Royalty", "Sweat"], correct_answer: "School lunch quality", rationale: "<b>Lesson: Satirical Target.</b> Every satire attacks something. Here, the target is the terrible quality of institutional food.", standard: "RL.8.2", difficulty: 2 },
            { id: 'sat7', stem: "Hyperbole Check: Which phrase is an exaggeration?", options: ["'Fit for royalty'", "'Green beans'", "'On the tray'", "'Today's specialty'"], correct_answer: "'Fit for royalty'", rationale: "<b>Lesson: Hyperbole.</b> Comparing cafeteria slop to a royal feast is a massive exaggeration used for comic effect.", standard: "L.8.5", difficulty: 3 },
            { id: 'sat8', stem: "Narrator's point of view:", options: ["First Person (Participant)", "Third Person", "Second Person", "Omniscient"], correct_answer: "First Person (Participant)", rationale: "<b>Lesson: POV.</b> The narrator uses 'I' ('I was told'). He is experiencing the lunch himself.", standard: "RL.8.6", difficulty: 2 },
            { id: 'sat9', stem: "The 'gray mush' imagery appeals to the sense of:", options: ["Sight", "Sound", "Touch", "Hearing"], correct_answer: "Sight", rationale: "<b>Lesson: Sensory Detail.</b> Describing the color (gray) and texture (mush) helps the reader visualize the unappetizing food.", standard: "RL.8.4", difficulty: 3 },
            { id: 'sat10', stem: "Theme:", options: ["Humor helps cope with unpleasant situations.", "Food is fuel.", "Respect the cook.", "Beans are healthy."], correct_answer: "Humor helps cope with unpleasant situations.", rationale: "<b>Lesson: Theme.</b> By making fun of the bad situation, the narrator takes power over it. Humor is a coping mechanism.", standard: "RL.8.2", difficulty: 6 }
        ]
    },
    {
        id: 'lang-punct-lab',
        passage: "<b>The Punctuation Station</b><br>(1) I packed my bag with three things: a flashlight, a map, and a compass. (2) The woods‚Äîwhich were dark and scary‚Äîloomed ahead. (3) 'Wait...' I whispered. (4) I think I heard a bear.",
        items: [
            { id: 'pun1', stem: "Sentence 1: The colon (:) is used to:", options: ["Introduce a list", "End the sentence", "Show excitement", "Separate cities"], correct_answer: "Introduce a list", rationale: "<b>Lesson: Colons.</b> A colon acts like a gate. It stops the sentence and announces: 'Here comes a list or explanation!'", standard: "L.8.2.a", difficulty: 4 },
            { id: 'pun2', stem: "Sentence 2: The dashes (‚Äî) function to:", options: ["Set off an interruption/emphasis", "Connect words", "End the sentence", "Show dialogue"], correct_answer: "Set off an interruption/emphasis", rationale: "<b>Lesson: Dashes.</b> Dashes are like aggressive commas. They forcefully interrupt the sentence to add dramatic information ('dark and scary').", standard: "L.8.2.a", difficulty: 5 },
            { id: 'pun3', stem: "Sentence 3: The ellipsis (...) indicates:", options: ["A pause or hesitation", "An omission of words", "Excitement", "A question"], correct_answer: "A pause or hesitation", rationale: "<b>Lesson: Ellipsis.</b> In dialogue, '...' shows the speaker is trailing off or hesitating, usually due to fear or uncertainty.", standard: "L.8.2.b", difficulty: 4 },
            { id: 'pun4', stem: "How else could Sentence 2 be punctuated correctly?", options: ["The woods, which were dark and scary, loomed ahead.", "The woods which were dark and scary loomed ahead.", "The woods; which were dark and scary loomed ahead.", "The woods. Which were dark and scary loomed ahead."], correct_answer: "The woods, which were dark and scary, loomed ahead.", rationale: "<b>Lesson: Commas vs. Dashes.</b> You can use commas for non-restrictive clauses, too. Dashes are just more dramatic. Both are grammatically correct here.", standard: "L.8.2", difficulty: 6 },
            { id: 'pun5', stem: "Which sentence contains an Oxford Comma?", options: ["Sentence 1 (after 'map')", "Sentence 2", "Sentence 3", "Sentence 4"], correct_answer: "Sentence 1 (after 'map')", rationale: "<b>Lesson: Oxford Comma.</b> This is the comma before the 'and' in a list of three or more items. It clarifies that 'map' and 'compass' are separate items.", standard: "L.8.2", difficulty: 5 },
            { id: 'pun6', stem: "Identify the misspelled word (if any):", options: ["No error", "Flashlight", "Loomed", "Whispered"], correct_answer: "No error", rationale: "<b>Lesson: Proofreading.</b> Always double-check! In this case, all words are spelled correctly.", standard: "L.8.2.c", difficulty: 3 },
            { id: 'pun7', stem: "Sentence 4: 'I think I heard' is a:", options: ["Independent clause", "Fragment", "Preposition", "List"], correct_answer: "Independent clause", rationale: "<b>Lesson: Clauses.</b> It has a subject ('I') and a verb ('think'). It expresses a complete thought. Therefore, it is independent.", standard: "L.8.1", difficulty: 5 },
            { id: 'pun8', stem: "Function of quotation marks in Sentence 3:", options: ["Indicate dialogue", "Indicate irony", "Cite a book title", "Highlight a word"], correct_answer: "Indicate dialogue", rationale: "<b>Lesson: Dialogue.</b> Quotation marks hug the words that are actually spoken out loud.", standard: "L.8.2", difficulty: 2 },
            { id: 'pun9', stem: "If you removed the dashes in Sentence 2, the phrase 'which were dark and scary' would become:", options: ["A non-restrictive clause", "A main verb", "A subject", "An object"], correct_answer: "A non-restrictive clause", rationale: "<b>Lesson: Grammar Terms.</b> It is still a clause that adds extra info (non-restrictive). Punctuation (dashes/commas) just sets it apart.", standard: "L.8.1", difficulty: 8 },
            { id: 'pun10', stem: "Best revision for suspense:", options: ["'Wait... I think... is that a bear?'", "'I saw a bear.'", "'Bears are big.'", "'Walking is fun.'"], correct_answer: "'Wait... I think... is that a bear?'", rationale: "<b>Lesson: Style.</b> Using ellipses and questions creates hesitation and fear, which builds suspense better than a flat statement.", standard: "L.8.3", difficulty: 5 }
        ]
    },
    {
        id: 'func-warranty',
        passage: "<b>Electro-Tab 5-Year Limited Warranty</b><br>1. <b>Coverage:</b> Covers defects in materials and workmanship for 5 years from purchase.<br>2. <b>Exclusions:</b> Does NOT cover damage caused by accidents, water, or unauthorized repairs. Opening the device casing immediately voids this warranty.<br>3. <b>Service:</b> To obtain service, mail the device and proof of purchase to our Repair Center.",
        items: [
            { id: 'fw1', stem: "Which action would automatically void the warranty?", options: ["Opening the device casing.", "Using the device daily.", "Mailing it to the Repair Center.", "Losing the receipt."], correct_answer: "Opening the device casing.", rationale: "<b>Lesson: Reading Fine Print.</b> The text explicitly warns: 'Opening the device casing immediately voids this warranty.' Always look for 'void' or 'not covered' in legal texts.", standard: "RI.8.1", difficulty: 3 },
            { id: 'fw2', stem: "If you drop the tablet in a pool, is it covered?", options: ["No, water damage is excluded.", "Yes, it is a material defect.", "Yes, for 5 years.", "Only if you mail it."], correct_answer: "No, water damage is excluded.", rationale: "<b>Lesson: Applying Rules.</b> The text excludes 'water' damage. Dropping it in a pool is water damage, so the rule applies: No coverage.", standard: "RI.8.2", difficulty: 4 },
            { id: 'fw3', stem: "The word 'Exclusions' most nearly means:", options: ["Things left out/Not covered", "Bonus features", "Expensive parts", "Legal rules"], correct_answer: "Things left out/Not covered", rationale: "<b>Lesson: Vocabulary.</b> To 'exclude' means to keep out. In a warranty, 'Exclusions' are the specific things the company will NOT pay for.", standard: "L.8.4", difficulty: 4 },
            { id: 'fw4', stem: "What is required to get service?", options: ["The device and proof of purchase.", "Just the device.", "Money.", "A lawyer."], correct_answer: "The device and proof of purchase.", rationale: "<b>Lesson: Detail Retrieval.</b> Section 3 (Service) lists two requirements: 'mail the device AND proof of purchase.' You need both.", standard: "RI.8.3", difficulty: 2 },
            { id: 'fw5', stem: "The purpose of the bold headings (Coverage, Exclusions) is to:", options: ["Help the reader scan for information.", "Make the text look pretty.", "Scare the reader.", "Hide secrets."], correct_answer: "Help the reader scan for information.", rationale: "<b>Lesson: Text Features.</b> Headings act like signposts. They let you skip to the section you need without reading the whole document.", standard: "RI.8.5", difficulty: 3 },
            { id: 'fw6', stem: "What implies this is a 'Limited' warranty?", options: ["It has specific exclusions (like water).", "It lasts forever.", "It is free.", "It is for tablets."], correct_answer: "It has specific exclusions (like water).", rationale: "<b>Lesson: Legal Terminology.</b> A 'Full' warranty covers everything. A 'Limited' warranty has conditions and exclusions. The list of exclusions is what makes it limited.", standard: "RI.8.4", difficulty: 6 },
            { id: 'fw7', stem: "Tone of the document:", options: ["Formal and legalistic", "Friendly and casual", "Angry", "Funny"], correct_answer: "Formal and legalistic", rationale: "<b>Lesson: Tone.</b> The language is dry, precise, and objective ('obtain service,' 'voids,' 'defects'). This is the standard tone for legal documents.", standard: "RI.8.6", difficulty: 5 },
            { id: 'fw8', stem: "Antonym for 'Authorized' (in context of unauthorized):", options: ["Permitted/Official", "Illegal", "Fast", "Broken"], correct_answer: "Permitted/Official", rationale: "<b>Lesson: Antonyms.</b> Unauthorized means 'not allowed.' The opposite (Antonym) is 'Permitted' or 'Official.'", standard: "L.8.5", difficulty: 4 },
            { id: 'fw9', stem: "Who is the 'Repair Center' likely run by?", options: ["The Electro-Tab company", "A random shop", "The government", "A school"], correct_answer: "The Electro-Tab company", rationale: "<b>Lesson: Inference.</b> The warranty directs you to 'our' Repair Center, implying it is owned by the manufacturer (Electro-Tab).", standard: "RI.8.1", difficulty: 2 },
            { id: 'fw10', stem: "Genre classification:", options: ["Functional/Technical Document", "Persuasive Essay", "Memoir", "Science Fiction"], correct_answer: "Functional/Technical Document", rationale: "<b>Lesson: Genre.</b> This text has a specific job: to explain rules and procedures for a product. That makes it Functional/Technical.", standard: "RI.8.1", difficulty: 2 }
        ]
    },
    {
        id: 'lit-idiom-trip',
        passage: "<b>The Road Trip</b><br>I was <i>on the fence</i> about the trip. It would cost <i>an arm and a leg</i>, and my car was <i>on its last legs</i>. But when Mark said it was a 'once in a blue moon' chance, I decided to <i>bite the bullet</i> and go.",
        items: [
            { id: 'id1', stem: "The phrase 'on the fence' implies the narrator was:", options: ["Undecided", "Sitting on a wall", "In pain", "Excited"], correct_answer: "Undecided", rationale: "<b>Lesson: Idioms.</b> If you are on a fence, you haven't jumped to either side yet. It means you are stuck between two choices.", standard: "L.8.5.a", difficulty: 3 },
            { id: 'id2', stem: "What does 'cost an arm and a leg' mean?", options: ["Very expensive", "Physical injury", "Cheap", "Dangerous"], correct_answer: "Very expensive", rationale: "<b>Lesson: Idioms.</b> You value your limbs highly. To give them up would be a huge price. So, this means something costs a lot of money.", standard: "L.8.5.a", difficulty: 2 },
            { id: 'id3', stem: "If the car is 'on its last legs', it is:", options: ["Old and breaking down", "Brand new", "Fast", "Walking"], correct_answer: "Old and breaking down", rationale: "<b>Lesson: Personification/Idiom.</b> Cars don't have legs. This idiom compares the car to an exhausted animal about to collapse.", standard: "L.8.5.a", difficulty: 4 },
            { id: 'id4', stem: "'Bite the bullet' suggests the decision was:", options: ["Difficult or brave", "Tasty", "Easy", "Violent"], correct_answer: "Difficult or brave", rationale: "<b>Lesson: Idiom Origins.</b> Before anesthesia, soldiers bit on bullets during surgery to endure pain. This idiom means to endure something painful or difficult.", standard: "L.8.5.a", difficulty: 5 },
            { id: 'id5', stem: "Mark uses 'once in a blue moon' to convince the narrator that:", options: ["The opportunity is rare.", " The moon is blue.", "Night driving is safe.", "He likes colors."], correct_answer: "The opportunity is rare.", rationale: "<b>Lesson: Idioms.</b> A 'blue moon' (two full moons in a month) happens very rarely. This idiom highlights rarity.", standard: "L.8.5.a", difficulty: 3 },
            { id: 'id6', stem: "Narrator's initial attitude:", options: ["Hesitant/Reluctant", "Eager", "Angry", "Bored"], correct_answer: "Hesitant/Reluctant", rationale: "<b>Lesson: Inference.</b> Being 'on the fence' and worrying about cost shows hesitation. He wasn't eager to go at first.", standard: "RL.8.3", difficulty: 4 },
            { id: 'id7', stem: "Context Clue: Which phrase helps explain 'on the fence'?", options: ["'...But I decided to...'", "'...Mark said...'", "'...cost an arm...'", "'...car was...'"], correct_answer: "'...But I decided to...'", rationale: "<b>Lesson: Context Clues.</b> The word 'But' signals a shift. He was undecided (on the fence), BUT then he decided. The contrast defines the idiom.", standard: "L.8.4", difficulty: 6 },
            { id: 'id8', stem: "Tone of the passage:", options: ["Informal/Conversational", "Formal", "Scientific", "Tragic"], correct_answer: "Informal/Conversational", rationale: "<b>Lesson: Voice.</b> Using lots of idioms ('arm and a leg') makes the writing sound like a casual chat with a friend, not a formal essay.", standard: "RL.8.4", difficulty: 3 },
            { id: 'id9', stem: "Pun check: Is there a pun in this text?", options: ["No", "Yes, about legs", "Yes, about bullets", "Yes, about moons"], correct_answer: "No", rationale: "<b>Lesson: Puns vs. Idioms.</b> A pun plays on double meanings for humor. These are idioms (expressions), not wordplay jokes.", standard: "L.8.5", difficulty: 5 },
            { id: 'id10', stem: "Theme:", options: ["Taking risks despite hesitation", "Car safety", "Saving money", "Fences are uncomfortable"], correct_answer: "Taking risks despite hesitation", rationale: "<b>Lesson: Theme.</b> The story is about overcoming doubt ('bite the bullet') to seize a rare opportunity.", standard: "RL.8.2", difficulty: 4 }
        ]
    },
    {
        id: 'cross-storm-view',
        passage: "<b>Poem: The Fury</b><br>The wind howled a wolf's cry,<br>Shattering the silence,<br>Tearing the sky.<br><br><b>Diary: April 4th</b><br>The storm was loud. It broke a branch off the oak tree. I stayed inside and read a book until the rain stopped.",
        items: [
            { id: 'cr1', stem: "How does the Poem's structure differ from the Diary?", options: ["Stanzas/Lines vs Sentences/Paragraphs", "It is longer.", "It has dates.", "It has no words."], correct_answer: "Stanzas/Lines vs Sentences/Paragraphs", rationale: "<b>Lesson: Genre Structure.</b> Poems are built of lines and stanzas. Prose (like a diary) is built of sentences and paragraphs.", standard: "RL.8.5", difficulty: 2 },
            { id: 'cr2', stem: "The Poem's tone is ________, while the Diary is ________.", options: ["Dramatic/Intense; Factual/Calm", "Boring; Fun", "Calm; Scary", "Happy; Sad"], correct_answer: "Dramatic/Intense; Factual/Calm", rationale: "<b>Lesson: Tone Comparison.</b> The poem uses violent words ('shattering,' 'tearing') = Dramatic. The diary uses plain facts ('broke a branch') = Calm.", standard: "RL.8.9", difficulty: 5 },
            { id: 'cr3', stem: "The poem uses 'wolf's cry' (Metaphor) to emphasize:", options: ["The sound and danger of the wind", "That wolves are present", "The time of day", "The forest"], correct_answer: "The sound and danger of the wind", rationale: "<b>Lesson: Metaphor.</b> Comparing wind to a wolf suggests it is wild, loud, and dangerous/predatory.", standard: "RL.8.4", difficulty: 4 },
            { id: 'cr4', stem: "The Diary focuses on:", options: ["Events and actions", "Emotions only", "Rhyming", "Metaphors"], correct_answer: "Events and actions", rationale: "<b>Lesson: Content Focus.</b> The diary lists what happened: Storm broke branch -> I read book -> Rain stopped.", standard: "RL.8.5", difficulty: 3 },
            { id: 'cr5', stem: "Which text gives a better sense of the *feeling* of the storm?", options: ["The Poem", "The Diary", "Neither", "Both equal"], correct_answer: "The Poem", rationale: "<b>Lesson: Author's Intent.</b> Poetry is designed to evoke <i>emotion</i> and sensation. Diaries/Prose are often more about recording <i>facts</i>.", standard: "RL.8.9", difficulty: 6 },
            { id: 'cr6', stem: "Personification in the poem:", options: ["'Tearing the sky'", "'April 4th'", "'Read a book'", "'Oak tree'"], correct_answer: "'Tearing the sky'", rationale: "<b>Lesson: Personification.</b> Wind cannot physically grab and 'tear' the sky like a piece of paper. This gives the wind a violent, human-like action.", standard: "L.8.5", difficulty: 5 },
            { id: 'cr7', stem: "The 'Diary' is written in:", options: ["Prose", "Verse", "Stanzas", "Meter"], correct_answer: "Prose", rationale: "<b>Lesson: Literary Terms.</b> 'Prose' is ordinary writing (sentences/paragraphs) without a rhythmic structure. It is the opposite of verse/poetry.", standard: "RL.8.5", difficulty: 3 },
            { id: 'cr8', stem: "Shared topic:", options: ["A storm/Weather", "Wolves", "Reading", "Trees"], correct_answer: "A storm/Weather", rationale: "<b>Lesson: Synthesis.</b> Both texts describe the same event (a storm), but they use different tools to do it.", standard: "RL.8.9", difficulty: 1 },
            { id: 'cr9', stem: "The word 'Shattering' in the poem implies:", options: ["Violent breaking", "Quiet noise", "Fixing", "Helping"], correct_answer: "Violent breaking", rationale: "<b>Lesson: Connotation.</b> You shatter glass, not silence. Using 'shatter' for sound implies a noise so loud it feels like something physical is breaking.", standard: "L.8.5", difficulty: 4 },
            { id: 'cr10', stem: "Author's intent comparison:", options: ["Poet evokes emotion; Diarist records history.", "Poet wants to sell books; Diarist wants to sleep.", "Poet informs; Diarist entertains.", "No difference."], correct_answer: "Poet evokes emotion; Diarist records history.", rationale: "<b>Lesson: Purpose.</b> The poet wants you to <i>feel</i> the fear of the wind. The diarist wants to <i>remember</i> what they did that day.", standard: "RL.8.6", difficulty: 7 }
        ]
    },
    {
        id: 'lit-whitman-captain',
        passage: "O Captain! My Captain! by Walt Whitman: Our fearful trip is done... The ship has weather‚Äôd every rack... But O heart! heart! heart! ... Where on the deck my Captain lies, Fallen cold and dead.",
        items: [
            { id: 'w1', stem: "Who is the 'Captain' a metaphor for?", options: ["Abraham Lincoln", "George Washington", "Walt Whitman", "A pirate"], correct_answer: "Abraham Lincoln", rationale: "<b>Lesson: Historical Metaphor.</b> Whitman wrote this about the death of Lincoln. The Captain = Lincoln. The Ship = The USA.", standard: "RL.8.4", difficulty: 6 },
            { id: 'w2', stem: "The 'fearful trip' represents:", options: ["The Civil War", "A vacation", "A storm at sea", "A dream"], correct_answer: "The Civil War", rationale: "<b>Lesson: Symbolism.</b> If the ship is the country, the 'fearful trip' that almost destroyed it is the Civil War.", standard: "RL.8.4", difficulty: 7 },
            { id: 'w3', stem: "Mood shift in the poem:", options: ["Triumph to Grief", "Sadness to Joy", "Boredom to Anger", "Fear to Peace"], correct_answer: "Triumph to Grief", rationale: "<b>Lesson: Mood.</b> It starts with victory ('trip is done,' 'prize won') but shifts instantly to tragedy ('Fallen cold and dead').", standard: "RL.8.4", difficulty: 5 },
            { id: 'w4', stem: "Meaning of 'weather‚Äôd every rack'?", options: ["Survived every struggle", "Fixed the boat", "Ignored the wind", "Painted the ship"], correct_answer: "Survived every struggle", rationale: "<b>Lesson: Vocabulary.</b> To 'weather' a storm means to survive it. A 'rack' is a mass of storm clouds or strain. The country survived the strain of war.", standard: "L.8.4", difficulty: 6 },
            { id: 'w5', stem: "Part A: Narrator's emotional state?", options: ["Deep personal mourning", "Professional duty", "Excitement", "Indifference"], correct_answer: "Deep personal mourning", rationale: "<b>Lesson: Emotion.</b> The repetition of 'O heart! heart! heart!' mimics the throbbing of a breaking heart. It is personal and intense.", standard: "RL.8.1", difficulty: 6 },
            { id: 'w6', stem: "Part B: Quote for mourning?", options: ["'But O heart! heart! heart!'", "'The prize we sought is won'", "'The port is near'", "'Rise up and hear the bells'"], correct_answer: "'But O heart! heart! heart!'", rationale: "<b>Lesson: Evidence.</b> This is the emotional peak of the stanza, directly expressing the narrator's internal pain.", standard: "RL.8.1", difficulty: 5 },
            { id: 'w7', stem: "Significance of 'bells' and 'bugle'?", options: ["Celebrate victory", "Warn of danger", "Call for food", "Start a dance"], correct_answer: "Celebrate victory", rationale: "<b>Lesson: Context.</b> Bells and bugles are traditional sounds of celebration and military victory.", standard: "RL.8.4", difficulty: 5 },
            { id: 'w8', stem: "Contrasting images:", options: ["Bells ringing vs Fallen cold", "Ship moving vs Ship anchored", "Water vs Wood", "Sun vs Moon"], correct_answer: "Bells ringing vs Fallen cold", rationale: "<b>Lesson: Juxtaposition.</b> The poem contrasts the loud joy of the crowd (bells) with the silent stillness of the dead Captain.", standard: "RL.8.4", difficulty: 8 },
            { id: 'w9', stem: "Role of the Narrator:", options: ["A crew member", "The Captain", "A civilian on shore", "A ghost"], correct_answer: "A crew member", rationale: "<b>Lesson: POV.</b> He calls him 'My Captain' and is on the deck with him. He is a loyal follower/soldier.", standard: "RL.8.3", difficulty: 5 },
            { id: 'w10', stem: "Theme of loss in victory:", options: ["Great achievements often come with profound personal loss.", "Winning is the only thing that matters.", "Ships are safer than land.", "Captaincy is a dangerous job."], correct_answer: "Great achievements often come with profound personal loss.", rationale: "<b>Lesson: Theme.</b> The war is won (achievement), but the leader is dead (loss). The poem explores the bitter-sweet nature of this victory.", standard: "RL.8.2", difficulty: 9 }
        ]
    },
    {
        id: 'lit-london-wild',
        passage: "from The Call of the Wild by Jack London: Buck did not read the newspapers... He was king over all creeping, crawling, flying things of Judge Miller's place... He had a fine pride in himself, was even a trifle egotistical.",
        items: [
            { id: 'l1', stem: "Buck's status in his home:", options: ["Dominant and proud", "Afraid and hidden", "Lazy and hungry", "A working farm dog"], correct_answer: "Dominant and proud", rationale: "<b>Lesson: Characterization.</b> Being 'king' and having 'fine pride' shows he sees himself as the ruler of his domain.", standard: "RL.8.3", difficulty: 3 },
            { id: 'l2', stem: "Meaning of 'egotistical'?", options: ["Self-important", "Very fast", "Hungry", "Loud"], correct_answer: "Self-important", rationale: "<b>Lesson: Vocabulary.</b> Ego means 'I' or 'Self.' An egotistical person (or dog) thinks highly of themselves.", standard: "L.8.4", difficulty: 4 },
            { id: 'l3', stem: "Contrast between Buck and 'newspapers'?", options: ["He is unaware of the outside world's danger.", "He reads better than the judge.", "He is a famous dog.", "He delivers the mail."], correct_answer: "He is unaware of the outside world's danger.", rationale: "<b>Lesson: Dramatic Irony.</b> The reader knows the newspapers talk about the Gold Rush (where dogs are needed), but Buck doesn't. We know his fate; he doesn't.", standard: "RL.8.1", difficulty: 6 },
            { id: 'l4', stem: "Setting's initial tone:", options: ["Comfortable and peaceful", "Harsh and cold", "Busy city life", "Scary and dark"], correct_answer: "Comfortable and peaceful", rationale: "<b>Lesson: Setting.</b> 'Judge Miller's place' is a sunny, safe estate where Buck is king. This sets up the contrast for the harsh wilderness later.", standard: "RL.8.1", difficulty: 2 },
            { id: 'l5', stem: "Part A: Buck's personality?", options: ["Noble but naive", "Mean and aggressive", "Small and weak", "Intelligent and cautious"], correct_answer: "Noble but naive", rationale: "<b>Lesson: Character Flaw.</b> He is noble (King), but naive (unaware of the danger approaching). His confidence makes him vulnerable.", standard: "RL.8.3", difficulty: 5 },
            { id: 'l6', stem: "Part B: Quote for naivety?", options: ["'Buck did not read the newspapers.'", "'King over all...'", "'Fine pride...'", "'Sun-kissed Santa Clara Valley.'"], correct_answer: "'Buck did not read the newspapers.'", rationale: "<b>Lesson: Evidence.</b> Not reading the news is the literal reason he doesn't know danger is coming. It symbolizes his ignorance of the wider world.", standard: "RL.8.1", difficulty: 4 },
            { id: 'l7', stem: "Role of the 'Judge'?", options: ["Owner/Authority figure", "A literal judge of dogs", "A criminal", "Buck's father"], correct_answer: "Owner/Authority figure", rationale: "<b>Lesson: Context.</b> The Judge represents civilization and law. Buck lives in a world of rules and safety, which he is about to lose.", standard: "RL.8.3", difficulty: 4 },
            { id: 'l8', stem: "Point of View:", options: ["Third-person limited (Buck)", "First-person (Judge)", "Third-person omniscient", "Second-person"], correct_answer: "Third-person limited (Buck)", rationale: "<b>Lesson: POV.</b> The narrator is not Buck ('I'), but focuses entirely on Buck's thoughts and feelings. This is Third-Person Limited.", standard: "RL.8.6", difficulty: 7 },
            { id: 'l9', stem: "Meaning of 'trifle'?", options: ["Small amount", "Large meal", "Type of gun", "A dog toy"], correct_answer: "Small amount", rationale: "<b>Lesson: Vocabulary.</b> A 'trifle' is something of little value or size. Being a 'trifle' egotistical means being 'a little bit' full of yourself.", standard: "L.8.4", difficulty: 5 },
            { id: 'l10', stem: "Theme of protected life:", options: ["Comfort can leave one unprepared for harsh realities.", "Newspapers are only for humans.", "Dogs should never leave home.", "Kings are always safe."], correct_answer: "Comfort can leave one unprepared for harsh realities.", rationale: "<b>Lesson: Theme.</b> Buck's comfortable life ('King') makes him blind to the dangers of the real world. Civilization softens us.", standard: "RL.8.2", difficulty: 8 }
        ]
    },
    {
        id: 'boss-constitution',
        passage: `<h3 class="text-xl font-bold mb-2">BOSS LEVEL: The Preamble</h3>
        <p class="mb-4 text-center font-serif text-lg">"We the People of the United States, in Order to form a more perfect Union, establish Justice, insure domestic Tranquility, provide for the common defence, promote the general Welfare, and secure the Blessings of Liberty to ourselves and our Posterity, do ordain and establish this Constitution for the United States of America."</p>`,
        items: [
            { id: 'boss1', stem: "The phrase 'form a more perfect Union' implies that:", options: ["The previous government was flawed.", "Perfection is impossible.", "Unions are expensive.", "Math is perfect."], correct_answer: "The previous government was flawed.", rationale: "<b>Lesson: Historical Inference.</b> If you need to make something 'more' perfect, it means the current version (The Articles of Confederation) wasn't working. They are admitting past failure.", standard: "RI.8.3", difficulty: 8 },
            { id: 'boss2', stem: "What is the grammatical function of the capitalized words (Justice, Tranquility, Welfare)?", options: ["They are abstract concepts personified/emphasized.", "They are proper nouns (names of people).", "They are typos.", "They are verbs."], correct_answer: "They are abstract concepts personified/emphasized.", rationale: "<b>Lesson: Mechanics.</b> In the 18th century, writers capitalized important Nouns to show respect or emphasis. These are the core values of the nation.", standard: "L.8.2", difficulty: 9 },
            { id: 'boss3', stem: "Which phrase best matches the meaning of 'domestic Tranquility'?", options: ["Peace within the country", "Quiet houses", "No wars with other countries", "Sleeping pets"], correct_answer: "Peace within the country", rationale: "<b>Lesson: Vocabulary.</b> Domestic = At Home (inside the country). Tranquility = Peace. They wanted to stop rebellions and fighting inside America.", standard: "RI.8.4", difficulty: 7 },
            { id: 'boss4', stem: "The word 'Posterity' means:", options: ["Future generations/Descendants", "Posters", "The past", "Rich people"], correct_answer: "Future generations/Descendants", rationale: "<b>Lesson: Vocabulary.</b> Posterity comes from 'Post' (after). It refers to all the people who will come after us (children, grandchildren).", standard: "L.8.4", difficulty: 8 },
            { id: 'boss5', stem: "Tone Analysis: The tone of this single sentence is:", options: ["Authoritative and aspiring", "Sad and lonely", "Funny and light", "Confused"], correct_answer: "Authoritative and aspiring", rationale: "<b>Lesson: Tone.</b> The language is grand, serious, and hopeful ('Blessings,' 'Perfect Union'). It sounds like a powerful promise.", standard: "RI.8.6", difficulty: 6 },
            { id: 'boss6', stem: "Structure: The entire Preamble is one long sentence. This structure suggests:", options: ["Unity and continuous purpose.", "The author forgot periods.", "It is a list of groceries.", "Panic."], correct_answer: "Unity and continuous purpose.", rationale: "<b>Lesson: Syntax.</b> A single, unbroken sentence connects all the goals together. You cannot have 'Justice' without 'Liberty.' They are one united package.", standard: "L.8.3", difficulty: 9 },
            { id: 'boss7', stem: "The 'common defence' refers to:", options: ["Protecting the nation as a whole", "Building fences", "Self-defense classes", "Soccer goalies"], correct_answer: "Protecting the nation as a whole", rationale: "<b>Lesson: Context.</b> 'Common' here means 'shared by all.' The government protects everyone together (Army/Navy), not just individuals.", standard: "RI.8.1", difficulty: 5 },
            { id: 'boss8', stem: "By listing 'We the People' first, the authors establish:", options: ["Popular Sovereignty (power comes from people)", "That they are people", "A greeting", "A story"], correct_answer: "Popular Sovereignty (power comes from people)", rationale: "<b>Lesson: Author's Purpose.</b> They didn't say 'We the King' or 'We the Congress.' Placing 'People' first establishes that the citizens are the true source of power.", standard: "RI.8.6", difficulty: 7 },
            { id: 'boss9', stem: "Antonym for 'Tranquility':", options: ["Chaos/Turmoil", "Peace", "Sleep", "Water"], correct_answer: "Chaos/Turmoil", rationale: "<b>Lesson: Antonyms.</b> If Tranquility is calm and peace, the opposite is Chaos and Noise.", standard: "L.8.5", difficulty: 6 },
            { id: 'boss10', stem: "Central Idea:", options: [" The goals and purpose of the new government.", "War is bad.", "Liberty is a blessing.", "Writing laws is hard."], correct_answer: " The goals and purpose of the new government.", rationale: "<b>Lesson: Main Idea.</b> The Preamble is the introduction. Its job is to explain <i>why</i> the Constitution exists and <i>what</i> it aims to do.", standard: "RI.8.2", difficulty: 5 }
        ]
    },

// =================================================================
    // SECTION 4: VISUAL DATA & CHARTS (RI.8.7)
    // =================================================================
    {
        id: 'data-sleep-study',
        passage: `<h3 class="text-xl font-bold mb-2">Data Analysis: Teen Sleep Patterns</h3>
        <p class="mb-4">The following chart displays data collected from "District A" (which moved start times to 8:30 AM) versus "District B" (which stayed at 7:30 AM) over a one-year period.</p>
        
        <table class="w-full border-collapse border border-gray-400 mb-4 text-sm">
            <thead class="bg-indigo-100 dark:bg-gray-700">
                <tr>
                    <th class="border border-gray-400 p-2 text-left">Metric</th>
                    <th class="border border-gray-400 p-2 text-center">District A (8:30 Start)</th>
                    <th class="border border-gray-400 p-2 text-center">District B (7:30 Start)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="border border-gray-400 p-2">Avg. Math GPA</td>
                    <td class="border border-gray-400 p-2 text-center font-bold">3.2</td>
                    <td class="border border-gray-400 p-2 text-center">2.8</td>
                </tr>
                <tr>
                    <td class="border border-gray-400 p-2">Tardiness (per student/yr)</td>
                    <td class="border border-gray-400 p-2 text-center font-bold">2.1 days</td>
                    <td class="border border-gray-400 p-2 text-center">6.4 days</td>
                </tr>
                <tr>
                    <td class="border border-gray-400 p-2">Teen Car Accidents</td>
                    <td class="border border-gray-400 p-2 text-center font-bold">15</td>
                    <td class="border border-gray-400 p-2 text-center">42</td>
                </tr>
                <tr>
                    <td class="border border-gray-400 p-2">Reported Depression</td>
                    <td class="border border-gray-400 p-2 text-center font-bold">12%</td>
                    <td class="border border-gray-400 p-2 text-center">24%</td>
                </tr>
            </tbody>
        </table>
        <p class="text-xs italic">Source: National Center for Education Statistics (Simulated)</p>`,
        items: [
            { id: 'ds1', stem: "Based on the table, which conclusion is best supported by the data?", options: ["Later start times correlate with higher GPAs and fewer accidents.", "District B has smarter students.", "Start times have no effect on depression.", "District A has more car accidents."], correct_answer: "Later start times correlate with higher GPAs and fewer accidents.", rationale: "<b>Lesson: Interpreting Data.</b> Look at the columns: District A (Later Start) has a higher GPA (3.2 vs 2.8) and lower accidents (15 vs 42). The data supports the correlation.", standard: "RI.8.7", difficulty: 4 },
            { id: 'ds2', stem: "How much higher is the rate of reported depression in District B compared to District A?", options: ["Double (100% higher)", "Triple", "Half", "The same"], correct_answer: "Double (100% higher)", rationale: "<b>Lesson: Mathematical Analysis.</b> District B is 24%. District A is 12%. Since 12 x 2 = 24, the rate is double (or 100% higher).", standard: "RI.8.7", difficulty: 5 },
            { id: 'ds3', stem: "Which category shows the most dramatic difference between the two districts?", options: ["Tardiness", "Math GPA", "Lunch times", "Teacher names"], correct_answer: "Tardiness", rationale: "<b>Lesson: Identifying Trends.</b> Tardiness in District B (6.4) is more than 300% higher than District A (2.1). This is the largest relative gap in the chart.", standard: "RI.8.1", difficulty: 4 },
            { id: 'ds4', stem: "If a student wrote an argumentative essay claiming 'Early start times hurt student safety,' which data point would be the strongest evidence?", options: ["The car accident data (42 vs 15).", "The GPA data.", "The depression rates.", "The tardiness data."], correct_answer: "The car accident data (42 vs 15).", rationale: "<b>Lesson: Selecting Evidence.</b> Safety relates to physical harm. Car accidents are a direct safety issue, whereas GPA and tardiness are academic issues.", standard: "W.8.1.b", difficulty: 6 },
            { id: 'ds5', stem: "Does this chart prove that waking up early <i>causes</i> lower grades?", options: ["No, it shows a correlation, but other factors could be involved.", "Yes, absolutely.", "No, the grades are the same.", "Yes, District B is failing."], correct_answer: "No, it shows a correlation, but other factors could be involved.", rationale: "<b>Lesson: Correlation vs. Causation.</b> Charts show relationships (correlation), but they don't prove the cause. Maybe District A also has better teachers. Always be careful with the word 'cause.'", standard: "RI.8.8", difficulty: 8 }
        ]
    },
    {
        id: 'data-invasive-species',
        passage: `<h3 class="text-xl font-bold mb-2">Environmental Impact Report: Ash Trees vs EAB</h3>
        <p class="mb-4">The graph below represents the population decline of Ash Trees in a midwestern county following the detection of the Emerald Ash Borer in 2010.</p>
        
        <div class="mb-6 bg-gray-50 dark:bg-gray-700 p-4 border rounded-xl">
            <div class="flex items-end space-x-4 h-40 border-b-2 border-gray-400 pb-1">
                <div class="w-12 bg-green-500 text-center text-white text-xs pt-1" style="height: 90%">2010<br>50k</div>
                <div class="w-12 bg-green-500 text-center text-white text-xs pt-1" style="height: 80%">2012<br>45k</div>
                <div class="w-12 bg-yellow-500 text-center text-white text-xs pt-1" style="height: 50%">2014<br>25k</div>
                <div class="w-12 bg-red-500 text-center text-white text-xs pt-1" style="height: 20%">2016<br>10k</div>
                <div class="w-12 bg-red-600 text-center text-white text-xs pt-1" style="height: 5%">2018<br>2k</div>
            </div>
            <p class="text-xs font-bold mt-2">X-Axis: Year | Y-Axis: Healthy Ash Tree Population</p>
        </div>`,
        items: [
            { id: 'gr1', stem: "Between which two years did the most rapid decline in the tree population occur?", options: ["2012-2014", "2010-2012", "2016-2018", "2018-2020"], correct_answer: "2012-2014", rationale: "<b>Lesson: Analyzing Slopes.</b> Between 2012 and 2014, the population dropped by 20,000 trees (45k -> 25k). This is the steepest drop on the chart.", standard: "RI.8.7", difficulty: 5 },
            { id: 'gr2', stem: "What trend does the graph illustrate?", options: ["An exponential decline in the ash tree population.", "A steady increase in trees.", "A fluctuating population.", "No change."], correct_answer: "An exponential decline in the ash tree population.", rationale: "<b>Lesson: Trend Analysis.</b> The bars get shorter faster and faster until they are almost gone. This is a classic pattern of decline/extinction.", standard: "RI.8.7", difficulty: 4 },
            { id: 'gr3', stem: "By 2018, what percentage of the original 2010 population remained?", options: ["4% (2k out of 50k)", "50%", "10%", "0%"], correct_answer: "4% (2k out of 50k)", rationale: "<b>Lesson: Calculation.</b> 2,000 (Current) divided by 50,000 (Original) = 0.04, which is 4%.", standard: "RI.8.7", difficulty: 7 },
            { id: 'gr4', stem: "The color change in the bars (Green to Red) is likely a text feature intended to:", options: ["Signal danger/critical loss.", "Make it look pretty.", "Show the season changed to Autumn.", "Represent different tree types."], correct_answer: "Signal danger/critical loss.", rationale: "<b>Lesson: Visual Connotation.</b> Green usually means 'Good/Healthy' and Red means 'Danger/Stop.' The artist uses color to emotionally signal the crisis.", standard: "RI.8.5", difficulty: 3 },
            { id: 'gr5', stem: "If this graph accompanied the article 'The Green Invader', what purpose would it serve?", options: ["To provide quantitative proof of the EAB's destructive speed.", "To show what the beetles look like.", "To show the price of wood.", "To explain photosynthesis."], correct_answer: "To provide quantitative proof of the EAB's destructive speed.", rationale: "<b>Lesson: Synthesis.</b> The text explains *how* they kill; the graph explains *how many* they killed. Together, they provide a complete picture.", standard: "RI.8.7", difficulty: 5 }
        ]
    },

    // =================================================================
    // SECTION 5: ADVANCED LOGIC & VOCAB (The Final Gaps)
    // =================================================================
    {
        id: 'arg-fallacy-speech',
        passage: `<h3 class="text-xl font-bold mb-2">Town Hall Debate: The New Park</h3>
        <p class="mb-4"><b>Councilman Miller:</b> "We must build this new park! My opponent, Mr. Smith, hates fun. He probably hates children, too."</p>
        <p class="mb-4"><b>Mr. Smith:</b> "I don't hate children; I'm worried about the budget. If we spend millions on this park, we'll run out of money for roads. Then the roads will crumble, ambulances won't reach the hospital, and our town will collapse into chaos!"</p>
        <p class="mb-4"><b>Councilman Miller:</b> "The park is a good idea because it is the right thing to do. Everyone knows it's the right thing to do, so we must do it."</p>`,
        items: [
            { id: 'fal1', stem: "Councilman Miller's attack on Mr. Smith ('He probably hates children') is an example of which fallacy?", options: ["Ad Hominem (Attacking the person)", "Slippery Slope", "Circular Reasoning", "Bandwagon"], correct_answer: "Ad Hominem (Attacking the person)", rationale: "<b>Lesson: Logical Fallacies.</b> 'Ad Hominem' is Latin for 'against the man.' Miller attacks Smith's character (hating children) instead of addressing the budget argument.", standard: "RI.8.8", difficulty: 5 },
            { id: 'fal2', stem: "Mr. Smith's argument ('If we build the park... the town will collapse') is an example of:", options: ["Slippery Slope", "Ad Hominem", "Fact-based reasoning", "Irony"], correct_answer: "Slippery Slope", rationale: "<b>Lesson: Slippery Slope.</b> This fallacy assumes that one small step (building a park) will uncontrollably lead to an extreme disaster (chaos/death).", standard: "RI.8.8", difficulty: 6 },
            { id: 'fal3', stem: "Councilman Miller's second statement ('It's good because it's right...') demonstrates:", options: ["Circular Reasoning", "Expert Testimony", "Data Analysis", "Metaphor"], correct_answer: "Circular Reasoning", rationale: "<b>Lesson: Circular Reasoning.</b> He supports his claim ('It's a good idea') with the claim itself ('It's the right thing to do'), offering no actual evidence.", standard: "RI.8.8", difficulty: 7 },
            { id: 'fal4', stem: "Which sentence relies on 'Pathos' (Emotional Appeal) rather than logic?", options: ["'He probably hates children.'", "'I'm worried about the budget.'", "'We run out of money.'", "'The roads will crumble.'"], correct_answer: "'He probably hates children.'", rationale: "<b>Lesson: Pathos.</b> Accusing someone of hating children triggers an emotional response (anger/disgust) in the audience, bypassing their logic.", standard: "RI.8.6", difficulty: 4 },
            { id: 'fal5', stem: "How could Mr. Smith improve his argument?", options: ["By providing specific budget numbers instead of predicting chaos.", "By yelling louder.", "By calling Miller names.", "By agreeing with everything."], correct_answer: "By providing specific budget numbers instead of predicting chaos.", rationale: "<b>Lesson: Improving Arguments.</b> Strong arguments rely on Logos (facts/data). Specific numbers are harder to argue with than wild predictions.", standard: "W.8.1.b", difficulty: 6 }
        ]
    },
    {
        id: 'inf-pony-express',
        passage: `<h3 class="text-xl font-bold mb-2">The Pony Express</h3>
        <p class="mb-4"><b>1</b> Established in 1860, the Pony Express was a mail delivery service that used a relay of horse-mounted riders to carry messages across the American West. It reduced the time for messages to travel between the Atlantic and Pacific coasts to about 10 days.</p>
        <p class="mb-4"><b>2</b> Riders faced grueling conditions, including extreme weather and dangerous terrain. They changed horses every 10 miles at stations along the route. Despite its fame, the service only lasted 18 months. It was rendered obsolete practically overnight by the completion of the transcontinental telegraph line in 1861.</p>`,
        items: [
            { id: 'sum1', stem: "Which is the best <b>objective summary</b> of the passage?", options: ["The Pony Express was a fast mail service in 1860 that used relay riders, but it was quickly replaced by the telegraph.", "The Pony Express was the coolest way to deliver mail because horses are better than wires.", "Riders changed horses every 10 miles.", "It started in 1860."], correct_answer: "The Pony Express was a fast mail service in 1860 that used relay riders, but it was quickly replaced by the telegraph.", rationale: "<b>Lesson: Objective Summary.</b> A good summary includes the 'What' (Pony Express), 'When' (1860), and the 'Outcome' (replaced by telegraph), without personal opinions like 'coolest.'", standard: "RI.8.2", difficulty: 6 },
            { id: 'sum2', stem: "Why is the option 'Riders changed horses every 10 miles' a POOR summary?", options: ["It is a specific detail, not a central idea.", "It is false.", "It is too long.", "It is an opinion."], correct_answer: "It is a specific detail, not a central idea.", rationale: "<b>Lesson: Main Idea vs. Detail.</b> A summary covers the whole text. The 10-mile rule is just a tiny detail *within* the text.", standard: "RI.8.2", difficulty: 5 },
            { id: 'sum3', stem: "The word 'obsolete' in Paragraph 2 most nearly means:", options: ["Outdated/No longer in use", "Broken", "Expensive", "Faster"], correct_answer: "Outdated/No longer in use", rationale: "<b>Lesson: Context Clues.</b> The telegraph was faster and electronic, so the horse service was no longer needed. That is the definition of obsolete.", standard: "L.8.4", difficulty: 4 },
            { id: 'sum4', stem: "The phrase 'rendered obsolete practically overnight' emphasizes:", options: ["The speed of technological change.", "That the riders slept at night.", "That it happened in the dark.", "The slowness of horses."], correct_answer: "The speed of technological change.", rationale: "<b>Lesson: Rhetoric.</b> 'Overnight' is an exaggeration (Hyperbole) to show how shockingly fast technology can change the world.", standard: "RI.8.4", difficulty: 5 },
            { id: 'sum5', stem: "What caused the end of the Pony Express?", options: ["The invention of the telegraph.", "Lack of horses.", "Bad weather.", "Riders quit."], correct_answer: "The invention of the telegraph.", rationale: "<b>Lesson: Cause and Effect.</b> The text explicitly states it was obsolete due to the 'completion of the transcontinental telegraph line.'", standard: "RI.8.3", difficulty: 3 }
        ]
    },
    {
        id: 'voc-analogy-forge',
        passage: `<h3 class="text-xl font-bold mb-2">The Word Forge</h3>
        <p class="mb-4">Welcome to the forge, where words are hammered into relationships. To master the hammer, you must understand how concepts connect.<br><br><b>Equation 1:</b> Architect is to Blueprint as Author is to ________.<br><b>Equation 2:</b> Fragile is to Break as Flammable is to ________.<br><b>Equation 3:</b> <i>Cheap</i> implies low quality, while <i>Inexpensive</i> implies ________.</p>`,
        items: [
            { id: 'an1', stem: "Complete Equation 1: Architect : Blueprint :: Author : ?", options: ["Manuscript/Book", "Pen", "Library", "Reader"], correct_answer: "Manuscript/Book", rationale: "<b>Lesson: Analogies (Worker : Product).</b> An architect creates a blueprint (the plan). An author creates a manuscript (the text).", standard: "L.8.5.b", difficulty: 5 },
            { id: 'an2', stem: "Complete Equation 2: Fragile : Break :: Flammable : ?", options: ["Burn", "Fire", "Hot", "Wood"], correct_answer: "Burn", rationale: "<b>Lesson: Analogies (Adjective : Action).</b> If something is fragile, it is liable to break. If something is flammable, it is liable to burn.", standard: "L.8.5.b", difficulty: 6 },
            { id: 'an3', stem: "Analyze Equation 3: What is the nuance of 'Inexpensive'?", options: ["Low cost (neutral/positive connotation)", "Garbage", "Broken", "Free"], correct_answer: "Low cost (neutral/positive connotation)", rationale: "<b>Lesson: Connotation.</b> 'Cheap' sounds bad (low quality). 'Inexpensive' sounds neutral (it just doesn't cost much). Knowing the 'feeling' of a word is crucial.", standard: "L.8.5.c", difficulty: 6 },
            { id: 'an4', stem: "Analogy: Telescope : Stars :: Microscope : ?", options: ["Cells/Bacteria", "Eyes", "Lab", "Glass"], correct_answer: "Cells/Bacteria", rationale: "<b>Lesson: Analogies (Tool : Object).</b> You use a telescope to see stars. You use a microscope to see cells.", standard: "L.8.5.b", difficulty: 4 },
            { id: 'an5', stem: "Which pair expresses a 'Part to Whole' relationship?", options: ["Chapter : Book", "Book : Read", "Author : Write", "Library : Quiet"], correct_answer: "Chapter : Book", rationale: "<b>Lesson: Analogy Types.</b> A chapter is a physical piece of a book. The other options are Action relationships.", standard: "L.8.5.b", difficulty: 5 }
        ]
    },

    // =================================================================
    // SECTION 6: DRAMA & REFERENCE SKILLS (The Final Polish)
    // =================================================================
    {
        id: 'lit-drama-court',
        passage: `<h3 class="text-xl font-bold mb-2">Drama: The Verdict</h3>
        <p class="mb-4"><b>CAST:</b><br>JUDGE MILLER (60s, stern)<br>DEFENDANT (20s, nervous)<br>LAWYER (40s, confident)</p>
        <p class="mb-4"><b>[SCENE START]</b></p>
        <p class="mb-4"><b>JUDGE MILLER:</b> <i>[Pounds gavel violently]</i> Order! I will have order in this court! Counsel, approach the bench.</p>
        <p class="mb-4"><b>LAWYER:</b> <i>[Smoothing his tie, smiling slightly]</i> Of course, Your Honor. The evidence will speak for itself.</p>
        <p class="mb-4"><b>DEFENDANT:</b> <i>[Whispering to himself, wringing his hands]</i> They don't know. They can't know.</p>
        <p class="mb-4"><b>JUDGE MILLER:</b> The jury has reviewed the document. The timestamp on the security footage is indisputable.</p>
        <p class="mb-4"><b>LAWYER:</b> Exactly. Which is why my client asks for a dismissal.</p>
        <p class="mb-4"><b>JUDGE MILLER:</b> <i>[Raises an eyebrow]</i> Dismissal? On what grounds? The footage shows him entering the vault.</p>
        <p class="mb-4"><b>LAWYER:</b> <i>[Turns to the jury]</i> Entering, yes. But observe the shadow on the floor. <i>[He points dramatically]</i> That is not the shadow of a thief. It is the shadow of a hero trying to return what was stolen.</p>
        <p class="mb-4"><b>[LIGHTS FADE as the gallery gasps]</b></p>`,
        items: [
            { id: 'dr1', stem: "What is the primary purpose of the stage direction <i>[Pounds gavel violently]</i>?", options: ["To establish the Judge's authority and the tension of the scene.", "To show the gavel is broken.", "To make noise.", "To show the Judge is happy."], correct_answer: "To establish the Judge's authority and the tension of the scene.", rationale: "<b>Lesson: Stage Directions.</b> Directions tell the actor how to act. 'Violently' isn't just noise; it establishes the Judge's power and the high stress of the moment.", standard: "RL.8.5", difficulty: 3 },
            { id: 'dr2', stem: "How do the stage directions regarding the Defendant <i>[Whispering, wringing hands]</i> characterize him?", options: ["As anxious and possibly guilty.", "As confident.", "As angry.", "As sleepy."], correct_answer: "As anxious and possibly guilty.", rationale: "<b>Lesson: Characterization via Action.</b> 'Wringing hands' is a universal sign of anxiety. In a courtroom, this action suggests guilt or extreme fear.", standard: "RL.8.3", difficulty: 4 },
            { id: 'dr3', stem: "The Lawyer's dialogue in the final paragraph creates:", options: ["A plot twist/shift in perspective.", "A boring ending.", "Confusion about the time.", "A funny joke."], correct_answer: "A plot twist/shift in perspective.", rationale: "<b>Lesson: Plot Structure.</b> The Lawyer flips the narrative‚Äîthe client wasn't stealing, he was *returning*. This reversal is a classic plot twist.", standard: "RL.8.6", difficulty: 5 },
            { id: 'dr4', stem: "The phrase 'The evidence will speak for itself' is an example of:", options: ["Personification.", "Simile.", "Metaphor.", "Alliteration."], correct_answer: "Personification.", rationale: "<b>Lesson: Figurative Language.</b> Evidence is an inanimate object; it cannot speak. Giving it human abilities is Personification.", standard: "L.8.5", difficulty: 3 },
            { id: 'dr5', stem: "How does the structure of a script differ from a novel?", options: ["It relies on dialogue and stage directions rather than narration.", "It has no characters.", "It is always shorter.", "It rhymes."], correct_answer: "It relies on dialogue and stage directions rather than narration.", rationale: "<b>Lesson: Genre Structure.</b> A script is a blueprint for performance. It lacks the internal monologue/narration found in novels, relying entirely on what can be seen or heard.", standard: "RL.8.5", difficulty: 2 }
        ]
    },
    {
        id: 'voc-dict-entry',
        passage: `<h3 class="text-xl font-bold mb-2">Dictionary Entry: RESIGN</h3>
        <div class="bg-gray-100 dark:bg-gray-800 p-4 border-l-4 border-indigo-500 font-serif">
            <p class="mb-2"><b class="text-lg">re‚Ä¢sign</b> (verb)</p>
            <p class="mb-1"><b>1.</b> To voluntarily leave a job or other position.</p>
            <p class="mb-1"><b>2.</b> To give (something) over to another; to surrender.</p>
            <p class="mb-1"><b>3.</b> (re-sign) To sign a document again.</p>
            <p class="mb-1"><b>4.</b> <i>(often used with 'to')</i> To accept something as inevitable.</p>
        </div>
        <p class="mt-4"><b>Passage Excerpt:</b><br>"After realizing the storm would not pass, the captain <b>resigned</b> himself to a long, cold night at sea. He knew fighting the waves was useless."</p>`,
        items: [
            { id: 'dic1', stem: "Which definition of <b>resigned</b> matches the way it is used in the passage?", options: ["Definition 4", "Definition 1", "Definition 2", "Definition 3"], correct_answer: "Definition 4", rationale: "<b>Lesson: Multiple Meaning Words.</b> He is accepting the storm (the inevitable). He isn't quitting a job (Def 1) or signing a paper (Def 3).", standard: "L.8.4.c", difficulty: 5 },
            { id: 'dic2', stem: "If the sentence were 'The CEO decided to resign after the scandal,' which definition would apply?", options: ["Definition 1", "Definition 2", "Definition 3", "Definition 4"], correct_answer: "Definition 1", rationale: "<b>Lesson: Context Clues.</b> A CEO holds a job/position. Leaving that position matches Definition 1.", standard: "L.8.4.c", difficulty: 3 },
            { id: 'dic3', stem: "Which definition involves a contract?", options: ["Definition 3", "Definition 1", "Definition 2", "Definition 4"], correct_answer: "Definition 3", rationale: "<b>Lesson: Spelling Changes.</b> Note the hyphen in 're-sign' (Definition 3). It literally means to sign *again*.", standard: "L.8.4.c", difficulty: 2 },
            { id: 'dic4', stem: "What part of speech is 'resign'?", options: ["Verb", "Noun", "Adjective", "Adverb"], correct_answer: "Verb", rationale: "<b>Lesson: Parts of Speech.</b> The dictionary entry explicitly labels it '(verb)'. Always check the italicized label next to the word.", standard: "L.8.4.c", difficulty: 1 },
            { id: 'dic5', stem: "Synonym check: Which word best replaces 'resigned' in the passage context?", options: ["Accepted", "Quit", "Signed", "Fought"], correct_answer: "Accepted", rationale: "<b>Lesson: Synonyms.</b> Since Definition 4 is 'to accept,' the best synonym is 'Accepted.'", standard: "L.8.5", difficulty: 4 }
        ]
    },

    // =================================================================
    // SECTION 7: TECHNICAL DIAGRAMS (RI.8.7) - The "Visual" Gap
    // =================================================================
    {
        id: 'tech-elephant-diagram',
        passage: `<h3 class="text-xl font-bold mb-2">Technical Analysis: The Apparatus</h3>
        <p class="mb-4">The study tested cooperation using a "loose-string" apparatus. The diagram below illustrates the setup used to test whether elephants could coordinate their actions.</p>
        
        <div class="border-2 border-gray-800 p-6 bg-gray-50 rounded-xl mb-6 relative">
            <div class="flex justify-between mb-8 text-sm font-bold text-gray-600 uppercase">
                <span>Lane 1 (Elephant A)</span>
                <span>Lane 2 (Elephant B)</span>
            </div>
            
            <div class="h-4 w-full bg-gray-300 border-y-2 border-dashed border-gray-500 flex items-center justify-center mb-4">
                <span class="text-[10px] font-black tracking-widest text-gray-500">MESH BARRIER</span>
            </div>

            <div class="relative h-20 bg-blue-50 border border-blue-200 rounded-lg flex items-center justify-center shadow-inner">
                <div class="absolute w-full h-2 bg-red-500 rounded-full top-1/2 transform -translate-y-1/2"></div>
                <div class="absolute w-48 h-12 bg-white border-4 border-gray-700 shadow-xl flex items-center justify-center z-10">
                    <span class="font-black text-gray-800">SLIDING TABLE (Food)</span>
                </div>
            </div>
            <p class="text-xs text-center mt-2 italic">Figure 1. The rope is threaded through the table. If one end is pulled without the other, the rope pulls free.</p>
        </div>

        <p class="mb-4"><b>Procedure:</b> The table is placed out of reach. The elephants must pull both ends of the rope simultaneously to slide the table toward the barrier.</p>`,
        items: [
            { id: 'dia1', stem: "Based on Figure 1, what happens if Elephant A pulls the rope before Elephant B arrives?", options: ["The rope unthreads and the table stays stuck.", "The table moves to Elephant A.", "The rope breaks.", "The barrier falls down."], correct_answer: "The rope unthreads and the table stays stuck.", rationale: "<b>Lesson: Mechanical Logic.</b> The text caption says: 'If one end is pulled without the other, the rope pulls free.' The diagram shows the rope is merely threaded, not tied. Visual + Text = Answer.", standard: "RI.8.7", difficulty: 5 },
            { id: 'dia2', stem: "What is the purpose of the 'Mesh Barrier' shown in the diagram?", options: ["To prevent the elephants from grabbing the food directly without using the tool.", "To separate the two elephants.", "To hide the food.", "To protect the researchers."], correct_answer: "To prevent the elephants from grabbing the food directly without using the tool.", rationale: "<b>Lesson: Experimental Control.</b> The barrier ensures the elephants *must* use the rope system to solve the problem, proving their intelligence.", standard: "RI.8.3", difficulty: 4 },
            { id: 'dia3', stem: "How does the diagram clarify the text description of 'cooperation'?", options: ["It visually demonstrates that the task is physically impossible for a single subject.", "It shows how much the elephants weigh.", "It shows what food they ate.", "It shows the color of the rope."], correct_answer: "It visually demonstrates that the task is physically impossible for a single subject.", rationale: "<b>Lesson: Value of Diagrams.</b> Text says 'cooperation.' The diagram *shows* two separate lanes and one rope. You can see instantly that one elephant cannot reach both ends.", standard: "RI.8.7", difficulty: 6 },
            { id: 'dia4', stem: "If the table were bolted to the floor, how would that invalidate the experiment?", options: ["The elephants could not demonstrate 'pulling' behavior to get a reward.", "It would be too heavy.", "The rope would break.", "The elephants would climb it."], correct_answer: "The elephants could not demonstrate 'pulling' behavior to get a reward.", rationale: "<b>Lesson: Scientific Method.</b> The dependent variable is the movement of the table. If it can't move, you can't measure success.", standard: "RI.8.5", difficulty: 6 },
            { id: 'dia5', stem: "The caption 'Figure 1' helps the reader:", options: ["Connect the visual representation to the specific concept of the 'loose-string' mechanism.", "Know what page it is.", "Read faster.", "Ignore the picture."], correct_answer: "Connect the visual representation to the specific concept of the 'loose-string' mechanism.", rationale: "<b>Lesson: Text Features.</b> Captions bridge the gap between the image and the main text, explaining *what* you are looking at.", standard: "RI.8.5", difficulty: 2 }
        ]
    },
    {
        id: 'tech-map-route',
        passage: `<h3 class="text-xl font-bold mb-2">Visual Literacy: The Pony Express Route</h3>
        <p class="mb-4">The text states that the Pony Express reduced mail delivery time from 24 days to 10 days. The map below shows the terrain challenges riders faced.</p>
        
        <div class="bg-amber-50 p-6 rounded-xl border-2 border-amber-200 mb-6 relative overflow-hidden">
            <div class="absolute top-4 right-4 bg-white/80 p-2 text-[10px] border border-gray-400">
                <b>Legend:</b><br>‚õ∞Ô∏è Mountains<br>üèúÔ∏è Desert<br>üíß River
            </div>
            
            <div class="flex justify-between items-center text-sm font-bold mt-8 mb-4 relative z-10">
                <div class="text-center">St. Joseph<br>(Start)</div>
                <div class="h-1 bg-gray-400 flex-1 mx-2 relative">
                    <div class="absolute -top-6 left-1/4 text-center">‚õ∞Ô∏è<br><span class="text-[8px]">Rockies</span></div>
                    <div class="absolute -top-6 left-1/2 text-center">üèúÔ∏è<br><span class="text-[8px]">Great Basin</span></div>
                    <div class="absolute -top-6 left-3/4 text-center">‚õ∞Ô∏è<br><span class="text-[8px]">Sierra Nevada</span></div>
                </div>
                <div class="text-center">Sacramento<br>(End)</div>
            </div>
            <p class="text-xs text-center text-gray-500 italic">Total Distance: ~1,900 Miles</p>
        </div>`,
        items: [
            { id: 'map1', stem: "Based on the map, which geographic feature likely posed the greatest obstacle near the end of the route (Sacramento)?", options: ["The Sierra Nevada Mountains", "The Great Basin Desert", "The Mississippi River", "St. Joseph"], correct_answer: "The Sierra Nevada Mountains", rationale: "<b>Lesson: Spatial Awareness.</b> Look at the 'End' (Sacramento). The icon directly before it is '‚õ∞Ô∏è Sierra Nevada.'", standard: "RI.8.7", difficulty: 3 },
            { id: 'map2', stem: "How does the map support the text's claim that riders faced 'grueling conditions'?", options: ["It shows specific varied terrains (mountains, deserts) they had to traverse.", "It shows the date.", "It shows the price of mail.", "It shows the horses."], correct_answer: "It shows specific varied terrains (mountains, deserts) they had to traverse.", rationale: "<b>Lesson: Synthesis.</b> The text says 'grueling.' The map provides the *evidence* for that claim by showing deserts (heat) and mountains (cold/steep).", standard: "RI.8.7", difficulty: 5 },
            { id: 'map3', stem: "If a rider broke down in the 'Great Basin', where would they be on the journey?", options: ["Roughly halfway.", "At the very start.", "At the very end.", "In the ocean."], correct_answer: "Roughly halfway.", rationale: "<b>Lesson: Reading Visuals.</b> The Great Basin is visually located in the center of the timeline/route bar.", standard: "RI.8.7", difficulty: 4 },
            { id: 'map4', stem: "The 'Legend' is necessary to:", options: ["Decode the symbols used on the map.", "Make the map look official.", "List the names of the riders.", "Show the time."], correct_answer: "Decode the symbols used on the map.", rationale: "<b>Lesson: Legends.</b> A Legend (or Key) translates the symbols (like ‚õ∞Ô∏è) into words (Mountains). Without it, symbols are meaningless.", standard: "RI.8.5", difficulty: 2 },
            { id: 'map5', stem: "Contrast: A graph shows numbers; this map primarily shows:", options: ["Spatial/Geographic relationships.", "Time.", "Money.", "Population."], correct_answer: "Spatial/Geographic relationships.", rationale: "<b>Lesson: Media Types.</b> Maps are for *where* (Space). Graphs are for *how much* (Data). Timelines are for *when* (Time).", standard: "RI.8.7", difficulty: 4 }
        ]
    },

    // =================================================================
    // SECTION 8: PAIRED TEXTS & EVIDENCE QUALITY (The "Test Polish")
    // =================================================================
    {
        id: 'comp-lit-paired',
        passage: `<h3 class="text-xl font-bold mb-2">Paired Texts: The Move</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 text-sm">
            <div class="bg-blue-50 dark:bg-gray-700 p-3 rounded-lg">
                <b>Story A: "The Box"</b><br>
                I taped the last box shut. It sounded like a door slamming. My room‚Äîonce a collage of posters and memories‚Äîwas now just bare, beige walls. Mom popped her head in, smiling too brightly. "Think of it as a blank canvas!" she chirped. I forced a smile, but my stomach felt like it was full of rocks.
            </div>
            <div class="bg-orange-50 dark:bg-gray-700 p-3 rounded-lg">
                <b>Story B: "New Horizons"</b><br>
                The moving truck roared to life, a beast waking up. I sat on the porch, watching the neighborhood drift away. It was scary, sure, but the map in my pocket buzzed with potential. A new city meant a new me. No more 'Clumsy Carl.' I was ready to reinvent myself.
            </div>
        </div>`,
        items: [
            { id: 'pair1', stem: "How do the narrators' perspectives on moving differ?", options: ["Narrator A feels loss/dread; Narrator B feels hope/opportunity.", "Narrator A is happy; Narrator B is sad.", "Both are angry.", "Both are excited."], correct_answer: "Narrator A feels loss/dread; Narrator B feels hope/opportunity.", rationale: "<b>Lesson: Comparing Perspectives.</b> A describes 'stomach full of rocks' (Dread). B describes the map 'buzzing with potential' (Hope).", standard: "RL.8.6", difficulty: 5 },
            { id: 'pair2', stem: "What shared theme do both texts explore?", options: ["The emotional impact of leaving home.", "The difficulty of packing boxes.", "How to drive a truck.", "Mothers are annoying."], correct_answer: "The emotional impact of leaving home.", rationale: "<b>Lesson: Universal Themes.</b> Both stories are about the *feelings* associated with a major life transition (Moving).", standard: "RL.8.9", difficulty: 4 },
            { id: 'pair3', stem: "Compare the imagery: Story A's 'Door slamming' vs. Story B's 'Beast waking up'.", options: ["A implies an ending/closure; B implies a beginning/energy.", "Both imply noise.", "A implies happiness; B implies fear.", "They mean the same thing."], correct_answer: "A implies an ending/closure; B implies a beginning/energy.", rationale: "<b>Lesson: Imagery.</b> A door slam ends something (closure). A beast waking up starts something (energy/action).", standard: "RL.8.4", difficulty: 6 },
            { id: 'pair4', stem: "Which narrator is likely to adapt faster?", options: ["Narrator B", "Narrator A", "Neither", "The Mom"], correct_answer: "Narrator B", rationale: "<b>Lesson: Inference.</b> Narrator B is 'ready to reinvent' himself. This mindset leads to faster adaptation than Narrator A's dread.", standard: "RL.8.3", difficulty: 3 }
        ]
    },
    {
        id: 'ev-quality-lab',
        passage: `<h3 class="text-xl font-bold mb-2">Evidence Lab: Anecdotal vs. Empirical</h3>
        <p class="mb-4"><b>Claim:</b> "Crows are as intelligent as human toddlers."</p>
        <p class="mb-4"><b>Evidence A:</b> "My neighbor saw a crow drop a nut in the road so a car would crack it. That proves they are geniuses!"</p>
        <p class="mb-4"><b>Evidence B:</b> "A 2018 study by Oxford University tested 50 crows using multi-step puzzles. 80% of the crows solved the puzzle within 5 minutes, a rate comparable to 4-year-old humans."</p>`,
        items: [
            { id: 'ev1', stem: "Evidence A is an example of:", options: ["Anecdotal Evidence (Personal story)", "Empirical Evidence (Scientific data)", "Statistical Evidence", "Expert Testimony"], correct_answer: "Anecdotal Evidence (Personal story)", rationale: "<b>Lesson: Types of Evidence.</b> 'Anecdotal' means based on personal observation or a story ('My neighbor saw...'). It is generally the weakest form of proof.", standard: "RI.8.8", difficulty: 4 },
            { id: 'ev2', stem: "Why is Evidence B stronger than Evidence A?", options: ["It uses a controlled study with data (50 crows, 80% success), making it verifiable.", "It mentions Oxford.", "It is longer.", "It talks about puzzles."], correct_answer: "It uses a controlled study with data (50 crows, 80% success), making it verifiable.", rationale: "<b>Lesson: Evaluating Evidence.</b> Empirical evidence uses data and large sample sizes (50 crows). This is scientifically verifiable, unlike a single neighbor's story.", standard: "RI.8.8", difficulty: 6 },
            { id: 'ev3', stem: "What is a potential flaw (bias) in Evidence A?", options: ["The sample size is too small (one bird) and lacks control.", "Crows don't eat nuts.", "The neighbor is lying.", "Cars are dangerous."], correct_answer: "The sample size is too small (one bird) and lacks control.", rationale: "<b>Lesson: Bias/Sample Size.</b> You cannot judge an entire species based on *one* smart bird. That is a hasty generalization.", standard: "RI.8.8", difficulty: 5 }
        ]
    },
    {
        id: 'lit-tone-shift',
        passage: `<h3 class="text-xl font-bold mb-2">Tone Analysis: The Storm</h3>
        <p class="mb-4"><b>Version 1:</b> The rain tapped gently on the roof, a lullaby for the sleeping house. The clouds wrapped the moon in a soft, gray blanket.</p>
        <p class="mb-4"><b>Version 2:</b> The rain pounded the roof, an assault on the trembling house. The clouds smothered the moon, choking out the light.</p>`,
        items: [
            { id: 'tn1', stem: "How does the word 'smothered' in Version 2 change the meaning compared to 'wrapped' in Version 1?", options: ["It adds a violent, suffocating connotation.", "It means the same thing.", "It makes it sound warmer.", "It implies the moon is cold."], correct_answer: "It adds a violent, suffocating connotation.", rationale: "<b>Lesson: Connotation.</b> 'Wrapped' sounds cozy (like a blanket). 'Smothered' sounds violent (like a pillow over a face). One word changes the entire feeling.", standard: "RL.8.4", difficulty: 5 },
            { id: 'tn2', stem: "What is the tone of Version 1?", options: ["Peaceful/Comforting", "Violent/Threatening", "Sad/Depressed", "Angry"], correct_answer: "Peaceful/Comforting", rationale: "<b>Lesson: Tone.</b> Words like 'gently,' 'lullaby,' and 'soft' create a peaceful atmosphere.", standard: "RL.8.4", difficulty: 3 },
            { id: 'tn3', stem: "The author changed 'tapped' to 'pounded'. This shift primarily affects the:", options: ["Intensity and Mood", "Time of day", "Setting location", "Character names"], correct_answer: "Intensity and Mood", rationale: "<b>Lesson: Intensity.</b> 'Pounded' is a high-intensity verb; 'Tapped' is low-intensity. The shift changes the mood from calm to dangerous.", standard: "L.8.5", difficulty: 4 }
        ]
    },

    

    // NEW MISSION: RESEARCH SIMULATION (W.8.7 - Selecting Sources)
    // =================================================================
    {
        id: 'res-source-select',
        passage: `<h3 class="text-xl font-bold mb-2">Research Simulation: The Space Race</h3>
        <p class="mb-4"><b>Your Research Question:</b> "How did the invention of the microchip impact the outcome of the 1960s Space Race?"</p>
        <p class="mb-4"><b>Available Sources:</b></p>
        <ul class="list-none space-y-3 mb-4">
            <li class="bg-gray-100 dark:bg-gray-700 p-2 rounded"><b>Source 1:</b> A biography of Neil Armstrong focusing on his childhood.</li>
            <li class="bg-gray-100 dark:bg-gray-700 p-2 rounded"><b>Source 2:</b> An encyclopedia entry explaining how rocket fuel is made.</li>
            <li class="bg-gray-100 dark:bg-gray-700 p-2 rounded"><b>Source 3:</b> A tech journal article titled "Computing Power: How NASA Minimized Guidance Systems in 1966."</li>
            <li class="bg-gray-100 dark:bg-gray-700 p-2 rounded"><b>Source 4:</b> A blog post regarding "Why Aliens Built the Pyramids."</li>
        </ul>`,
        items: [
            { id: 'rs1', stem: "Which source is most relevant to answering the research question?", options: ["Source 3", "Source 1", "Source 2", "Source 4"], correct_answer: "Source 3", rationale: "<b>Lesson: Research Relevance.</b> Your question is about *Microchips* and the *Space Race*. Source 3 mentions 'Computing Power' and 'NASA.' It is the only match.", standard: "W.8.7", difficulty: 4 },
            { id: 'rs2', stem: "Why is Source 1 likely not useful for this specific question?", options: ["It focuses on the astronaut's personal life, not the technology.", "Neil Armstrong didn't go to space.", "It is too old.", "It is a biography."], correct_answer: "It focuses on the astronaut's personal life, not the technology.", rationale: "<b>Lesson: Scope.</b> A biography about childhood does not cover 1960s technology.", standard: "W.8.7", difficulty: 3 },
            { id: 'rs3', stem: "Source 4 should be rejected primarily because:", options: ["It lacks credibility and relevance (Blog/Conspiracy).", "It is too short.", "It is about pyramids.", "It is online."], correct_answer: "It lacks credibility and relevance (Blog/Conspiracy).", rationale: "<b>Lesson: Credibility.</b> Blogs about aliens are not reliable sources for historical research.", standard: "W.8.8", difficulty: 2 },
            { id: 'rs4', stem: "If you needed to broaden your research to include 'Economic Costs,' which search term would be best?", options: ["NASA budget 1960s vs USSR", "Space rockets cost", "Microchip price", "Neil Armstrong salary"], correct_answer: "NASA budget 1960s vs USSR", rationale: "<b>Lesson: Search Terms.</b> 'NASA budget' directly targets the economic aspect of the race.", standard: "W.8.8", difficulty: 5 },
            { id: 'rs5', stem: "Which information from Source 3 would be most valuable?", options: ["Data on how smaller computers allowed rockets to be lighter.", "The color of the rockets.", "The name of the author.", "The font used."], correct_answer: "Data on how smaller computers allowed rockets to be lighter.", rationale: "<b>Lesson: Data Extraction.</b> The weight/efficiency of rockets is the specific 'impact' your research question is asking for.", standard: "RI.8.1", difficulty: 5 }
        ]
    },

    {
        id: 'hist-bessie-coleman',
        passage: `<h3 class="text-xl font-bold mb-2">Historical File: Bessie Coleman</h3>
        <p class="mb-4"><b>Source:</b> <i>Harlem Renaissance Lives</i> (Released Item F1421)</p>
        <p class="mb-4">Coleman, Bessie (1892-1926), aviator, was born in Atlanta, Texas. She was seven when her father left his family to return to the Indian Territory (Oklahoma). The Coleman household was Baptist, and Bessie was an avid reader who became particularly interested in Booker T. Washington and Harriet Tubman. After high school, she studied for one semester at Langston Industrial College.</p>
        <p class="mb-4">Between 1912 and 1917, Coleman joined her brothers in Chicago, working as a manicurist. In 1917, she married Claude Glenn. It was during this time that her brother Johnny related World War I stories to her about women flying planes in France. She decided that this would be her ambition.</p>
        <p class="mb-4">Coleman was rejected by American aviation schools because of her race and sex. Robert Abbott, founder of the <i>Chicago Defender</i>, suggested she study aviation in France. Coleman learned French and sailed to Paris in 1920. She was the first African American woman to earn a pilot's license (1921).</p>
        <p class="mb-4">Upon returning to the U.S., she realized she needed more training to make a living. She returned to Europe to study stunt flying. In 1923, her engine stalled, and she crashed, suffering a broken leg and ribs. During her recuperation, she went on the lecture circuit. Newspapers reported she planned to establish a commercial passenger flight service. By 1924, she was performing at air shows in Texas and Massachusetts, widely known for her military-style flying outfit.</p>`,
        items: [
            { 
                id: 'bes1', 
                stem: "<b>TIMELINE CHALLENGE:</b> Which sequence correctly orders the events of Bessie Coleman's life?", 
                options: [
                    "1. Brother tells war stories -> 2. Rejected by US schools -> 3. Earns license in France -> 4. Becomes stunt pilot",
                    "1. Rejected by US schools -> 2. Becomes stunt pilot -> 3. Brother tells war stories -> 4. Earns license in France",
                    "1. Earns license in France -> 2. Brother tells war stories -> 3. Rejected by US schools -> 4. Becomes stunt pilot",
                    "1. Brother tells war stories -> 2. Becomes stunt pilot -> 3. Earns license in France -> 4. Rejected by US schools"
                ], 
                correct_answer: "1. Brother tells war stories -> 2. Rejected by US schools -> 3. Earns license in France -> 4. Becomes stunt pilot", 
                rationale: "<b>Lesson: Sequencing (RI.8.3).</b> The text establishes cause-and-effect: The brother's stories (Cause) led to her ambition. She applied to US schools but was rejected (Obstacle). This led her to France to get her license (Solution), after which she returned to become a stunt pilot.", 
                standard: "RI.8.3", 
                difficulty: 5 
            },
            { 
                id: 'bes2', 
                stem: "<b>EVIDENCE MATCH:</b> Which textual detail best supports the goal: <i>'Own a Commercial Airline Business'</i>?", 
                options: [
                    "\"Newspapers reported that she planned to establish a commercial passenger flight service.\"",
                    "\"Coleman then sought to become an accomplished stunt and exhibition pilot.\"",
                    "\"She thrilled crowds and became widely known for her flying outfit.\"",
                    "\"She studied manicuring at Burnham's School of Beauty Culture.\""
                ], 
                correct_answer: "\"Newspapers reported that she planned to establish a commercial passenger flight service.\"", 
                rationale: "<b>Lesson: Citing Evidence (RI.8.1).</b> To prove she wanted to own a business, you must find the quote that explicitly mentions a 'commercial passenger flight service.'", 
                standard: "RI.8.1", 
                difficulty: 4 
            },
            { 
                id: 'bes3', 
                stem: "Why did Coleman likely go on the 'lecture circuit' after her crash in 1923?", 
                options: [
                    "To maintain her income and fame while she physically recovered.",
                    "She was afraid to fly again.",
                    "She wanted to become a teacher.",
                    "She was ordered to do so by the government."
                ], 
                correct_answer: "To maintain her income and fame while she physically recovered.", 
                rationale: "<b>Lesson: Inference (RI.8.3).</b> The text says she lectured 'during her recuperation.' Since she couldn't fly (her job) due to broken bones, lecturing was a way to stay relevant and earn money until she could fly again.", 
                standard: "RI.8.3", 
                difficulty: 6 
            },
            { 
                id: 'bes4', 
                stem: "What role did Robert Abbott play in Coleman's success?", 
                options: [
                    "He suggested the alternative path (France) that allowed her to bypass American discrimination.",
                    "He taught her how to fly.",
                    "He built her first airplane.",
                    "He was her brother who told her war stories."
                ], 
                correct_answer: "He suggested the alternative path (France) that allowed her to bypass American discrimination.", 
                rationale: "<b>Lesson: Key Individuals (RI.8.3).</b> When American schools rejected her, Abbott provided the crucial advice ('study in France') that solved her problem.", 
                standard: "RI.8.3", 
                difficulty: 3 
            },
            { 
                id: 'bes5', 
                stem: "The author includes the detail about her 'military-style flying outfit' to show:", 
                options: [
                    "Her showmanship and how she crafted a public persona.",
                    "That she was actually in the army.",
                    "That it was cold in the plane.",
                    "That she liked the color green."
                ], 
                correct_answer: "Her showmanship and how she crafted a public persona.", 
                rationale: "<b>Lesson: Author's Purpose (RI.8.6).</b> Coleman wasn't in the military. She wore the uniform to look 'official' and daring, helping her become 'widely known' (famous) with the crowds.", 
                standard: "RI.8.6", 
                difficulty: 5 
            },

            {
        id: 'info-snowboarding',
        passage: `<h3 class="text-xl font-bold mb-2">A Beginner's Guide to Snowboarding</h3>
        <p class="mb-4"><b>Source:</b> <i>U.S. News & World Report</i> (Released Item F1525)</p>
        <p class="mb-4">So, are you getting as excited for the season as I am? Not only is snowboarding fun, but it's good for you, too. You can burn up to 400 or 500 calories an hour, and you work your entire body. I'm talking your legs (glutes, hamstrings, calves and especially your quads, as well as your core and back muscles). Snowboarding with your family is also a fun way to stay active and connected this winter.</p>
        <p class="mb-4">The best situation is learning on a mountain that's not pure ice and isn't too intimidating. Start by taking a few lessons or go with a friend who's a great teacher‚Äîand very patient. Hopefully this same friend also has extra gear for you and can show you the ropes for a day or two. If not, you can rent equipment at the mountain; they do a great job of telling you everything you need to get started.</p>
        <p class="mb-4">It's also worth mentioning that skiing and snowboarding are completely different. Skiers have four edges and two poles, and their legs face forward. Snowboarders, on the other hand, have two edges and no poles, and our legs face sideways.</p>`,
        items: [
            { 
                id: 'snow1', 
                stem: "In paragraph 3, how does the author mainly distinguish snowboarding from skiing?", 
                options: [
                    "By contrasting the equipment (poles vs. no poles) and body positioning.",
                    "By stating that skiing is harder to learn.",
                    "By suggesting that snowboarding burns more calories.",
                    "By claiming that skiing is more dangerous."
                ], 
                correct_answer: "By contrasting the equipment (poles vs. no poles) and body positioning.", 
                rationale: "<b>Lesson: Comparisons & Distinctions (RI.8.3).</b> The text explicitly contrasts the two: 'Skiers have four edges and two poles... Snowboarders... have two edges and no poles, and our legs face sideways.'", 
                standard: "RI.8.3", 
                difficulty: 3 
            },
            { 
                id: 'snow2', 
                stem: "Which piece of evidence best supports the idea that beginners should rely on experts or rental shops for gear?", 
                options: [
                    "\"...they do a great job of telling you everything you need to get started.\"",
                    "\"You can burn up to 400 or 500 calories an hour.\"",
                    "\"Snowboarding with your family is also a fun way to stay active.\"",
                    "\"Skiers have four edges and two poles.\""
                ], 
                correct_answer: "\"...they do a great job of telling you everything you need to get started.\"", 
                rationale: "<b>Lesson: Citing Evidence (RI.8.1).</b> This quote directly supports the connection between the novice (beginner) and the professional knowledge available at the rental shop.", 
                standard: "RI.8.1", 
                difficulty: 2 
            }
        ]
    },
    {
        id: 'hist-senate-records',
        passage: `<h3 class="text-xl font-bold mb-2">Saving Senate Records (1814)</h3>
        <p class="mb-4"><b>Source:</b> <i>Released Item FF429365088</i></p>
        <p class="mb-4">On a sweltering August day in 1814, word reached the Capitol that British forces had swept aside the defending American army at Bladensburg, Maryland, and would occupy Washington by dusk. The documentary record of the Senate's earliest years might have gone up in flames had it not been for the quick action of a 24-year-old clerk named Lewis Machen.</p>
        <p class="mb-4">Since 1789, Secretary of the Senate Samuel Otis had safeguarded the records. But Otis died in April 1814, leaving the collection vulnerable. Machen devised a plan. Assisted by a messenger named Tobias Simpson, Machen commandeered a wagon and began loading it with Senate papers. "I engaged in removing... all the Books and papers... which I considered of more value," he recalled.</p>
        <p class="mb-4">Machen headed southeast toward a family farm in Maryland. The Senate documents were safe. Decades later, in 1934, Congress established the National Archives to permanently protect such records.</p>`,
        items: [
            { 
                id: 'sen1', 
                stem: "<b>SEQUENCE ANALYSIS:</b> Which option correctly orders the events that led to the preservation of the documents?", 
                options: [
                    "1. Samuel Otis dies -> 2. British invade -> 3. Machen commandeers wagon -> 4. Documents moved to Maryland",
                    "1. British invade -> 2. Documents moved to Maryland -> 3. Samuel Otis dies -> 4. Machen commandeers wagon",
                    "1. Machen commandeers wagon -> 2. Samuel Otis dies -> 3. British invade -> 4. Documents moved to Maryland",
                    "1. Documents moved to Maryland -> 2. British invade -> 3. Samuel Otis dies -> 4. Machen commandeers wagon"
                ], 
                correct_answer: "1. Samuel Otis dies -> 2. British invade -> 3. Machen commandeers wagon -> 4. Documents moved to Maryland", 
                rationale: "<b>Lesson: Process & History (RH.6-8.3).</b> Otis dying (April) left the records unguarded. The invasion (August) created the threat. Machen then took the wagon (Action) and moved them to safety (Result).", 
                standard: "RH.6-8.3", 
                difficulty: 6 
            },
            { 
                id: 'sen2', 
                stem: "What is the author's main purpose in mentioning the specific date 'August 1814' and the 'sweltering' weather?", 
                options: [
                    "To establish the urgent and difficult context of the rescue mission.",
                    "To show that summer is the best time to move documents.",
                    "To blame the weather for the British invasion.",
                    "To suggest that Lewis Machen was on vacation."
                ], 
                correct_answer: "To establish the urgent and difficult context of the rescue mission.", 
                rationale: "<b>Lesson: Setting & Context (RH.6-8.1).</b> The details emphasize the chaotic, hot, and desperate conditions under which Machen had to act quickly.", 
                standard: "RH.6-8.1", 
                difficulty: 5 
            }
        ]
    },

    {
        id: 'sci-plate-tectonics',
        passage: `<h3 class="text-xl font-bold mb-2">Plate Tectonics: Moving and Shaking</h3>
        <p class="mb-4"><b>Source:</b> <i>National Geographic</i> (Released Item 5730_A)</p>
        <p class="mb-4">The plates make up Earth's outer shell, called the lithosphere. Churning currents in the molten rocks below propel them along like a jumble of conveyor belts in disrepair. Most geologic activity stems from the interplay where the plates meet or divide.</p>
        <p class="mb-4"><b>Convergent Boundaries:</b> Where plates serving landmasses collide, the crust crumples and buckles into mountain ranges. India and Asia crashed about 55 million years ago, slowly giving rise to the Himalaya, the highest mountain system on Earth. As the mash-up continues, the mountains get higher. Mount Everest, the highest point on Earth, may be a tiny bit taller tomorrow than it is today.</p>
        <p class="mb-4"><b>Divergent Boundaries:</b> In the oceans, magma from deep in the Earth's mantle rises toward the surface and pushes apart two or more plates. Mountains and volcanoes rise along the seam. The process renews the ocean floor and widens the giant basins.</p>
        <p class="mb-4"><b>Transform Boundaries:</b> The San Andreas Fault in California is an example of a transform boundary, where two plates grind past each other. These boundaries don't produce spectacular features like mountains, but the halting motion often triggers large earthquakes.</p>`,
        items: [
            { 
                id: 'plate1', 
                stem: "Which sentence from the article is based on a <b>reasoned judgment</b> rather than a strictly verifiable fact?", 
                options: [
                    "\"Mount Everest, the highest point on Earth, may be a tiny bit taller tomorrow than it is today.\"",
                    "\"The plates make up Earth's outer shell, called the lithosphere.\"",
                    "\"The San Andreas Fault in California is an example of a transform boundary.\"",
                    "\"Six of the majors are named for the continents embedded within them.\""
                ], 
                correct_answer: "\"Mount Everest, the highest point on Earth, may be a tiny bit taller tomorrow than it is today.\"", 
                rationale: "<b>Lesson: Fact vs. Judgment (RST.6-8.8).</b> Most sentences here are facts (names, definitions). The statement about Everest being taller 'tomorrow' is a scientific prediction/judgment based on the evidence that the crash is continuing.", 
                standard: "RST.6-8.8", 
                difficulty: 5 
            },
            { 
                id: 'plate2', 
                stem: "According to the text, what is the primary cause of the motion of Earth's plates?", 
                options: [
                    "Churning currents in the molten rocks below the lithosphere.",
                    "The weight of the oceans pushing down on the crust.",
                    "The gravitational pull of the moon.",
                    "The formation of the San Andreas Fault."
                ], 
                correct_answer: "Churning currents in the molten rocks below the lithosphere.", 
                rationale: "<b>Lesson: Cause & Effect (RST.6-8.1).</b> The text explicitly compares the 'churning currents' to 'conveyor belts' that propel the plates along.", 
                standard: "RST.6-8.1", 
                difficulty: 3 
            }
        ]
    },
    {
        id: 'sci-elephants',
        passage: `<h3 class="text-xl font-bold mb-2">Elephants Can Lend a Helping Trunk</h3>
        <p class="mb-4"><b>Source:</b> <i>Science Magazine</i> (Released Item VH057675)</p>
        <p class="mb-4">Elephants know when they need a helping hand‚Äîor rather, trunk. That's the conclusion of a study that tested the cooperative skills of Asian elephants in Thailand. Joshua Plotnik, a behavioral ecologist, adapted a classic experiment from the 1930s meant for chimps. Two animals are presented with food that can only be reached by pulling a rope. The catch: The rope is threaded through the platform so that if only one pulls, the rope comes loose and the food remains out of reach. They must pull together.</p>
        <p class="mb-4">The elephants learned quickly. In one variation, the partner elephant was released 45 seconds after the first. The first elephant would wait at the fence, holding its end of the rope but not pulling, until the partner arrived. \"They learned to do this faster than the chimpanzees,\" says Plotnik. \"They would stand there holding their end of the rope, just waiting.\" This suggests they understood that the partner was necessary for success.</p>`,
        items: [
            { 
                id: 'ele1', 
                stem: "<b>EXPERIMENTAL SEQUENCE:</b> Which option correctly orders the steps of the experiment described in the text?", 
                options: [
                    "1. Set up apparatus -> 2. Release elephants simultaneously -> 3. Delay release of partner -> 4. Observe waiting behavior",
                    "1. Observe waiting behavior -> 2. Delay release of partner -> 3. Set up apparatus -> 4. Release elephants simultaneously",
                    "1. Delay release of partner -> 2. Set up apparatus -> 3. Release elephants simultaneously -> 4. Observe waiting behavior",
                    "1. Set up apparatus -> 2. Observe waiting behavior -> 3. Release elephants simultaneously -> 4. Delay release of partner"
                ], 
                correct_answer: "1. Set up apparatus -> 2. Release elephants simultaneously -> 3. Delay release of partner -> 4. Observe waiting behavior", 
                rationale: "<b>Lesson: Scientific Process (RST.6-8.3).</b> The text implies a logical flow: First, the tool (rope/platform) is built. Then they test the basic task (pulling together). Then they introduce the variable (the delay). Finally, they observe the result (the waiting).", 
                standard: "RST.6-8.3", 
                difficulty: 6 
            },
            { 
                id: 'ele2', 
                stem: "Why does the author mention chimpanzees in paragraph 2?", 
                options: [
                    "To highlight the elephants' superior patience and cognitive speed in this specific task.",
                    "To suggest that chimpanzees are smarter than elephants.",
                    "To show that the experiment was originally designed for humans.",
                    "To explain why the rope broke."
                ], 
                correct_answer: "To highlight the elephants' superior patience and cognitive speed in this specific task.", 
                rationale: "<b>Lesson: Comparisons (RST.6-8.9).</b> The text says they learned 'faster than the chimpanzees' and inhibited pulling longer, emphasizing the elephants' impressive intelligence.", 
                standard: "RST.6-8.9", 
                difficulty: 4 
            }
        ]
    },
    {
        id: 'sci-ash-borer',
        passage: `<h3 class="text-xl font-bold mb-2">The Emerald Ash Borer</h3>
        <p class="mb-4"><b>Source:</b> <i>Dept. of Energy & Environmental Protection</i> (Released Item X0804)</p>
        <p class="mb-4">The emerald ash borer (EAB) is a small, green beetle belonging to a family known as the buprestids, or metallic wood boring beetles. Adult EABs are between 0.3 to 0.55 inches in length‚Äîsmall by most standards but large compared to other buprestids.</p>
        <p class="mb-4">During its life cycle, EAB undergoes a complete metamorphosis. It starts as an egg, becomes a larva (grub), changes to a pupa, and finally an adult. The larvae feed on the phloem (inner bark) and cambium of the tree, which is what causes the damage.</p>
        <p class="mb-4">EAB is not native to North America. It was first found in 2002 near Detroit, Michigan. It likely arrived on woody packaging materials. Movement of ash wood, particularly firewood and logs, has been cited as a likely means by which EAB has spread to 12 states. Strict regulations have been initiated to prevent moving these materials from infested areas.</p>`,
        items: [
            { 
                id: 'eab1', 
                stem: "Why does the author include the detail that EAB was 'first found in 2002' and 'not native to North America'?", 
                options: [
                    "To explain why the infestation is a relatively new and rapidly spreading problem.",
                    "To prove that beetles cannot survive in cold weather.",
                    "To suggest that the beetle was created in a laboratory.",
                    "To argue that ash trees are not native to North America."
                ], 
                correct_answer: "To explain why the infestation is a relatively new and rapidly spreading problem.", 
                rationale: "<b>Lesson: Author's Purpose (RST.6-8.6).</b> By establishing that it isn't native and arrived recently (2002), the author explains why strict regulations are needed now‚Äîit's an invasive species spreading unchecked.", 
                standard: "RST.6-8.6", 
                difficulty: 5 
            },
            { 
                id: 'eab2', 
                stem: "According to the text, which human activity has most assisted the EAB in its spread?", 
                options: [
                    "Moving firewood, logs, and nursery stock from place to place.",
                    "Planting too many ash trees in cities.",
                    "Using metallic pesticides.",
                    "Building wooden houses."
                ], 
                correct_answer: "Moving firewood, logs, and nursery stock from place to place.", 
                rationale: "<b>Lesson: Cause & Effect (RST.6-8.1).</b> The text explicitly states: 'Movement of ash... in the form of firewood... has been cited as a likely means by which EAB has been assisted in its spread.'", 
                standard: "RST.6-8.1", 
                difficulty: 2 
            }
        ]
    },

    {
        id: 'sci-edison',
        passage: `<h3 class="text-xl font-bold mb-2">The Incredible Talking Machine</h3>
        <p class="mb-4"><b>Source:</b> <i>Released Item VF891434</i></p>
        <p class="mb-4">The invention of the phonograph made Thomas Edison world-famous, but it took him years to understand what it did best. In 1877, Edison and his assistants invented the first machine for recording and playing back sounds. They thought it would be used to reproduce the human voice, perhaps as a 'voice writer' or 'portable teacher,' but they had no clear idea of its exact purpose.</p>
        <p class="mb-4">Edison once said, \"Anything that won't sell, I don't want to invent.\" But he was a better inventor than salesman. He disapproved of popular music, dismissing jazz as something for \"the nuts.\" Eventually, competitors like the Victor Talking Machine Co. emerged. Victor built a stable of musical stars, while Edison refused to pay the royalties necessary to recruit them.</p>
        <p class="mb-4">In the 1920s, Edison refused to adopt radio, disliking its sound quality. By the time he relented, it was too late. His company ceased production shortly after the 1929 stock market crash.</p>`,
        items: [
            { 
                id: 'ed1', 
                stem: "Which statement best explains the irony of Edison's connection to the music industry?", 
                options: [
                    "He invented the technology that made recorded music possible, yet he personally disliked popular music.",
                    "He loved jazz music but couldn't invent a machine to play it.",
                    "He was a better salesman than he was an inventor.",
                    "He made millions of dollars from radio sales in 1920."
                ], 
                correct_answer: "He invented the technology that made recorded music possible, yet he personally disliked popular music.", 
                rationale: "<b>Lesson: Connections & Distinctions (RST.6-8.1).</b> The text highlights the conflict: He created the machine (phonograph) but hated the content (jazz/dance music) that made it popular.", 
                standard: "RST.6-8.1", 
                difficulty: 5 
            },
            { 
                id: 'ed2', 
                stem: "What caused Edison's company to fall behind competitors like the Victor Talking Machine Co.?", 
                options: [
                    "Edison's refusal to pay royalties for musical stars.",
                    "Edison's machine was too expensive to build.",
                    "The Victor machine was the first to use electricity.",
                    "Edison retired before the company was successful."
                ], 
                correct_answer: "Edison's refusal to pay royalties for musical stars.", 
                rationale: "<b>Lesson: Cause & Effect (RI.8.3).</b> The text explicitly states: 'Victor built a stable of notable musical artists. Edison remained unwilling to pay royalty advances necessary to recruit stars.'", 
                standard: "RI.8.3", 
                difficulty: 4 
            }
        ]
    },
        ]
    }
]; // <--- CLOSING BRACKET for the itemBank array

const allMissions = [
        // ==========================================
        // SECTOR 1: FOUNDATIONS (Level 1)
        // Focus: Key Ideas, Vocab, Basic Grammar
        // ==========================================
        { 
            id: 'm-confetti', 
            passageId: 'rok-lit-confetti', 
            title: 'The Root Cellar', 
            description: 'RL.8.1: Inference Engine', 
            minLevel: 1, 
            sticker: 'üìö' 
        },
        { 
            id: 'm-snow', 
            passageId: 'info-snowboarding', // UPDATED to New Passage
            title: 'Alpine Protocol', 
            description: 'RI.8.3: Comparative Analysis', 
            minLevel: 1, 
            sticker: 'üèÇ' 
        },
        { 
            id: 'm-grammar', 
            passageId: 'lang-editor-desk', 
            title: 'The Editor\'s Desk', 
            description: 'L.8.1: Grammar Gauntlet', 
            minLevel: 1, 
            sticker: 'üìù' 
        },
        { 
            id: 'm-tortilla', 
            passageId: 'rok-lit-tortilla', 
            title: 'The Lost Balloon', 
            description: 'RL.8.4: Metaphor Logic', 
            minLevel: 1, 
            sticker: 'üéà' 
        },
        { 
            id: 'm-silver', 
            passageId: 'lit-silver-garbage', 
            title: 'Garbage King', 
            description: 'RL.8.5: Hyperbole Scanner', 
            minLevel: 1, 
            sticker: 'üóëÔ∏è' 
        },

        // ==========================================
        // SECTOR 2: INTERMEDIATE (Level 2)
        // Focus: Poetry, Structure, Historical Sequence
        // ==========================================
        { 
            id: 'm-senate', 
            passageId: 'hist-senate-records', // NEW IAR MISSION
            title: 'The Archive', 
            description: 'RH.6-8.3: Process Sequence', 
            minLevel: 2, 
            sticker: 'üìú' 
        },
        { 
            id: 'm-logic', 
            passageId: 'inf-elephant-master', 
            title: 'Pachyderm Logic', 
            description: 'RI.8.8: Empathy Research', 
            minLevel: 2, 
            sticker: 'üêò' 
        },
        { 
            id: 'm-keys', 
            passageId: 'lit-balabad-matrix', 
            title: 'Balabad Secrets', 
            description: 'RL.8.3: Keeper of Keys', 
            minLevel: 2, 
            sticker: 'üóùÔ∏è' 
        },
        { 
            id: 'm-road', 
            passageId: 'lit-frost-road', 
            title: 'Yellow Woods', 
            description: 'RL.8.4: Poetry & Frost', 
            minLevel: 2, 
            sticker: 'üçÇ' 
        },
        { 
            id: 'm-vocab', 
            passageId: 'voc-roots-lab', 
            title: 'The Root Lab', 
            description: 'L.8.4: Latin & Greek Roots', 
            minLevel: 2, 
            sticker: 'üß™' 
        },
        { 
            id: 'm-dickinson', 
            passageId: 'lit-dickinson-hope', 
            title: 'Soul Perch', 
            description: 'RL.8.2: Dickinson\'s Hope', 
            minLevel: 2, 
            sticker: 'üïäÔ∏è' 
        },
        { 
            id: 'm-paw', 
            passageId: 'lit-jacobs-paw', 
            title: 'Three Wishes', 
            description: 'RL.8.3: Mood & Tension', 
            minLevel: 2, 
            sticker: 'üêí' 
        },
        { 
            id: 'm-tagore', 
            passageId: 'lit-tagore-boats', 
            title: 'Paper Boats', 
            description: 'RL.8.6: Tagore\'s Voice', 
            minLevel: 2, 
            sticker: '‚õµ' 
        },
        { 
            id: 'm-write', 
            passageId: 'wrt-urban-garden', 
            title: 'The Newsroom', 
            description: 'W.8.2: Editing Strategy', 
            minLevel: 2, 
            sticker: 'üì∞' 
        },
        { 
            id: 'm-punct', 
            passageId: 'lang-punct-lab', 
            title: 'Code Breaker', 
            description: 'L.8.2: Punctuation Lab', 
            minLevel: 2, 
            sticker: 'üìü' 
        },
        { 
            id: 'm-func', 
            passageId: 'func-warranty', 
            title: 'The Warranty', 
            description: 'RI.8.5: Functional Text', 
            minLevel: 2, 
            sticker: 'üõ°Ô∏è' 
        },

        // ==========================================
        // SECTOR 3: ADVANCED (Level 3)
        // Focus: Science Standards, Complex History, Argument
        // ==========================================
        { 
            id: 'm-tectonic', 
            passageId: 'sci-plate-tectonics', // NEW IAR MISSION
            title: 'Seismic Shift', 
            description: 'RST.6-8.8: Fact vs. Judgment', 
            minLevel: 3, 
            sticker: 'üåã' 
        },
        { 
            id: 'm-bessie', 
            passageId: 'hist-bessie-coleman', // NEW IAR MISSION
            title: 'The Aviator', 
            description: 'RI.8.3: Historical Sequence', 
            minLevel: 3, 
            sticker: '‚úàÔ∏è' 
        },
        { 
            id: 'm-captain', 
            passageId: 'lit-whitman-captain', 
            title: 'Port of Call', 
            description: 'RL.8.2: Whitman & Lincoln', 
            minLevel: 3, 
            sticker: '‚öì' 
        },
        { 
            id: 'm-wild', 
            passageId: 'lit-london-wild', 
            title: 'Northern Pride', 
            description: 'RL.8.3: Call of the Wild', 
            minLevel: 3, 
            sticker: 'üêæ' 
        },
        { 
            id: 'm-wild-boot', 
            passageId: 'bio-strayed-wild', 
            title: 'Lost Boot', 
            description: 'RI.8.3: Memoir Resilience', 
            minLevel: 3, 
            sticker: 'ü•æ' 
        },
        { 
            id: 'm-bio', 
            passageId: 'bio-douglass', 
            title: 'Freedom Reader', 
            description: 'RI.8.3: Narrative Nonfiction', 
            minLevel: 3, 
            sticker: 'üïØÔ∏è' 
        },
        { 
            id: 'm-tech', 
            passageId: 'tech-drone-manual', 
            title: 'Drone Manual', 
            description: 'RI.8.5: Technical Procedures', 
            minLevel: 3, 
            sticker: 'üöÅ' 
        },
        { 
            id: 'm-conflict', 
            passageId: 'inf-conflict-zoo', 
            title: 'The Zoo Debate', 
            description: 'RI.8.9: Conflicting Views', 
            minLevel: 3, 
            sticker: 'ü¶Å' 
        },
        { 
            id: 'm-satire', 
            passageId: 'lit-satire-lunch', 
            title: 'Mystery Loaf', 
            description: 'RL.8.6: Satire & Tone', 
            minLevel: 3, 
            sticker: 'ü§¢' 
        },
        { 
            id: 'm-idiom', 
            passageId: 'lit-idiom-trip', 
            title: 'Idiom Island', 
            description: 'L.8.5: Figurative Language', 
            minLevel: 3, 
            sticker: 'üèùÔ∏è' 
        },
        { 
            id: 'm-shakur', 
            passageId: 'lit-shakur-rose', 
            title: 'Concrete Rose', 
            description: 'RL.8.4: Tupac\'s Symbolism', 
            minLevel: 3, 
            sticker: 'üåπ' 
        },
        { 
            id: 'm-lottery', 
            passageId: 'lit-jackson-lottery', 
            title: 'The Black Box', 
            description: 'RL.8.6: Irony & Tradition', 
            minLevel: 3, 
            sticker: 'ü™®' 
        },
        { 
            id: 'm-analogy', 
            passageId: 'voc-analogy-forge', 
            title: 'Word Forge', 
            description: 'L.8.5: Analogies & Nuance', 
            minLevel: 3, 
            sticker: 'üî®' 
        },
        { 
            id: 'm-drama', 
            passageId: 'lit-drama-court', 
            title: 'The Verdict', 
            description: 'RL.8.5: Stage Directions', 
            minLevel: 3, 
            sticker: 'üé≠' 
        },
        { 
            id: 'm-dict', 
            passageId: 'voc-dict-entry', 
            title: 'The Lexicon', 
            description: 'L.8.4.c: Dictionary Skills', 
            minLevel: 3, 
            sticker: 'üìñ' 
        },
        { 
            id: 'm-tone', 
            passageId: 'lit-tone-shift', 
            title: 'Tone Tuner', 
            description: 'RL.8.4: Word Nuance', 
            minLevel: 3, 
            sticker: 'üé®' 
        },

        // ==========================================
        // SECTOR 4: MASTERY (Level 4)
        // Focus: Gothic Lit, Scientific Experiment, Media
        // ==========================================
        { 
            id: 'm-elephant', 
            passageId: 'sci-elephants', // NEW IAR MISSION
            title: 'The Trunk Lab', 
            description: 'RST.6-8.3: Experiment Steps', 
            minLevel: 4, 
            sticker: 'üß™' 
        },
        { 
            id: 'm-heart', 
            passageId: 'lit-poe-heart', 
            title: 'Dreadful Paces', 
            description: 'RL.8.6: Gothic Reliability', 
            minLevel: 4, 
            sticker: 'üíì' 
        },
        { 
            id: 'm-cask', 
            passageId: 'lit-poe-cask', 
            title: 'The Catacombs', 
            description: 'RL.8.6: Unreliable Narrator', 
            minLevel: 4, 
            sticker: 'üß±' 
        },
        { 
            id: 'm-argue', 
            passageId: 'arg-school-start', 
            title: 'The Debate Stage', 
            description: 'RI.8.8: Argument & Claims', 
            minLevel: 4, 
            sticker: '‚öñÔ∏è' 
        },
        { 
            id: 'm-media', 
            passageId: 'media-shark-week', 
            title: 'Shark Signal', 
            description: 'RI.8.7: Video vs Text', 
            minLevel: 4, 
            sticker: 'ü¶à' 
        },
        { 
            id: 'm-cross', 
            passageId: 'cross-storm-view', 
            title: 'Storm Chaser', 
            description: 'RL.8.5: Poem vs Prose', 
            minLevel: 4, 
            sticker: 'üå™Ô∏è' 
        },
        { 
            id: 'm-research', 
            passageId: 'res-source-select', 
            title: 'The Fact Checker', 
            description: 'W.8.7: Source Selection', 
            minLevel: 4, 
            sticker: 'üóÇÔ∏è' 
        },
        { 
            id: 'm-data-sleep', 
            passageId: 'data-sleep-study', 
            title: 'Sleep Lab Data', 
            description: 'RI.8.7: Interpreting Tables', 
            minLevel: 4, 
            sticker: 'üìä' 
        },
        { 
            id: 'm-data-trees', 
            passageId: 'data-invasive-species', 
            title: 'Forest Stats', 
            description: 'RI.8.7: Graph Analysis', 
            minLevel: 4, 
            sticker: 'üìâ' 
        },
        { 
            id: 'm-fallacy', 
            passageId: 'arg-fallacy-speech', 
            title: 'The Campaign', 
            description: 'RI.8.8: Logical Fallacies', 
            minLevel: 4, 
            sticker: 'üó≥Ô∏è' 
        },
        { 
            id: 'm-summary', 
            passageId: 'inf-pony-express', 
            title: 'The Briefing', 
            description: 'RI.8.2: Objective Summary', 
            minLevel: 4, 
            sticker: 'üêé' 
        },
        { 
            id: 'm-tech-diag', 
            passageId: 'tech-elephant-diagram', 
            title: 'Lab Schematics', 
            description: 'RI.8.7: Technical Diagrams', 
            minLevel: 4, 
            sticker: 'üìê' 
        },
        { 
            id: 'm-tech-map', 
            passageId: 'tech-map-route', 
            title: 'Route 66', 
            description: 'RI.8.7: Map Analysis', 
            minLevel: 4, 
            sticker: 'üó∫Ô∏è' 
        },
        { 
            id: 'm-dual-core', 
            passageId: 'comp-lit-paired', 
            title: 'Dual Core', 
            description: 'RL.8.9: Paired Fiction', 
            minLevel: 4, 
            sticker: '‚ôä' 
        },
        { 
            id: 'm-ev-rank', 
            passageId: 'ev-quality-lab', 
            title: 'Evidence Ranker', 
            description: 'RI.8.8: Anecdotal vs. Data', 
            minLevel: 4, 
            sticker: '‚öñÔ∏è' 
        },

        // ==========================================
        // SECTOR 5: THE CORE (Level 5)
        // Focus: Technology, Synthesis, The Boss
        // ==========================================
        { 
            id: 'm-edison', 
            passageId: 'sci-edison', // NEW IAR MISSION
            title: 'Frequency Lab', 
            description: 'RST.6-8.1: Tech History', 
            minLevel: 5, 
            sticker: 'üìª' 
        },
        { 
            id: 'm-compare', 
            passageId: 'lit-myth-remix', 
            title: 'Myth vs. Machine', 
            description: 'RL.8.9: Modern Prometheus', 
            minLevel: 5, 
            sticker: '‚ö°' 
        },
        { 
            id: 'm-rhet', 
            passageId: 'rhet-speech-liberty', 
            title: 'The Podium', 
            description: 'L.8.5: Rhetorical Devices', 
            minLevel: 5, 
            sticker: 'üéôÔ∏è' 
        },
        { 
            id: 'm-borer', 
            passageId: 'sci-ash-borer', // UPDATED to New Passage & Moved to Level 5
            title: 'Bio-Threat', 
            description: 'RST.6-8.6: Invasive Species', 
            minLevel: 5, 
            sticker: 'ü™≤' 
        },
        // THE BOSS
        { 
            id: 'm-boss', 
            passageId: 'boss-constitution', 
            title: 'üî¥ SYSTEM CORE', 
            description: 'BOSS: The Preamble', 
            minLevel: 5, 
            sticker: 'üèõÔ∏è' 
        }
    ];

        // --- DASHBOARD & NAVIGATION ---
        function navigate(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            const target = document.getElementById(screenId);
            if(target) target.classList.remove('hidden');
            gameState.currentScreen = screenId;
            window.scrollTo(0,0);
        }

        async function showModal(title, message, type = 'info') {
            const backdrop = document.getElementById('modal-backdrop');
            const box = document.getElementById('modal-box');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').innerHTML = message;
            box.className = `bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-md w-full text-center border-t-8 border-${type === 'success' ? 'green' : (type === 'error' ? 'red' : 'blue')}-500 transition-all duration-300`;
            backdrop.classList.remove('hidden');
            return new Promise(resolve => {
                document.getElementById('modal-ok-btn').onclick = () => {
                    backdrop.classList.add('hidden');
                    resolve();
                };
            });
        }

        // --- ADAPTIVE SYSTEM ---
        function getDifficultyTag(diff) {
            if (diff <= 4) return '<span class="difficulty-tag diff-low">Foundation</span>';
            if (diff <= 7) return '<span class="difficulty-tag diff-med">Standard</span>';
            return '<span class="difficulty-tag diff-high">Legendary</span>';
        }

function selectNextQuestion(mData) {
    // FIX: Strictly select the next question in the list based on the index.
    // This prevents the "infinite loop" where it picks the same question twice.
    if (gameState.currentQuestionIndex >= mData.items.length) return null;
    return mData.items[gameState.currentQuestionIndex];
}

        // --- PROFILE ---
        function renderProfile() {
            document.getElementById('profile-avatar').textContent = gameState.user.avatar;
            document.getElementById('profile-rank').textContent = gameState.user.elaLevel === 3 ? "Legend" : (gameState.user.elaLevel === 2 ? "Scholar" : "Rookie");
            document.getElementById('profile-tokens').textContent = gameState.user.tokens;
            document.getElementById('profile-level').textContent = gameState.user.level;
            
            let totalQ = 0; let totalC = 0;
            Object.values(gameState.user.standardsReport).forEach(s => { totalQ += s.total; totalC += s.correct; });
            const acc = totalQ > 0 ? Math.round((totalC / totalQ) * 100) : 0;
            document.getElementById('profile-accuracy').textContent = acc + '%';

            const grid = document.getElementById('standards-grid');
            grid.innerHTML = '';
            Object.keys(gameState.user.standardsReport).forEach(std => {
                const data = gameState.user.standardsReport[std];
                const percent = Math.round((data.correct / data.total) * 100);
                grid.innerHTML += `<div><div class="flex justify-between text-[10px] font-black mb-1 uppercase dark:text-gray-400"><span>${std}</span><span>${percent}%</span></div><div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"><div class="h-full bg-indigo-500" style="width: ${percent}%"></div></div></div>`;
            });

            const hList = document.getElementById('history-list');
            hList.innerHTML = '';
            [...gameState.user.history].reverse().forEach(h => {
                if(!h.missionTitle) return;
                hList.innerHTML += `<div class="p-3 bg-white dark:bg-gray-700 rounded-xl border border-gray-100 dark:border-gray-600 flex justify-between items-center text-sm dark:text-white"><div><span class="font-bold block">${h.missionTitle}</span><span class="text-[10px] text-gray-500">${h.date}</span></div><span class="font-black text-indigo-600">${h.score}</span></div>`;
            });
            navigate('profile-screen');
        }

        // --- SHOP ---
        function switchShopTab(tab) {
            gameState.currentShopTab = tab;
            document.querySelectorAll('#shop-screen button[id^="tab-"]').forEach(btn => {
                btn.classList.remove('shop-tab-active');
                btn.classList.add('text-gray-500');
            });
            document.getElementById(`tab-${tab}`).classList.add('shop-tab-active');
            renderShop();
        }

function renderShop() {
    // 1. Update the Token Counter in the Shop Header
    const tokenDisplay = document.getElementById('shop-token-display');
    if (tokenDisplay) tokenDisplay.textContent = gameState.user.tokens;

    // 2. Target the existing Grid in your HTML
    const grid = document.getElementById('shop-grid');
    if (!grid) {
        console.error("Error: 'shop-grid' element not found.");
        return;
    }
    grid.innerHTML = '';

    // 3. Determine which Tab is active (Avatars, Stickers, or Items)
    const tab = gameState.currentShopTab || 'avatars';
    
    // 4. Update Tab Buttons Visuals
    ['avatars', 'stickers', 'items'].forEach(t => {
        const btn = document.getElementById(`tab-${t}`);
        if(btn) {
            if(t === tab) {
                btn.className = "px-6 py-3 font-bold uppercase tracking-widest border-b-4 border-pink-500 text-pink-600";
            } else {
                btn.className = "px-6 py-3 font-bold uppercase tracking-widest text-gray-400 hover:text-pink-400";
            }
        }
    });

    const items = shopCatalog[tab];

    // 5. Render the items for that tab
    if (items && items.length > 0) {
        items.forEach(item => {
            // Check Ownership
            let isOwned = false;
            let quantity = 0;

            if (tab === 'avatars') {
                isOwned = gameState.user.avatars.includes(item.id);
            } else if (tab === 'stickers') {
                // Crates are never "owned" (you can always buy more)
                if (item.type !== 'crate') {
                    isOwned = gameState.user.stickers.includes(item.icon);
                }
            } else if (tab === 'items') {
                // Items show quantity instead of "Owned"
                quantity = gameState.user.inventory[item.key] || 0;
            }

            // Visual Styles
            const btnClass = isOwned 
                ? 'bg-slate-100 dark:bg-slate-800 opacity-60 cursor-not-allowed border-slate-200' 
                : 'bg-white dark:bg-slate-800 border-pink-500 shadow-[0_4px_0_0_rgba(236,72,153,1)] hover:translate-y-1 hover:shadow-none cursor-pointer';

            // Card HTML
            const card = document.createElement('div');
            card.className = `${btnClass} border-2 rounded-2xl p-4 flex flex-col items-center justify-between transition-all relative group h-40`;
            
            // Click Logic
            if (!isOwned || item.type === 'crate') {
                card.onclick = () => buyItem(item.id);
            }

            // Content
            let statusLabel = "";
            if (isOwned && item.type !== 'crate') statusLabel = '<span class="text-green-500 font-bold">OWNED</span>';
            else if (tab === 'items') statusLabel = `<span class="text-indigo-500 font-bold">${item.cost} ü™ô (Have: ${quantity})</span>`;
            else statusLabel = `<span class="text-pink-600 font-bold">${item.cost} ü™ô</span>`;

            card.innerHTML = `
                <div class="text-4xl mb-2">${item.icon}</div>
                <div class="text-center w-full">
                    <div class="font-bold text-xs uppercase tracking-wider text-slate-700 dark:text-slate-300 truncate w-full mb-1">
                        ${item.name}
                    </div>
                    <div class="font-mono text-xs">
                        ${statusLabel}
                    </div>
                </div>
                ${isOwned && item.type !== 'crate' ? '<div class="absolute top-2 right-2 text-green-500 text-lg">‚úì</div>' : ''}
            `;

            grid.appendChild(card);
        });
    } else {
        grid.innerHTML = `<div class="col-span-full text-center text-gray-400 py-10 italic">No items found in this section.</div>`;
    }

    // 6. Navigate to the screen
    navigate('shop-screen');
}

async function buyItem(id) {
            // Find item in any category
            let item = null;
            let category = '';
            
            for (const cat in shopCatalog) {
                const found = shopCatalog[cat].find(i => i.id === id);
                if (found) {
                    item = found;
                    category = cat;
                    break;
                }
            }

            if (!item) return;

            if (gameState.user.tokens < item.cost) {
                await showModal("Insufficient Funds", "You need more Tokens to purchase this item.", 'error');
                return;
            }

            // CHECK OWNERSHIP (Prevent double buying avatars/stickers)
            if (category === 'avatars' && gameState.user.avatars.includes(item.id)) {
                await showModal("Already Owned", "You already have this avatar!", 'info');
                return;
            }
            if (category === 'stickers' && item.type !== 'crate' && gameState.user.stickers.includes(item.icon)) {
                await showModal("Already Owned", "You already have this sticker!", 'info');
                return;
            }

            // DEDUCT COST
            gameState.user.tokens -= item.cost;

            // HANDLE PURCHASE TYPES
            if (category === 'avatars') {
                gameState.user.avatars.push(item.id);
                await showModal("Purchase Successful", `Avatar <b>${item.name}</b> added to profile!`, 'success');
            } 
            else if (category === 'stickers') {
                if (item.type === 'crate') {
                    // CRATE LOGIC: Pick a random sticker they don't have
                    const allShopStickers = shopCatalog.stickers.filter(s => s.type !== 'crate');
                    const unowned = allShopStickers.filter(s => !gameState.user.stickers.includes(s.icon));
                    
                    if (unowned.length === 0) {
                        gameState.user.tokens += item.cost; // Refund
                        await showModal("Sold Out", "You already own all shop stickers!", 'info');
                        return;
                    }
                    
                    const prize = unowned[Math.floor(Math.random() * unowned.length)];
                    gameState.user.stickers.push(prize.icon);
                    triggerConfetti();
                    await showModal("CRATE OPENED!", `You found: <span class="text-4xl">${prize.icon}</span><br><b>${prize.name}</b>`, 'success');
                } else {
                    // STANDARD STICKER LOGIC
                    gameState.user.stickers.push(item.icon);
                    await showModal("Purchase Successful", `Sticker added to collection!`, 'success');
                }
            } 
            else if (category === 'items') {
                if (!gameState.user.inventory[item.key]) gameState.user.inventory[item.key] = 0;
                gameState.user.inventory[item.key]++;
                await showModal("Item Acquired", `<b>${item.name}</b> added to inventory.`, 'success');
            }

            saveProgress();
            updateUI();
            renderShop(); // Refresh shop to update buttons
        }

        // --- MISSIONS ---
// --- MISSIONS & ZONES ---
        function switchZone(zone) {
            gameState.currentZone = zone;
            renderMissions();
        }

function renderMissions() {
    // 1. Update Tab Visuals
    for(let i=1; i<=5; i++) {
        const btn = document.getElementById(`zone-btn-${i}`);
        if (i === gameState.currentZone) {
            btn.className = "flex-shrink-0 px-6 py-3 rounded-full font-black uppercase tracking-widest transition-all transform scale-105 bg-indigo-600 text-white shadow-lg shadow-indigo-500/30 ring-2 ring-indigo-300";
        } else {
            const isLocked = gameState.user.level < i;
            btn.className = `flex-shrink-0 px-6 py-3 rounded-full font-bold uppercase tracking-widest transition-all border-2 ${isLocked ? 'bg-gray-100 dark:bg-gray-900 text-gray-300 border-transparent cursor-not-allowed' : 'bg-white dark:bg-gray-800 text-gray-500 hover:text-indigo-500 border-gray-200 dark:border-gray-700'}`;
        }
    }

    const list = document.getElementById('missions-list');
    list.innerHTML = '';
    
    const zoneMissions = allMissions.filter(m => m.minLevel === gameState.currentZone);

    if (zoneMissions.length === 0) {
        list.innerHTML = `<div class="col-span-full text-center py-20 opacity-40"><div class="text-6xl mb-4">üî≠</div><p class="font-bold">Sector Empty.</p></div>`;
        return;
    }

    // Safety check for data
    if (!gameState.user.completedIds) gameState.user.completedIds = [];
    if (!gameState.user.missionBestScores) gameState.user.missionBestScores = {};

    zoneMissions.forEach(m => {
        const isLocked = gameState.user.level < m.minLevel;
        const isCompleted = gameState.user.completedIds.includes(m.id);
        const hasSticker = gameState.user.stickers.includes(m.sticker);
        const isBoss = m.id === 'm-boss';
        
        // RETRIEVE SCORE
        const bestScore = gameState.user.missionBestScores[m.id] || null;

        const card = document.createElement('button');
        
        let baseClass = "btn-3d relative text-left p-6 rounded-3xl border-2 transition-all overflow-hidden group h-full flex flex-col justify-between ";
        
        if (isBoss) {
            baseClass += isLocked 
                ? "bg-slate-800 border-slate-700 text-slate-500 opacity-80" 
                : "bg-gradient-to-br from-red-600 to-rose-700 border-red-500 text-white shadow-[0_8px_0_0_#9f1239]";
        } else if (isCompleted) {
            baseClass += "bg-emerald-50 dark:bg-emerald-900/20 border-emerald-400 dark:border-emerald-600 shadow-[0_4px_0_0_#10b981] dark:shadow-none";
        } else {
            baseClass += isLocked
                ? "bg-slate-50 border-slate-200 text-slate-400 opacity-70"
                : "bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 hover:border-indigo-400 shadow-[0_8px_0_0_#cbd5e1] dark:shadow-[0_8px_0_0_#0f172a]";
        }
        
        card.className = baseClass;
        
        const icon = isCompleted ? '‚úÖ' : (isLocked ? 'üîí' : (isBoss ? 'üëπ' : 'üìç'));
        const stickerDisplay = hasSticker ? `<div class="absolute top-4 right-4 text-4xl drop-shadow-md animate-pulse-slow">${m.sticker}</div>` : '';
        
        // SCORE DISPLAY LOGIC
        // If we have a score, show it. If not, but it's completed, show "Done".
        let scoreHtml = '';
        if (isCompleted) {
             if (bestScore) {
                 scoreHtml = `<span class="ml-2 bg-white/50 dark:bg-black/20 px-2 py-1 rounded text-[10px] font-black uppercase tracking-widest text-emerald-700 dark:text-emerald-300 border border-emerald-200 dark:border-emerald-700">Score: ${bestScore}</span>`;
             } else {
                 scoreHtml = `<span class="ml-2 bg-emerald-200/50 px-2 py-1 rounded text-[10px] font-black uppercase tracking-widest text-emerald-700">Done</span>`;
             }
        }

        card.innerHTML = `
            ${stickerDisplay}
            <div>
                <div class="flex justify-between items-start mb-4">
                    <span class="text-[10px] font-black uppercase tracking-widest px-2 py-1 rounded bg-black/5 dark:bg-white/10 ${isBoss ? 'text-white' : 'text-slate-500 dark:text-slate-300'}">
                        ${m.description.split(':')[0]}
                    </span>
                </div>
                <h3 class="text-xl font-black uppercase tracking-tight leading-6 mb-2 ${isBoss ? 'text-white' : 'text-slate-800 dark:text-white'}">${m.title}</h3>
                <p class="text-xs font-bold ${isBoss ? 'text-red-200' : 'text-slate-400'}">${m.description.split(':')[1] || 'Objective'}</p>
            </div>
            
            <div class="mt-6 pt-4 border-t ${isBoss ? 'border-white/20' : 'border-slate-100 dark:border-slate-700'} flex justify-between items-center">
                <div class="flex items-center">
                    <span class="text-2xl">${icon}</span>
                    ${scoreHtml}
                </div>
                ${!isLocked ? '<span class="text-xs font-black uppercase tracking-widest text-indigo-500 group-hover:translate-x-1 transition-transform">' + (isCompleted ? 'Replay ‚Ü∫' : 'Start ‚Üí') + '</span>' : ''}
            </div>
        `;

        if (!isLocked) card.onclick = () => startMission(m.id);
        list.appendChild(card);
    });
    navigate('missions-screen');
}

function startMission(id) {
    gameState.currentMission = allMissions.find(m => m.id === id);
    gameState.currentQuestionIndex = 0;
    gameState.missionScore = 0;
    gameState.consecutiveCorrect = 0;
    
    // NEW: Track answers for the Back Button functionality
    gameState.missionAnswers = {}; // Stores { 0: 'Option A', 1: 'Option B' }
    
    navigate('game-play-screen');
    startTimer(); 
    renderInventory();
    renderMissionQ();
}

function renderMissionQ() {
            const mData = itemBank.find(i => i.id === gameState.currentMission.passageId);
            
            // FIXED: Use the ACTUAL number of questions in the passage, no arbitrary limit
            const realTotal = mData.items.length;

            // Safety check for end of mission
            if (gameState.currentQuestionIndex >= realTotal) { 
                endMission(realTotal); 
                return; 
            }

            const q = mData.items[gameState.currentQuestionIndex];
            
            // Update Header Stats
            document.getElementById('game-title').textContent = gameState.currentMission.title;
            document.getElementById('mission-score-display').textContent = gameState.missionScore;
            
            // Render Passage
            document.getElementById('game-passage').innerHTML = `
                <div class="mb-6 pb-6 border-b border-slate-200 dark:border-slate-700">
                    <span class="bg-indigo-100 text-indigo-700 text-[10px] font-black uppercase tracking-widest px-2 py-1 rounded">Source Material</span>
                </div>
                <div class="font-serif text-lg leading-loose text-slate-800 dark:text-slate-200">
                    ${mData.passage}
                </div>
            `;
            
            // Review Mode Check
            const previousAnswer = gameState.missionAnswers[gameState.currentQuestionIndex];
            const isReviewMode = previousAnswer !== undefined;

            // Randomize Options
            const displayOptions = [...q.options].sort(() => Math.random() - 0.5);

            // --- BOSS HEALTH BAR LOGIC ---
            const isBoss = gameState.currentMission.id === 'm-boss';
            let topVisuals = '';

            if (isBoss) {
                // Calculate Health %
                const currentHP = realTotal - gameState.currentQuestionIndex;
                const percentHP = (currentHP / realTotal) * 100;
                
                topVisuals = `
                    <div class="boss-container">
                        <div class="flex justify-between px-4 py-2 absolute w-full z-10">
                            <span class="font-black text-white uppercase tracking-widest drop-shadow-md">‚ö†Ô∏è GLITCH ENTITY</span>
                            <span class="font-mono font-bold text-white drop-shadow-md">${currentHP} / ${realTotal}</span>
                        </div>
                        <div class="health-fill" style="width: ${percentHP}%"></div>
                    </div>
                `;
            } else {
                // STANDARD UI + COMBO BAR
                let streakBadge = '';
                if (gameState.consecutiveCorrect >= 2) {
                    streakBadge = `
                        <div class="mb-4 bg-amber-100 border-l-4 border-amber-500 p-3 flex justify-between items-center animate-pulse">
                            <span class="font-black text-amber-700 uppercase tracking-widest">
                                üî• Streak: ${gameState.consecutiveCorrect}
                            </span>
                            <span class="text-xs font-bold text-amber-600">
                                ${gameState.consecutiveCorrect >= 3 ? '3x Multiplier!' : '2x Multiplier!'}
                            </span>
                        </div>
                    `;
                }

                topVisuals = `
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-xs font-mono text-slate-400 bg-slate-100 dark:bg-slate-900 px-2 py-1 rounded">STD: ${q.standard}</span>
                        <div class="flex gap-3">
                            <span class="text-xs font-black uppercase tracking-widest text-indigo-500">
                                Q: ${gameState.currentQuestionIndex + 1} / ${realTotal}
                            </span>
                            <span class="text-xs font-black uppercase tracking-widest ${q.difficulty > 6 ? 'text-red-500' : 'text-green-500'}">
                                Level ${q.difficulty}
                            </span>
                        </div>
                    </div>
                    ${streakBadge}
                `;
            }

            document.getElementById('game-questions-area').innerHTML = `
                ${topVisuals}

                <h3 class="text-xl font-bold mb-8 text-slate-800 dark:text-white leading-snug">
                    ${isReviewMode ? '<span class="text-xs text-amber-500 uppercase tracking-widest block mb-2">Reviewing Past Log</span>' : ''}
                    ${q.stem}
                </h3>
                
                <div class="space-y-3">
                    ${displayOptions.map((o) => {
                        let itemClass = "group relative flex items-center p-4 border-2 rounded-2xl transition-all ";
                        let checkIcon = "";
                        
                        if (isReviewMode) {
                            if (o === q.correct_answer) {
                                itemClass += "border-green-500 bg-green-50 dark:bg-green-900/20 dark:border-green-500";
                                checkIcon = "‚úÖ";
                            } else if (o === previousAnswer) {
                                itemClass += "border-red-500 bg-red-50 dark:bg-red-900/20 dark:border-red-500";
                                checkIcon = "‚ùå";
                            } else {
                                itemClass += "border-slate-100 dark:border-slate-800 opacity-50";
                            }
                        } else {
                            itemClass += "border-slate-200 dark:border-slate-700 cursor-pointer hover:border-indigo-500 hover:bg-indigo-50 dark:hover:bg-slate-700";
                        }

                        return `
                        <label class="${itemClass}">
                            <input type="radio" name="mq" value="${o.replace(/"/g, '&quot;')}" class="peer sr-only" ${isReviewMode ? 'disabled' : ''}>
                            ${!isReviewMode ? `
                            <div class="w-6 h-6 rounded-full border-2 border-slate-300 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 mr-4 flex-shrink-0 flex items-center justify-center text-white text-xs opacity-0 peer-checked:opacity-100 transition-all">‚úì</div>
                            ` : `<div class="mr-4">${checkIcon}</div>`}
                            <span class="font-medium text-slate-600 dark:text-slate-300 peer-checked:text-indigo-700 dark:peer-checked:text-indigo-300">${o}</span>
                        </label>`;
                    }).join('')}
                </div>
                
                <div class="flex gap-4 mt-8">
                    <button onclick="navQuestion(-1)" class="btn-3d flex-1 bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-200 font-bold py-4 rounded-xl shadow-[0_4px_0_0_#94a3b8] uppercase tracking-widest text-sm hover:brightness-110 ${gameState.currentQuestionIndex === 0 ? 'opacity-50 cursor-not-allowed' : ''}" ${gameState.currentQuestionIndex === 0 ? 'disabled' : ''}>‚Üê Back</button>
                    ${isReviewMode ? `
                        <button onclick="navQuestion(1)" class="btn-3d flex-[2] bg-amber-500 text-white font-black py-4 rounded-xl shadow-[0_4px_0_0_#d97706] uppercase tracking-widest text-sm hover:brightness-110">Return to Current ‚Üí</button>
                    ` : `
                        <button onclick="checkMQ()" class="btn-3d flex-[2] bg-indigo-600 text-white font-black py-4 rounded-xl shadow-[0_4px_0_0_#3730a3] uppercase tracking-widest text-sm hover:brightness-110">Submit Analysis</button>
                    `}
                </div>
            `;
        }

// Helper to handle Back/Forward navigation
function navQuestion(dir) {
    const newIndex = gameState.currentQuestionIndex + dir;
    // Prevent going back before 0 or forward beyond what we have actually answered
    // (We only allow going "Forward" if we are in review mode and returning to the latest blank question)
    
    // Simplification: We allow navigation freely up to the "highest reached" question
    // But since we increment index automatically on submit, the "highest" is implicitly (Object.keys(gameState.missionAnswers).length)
    
    const maxIndex = Object.keys(gameState.missionAnswers).length;
    
    if (newIndex >= 0 && newIndex <= maxIndex) {
        gameState.currentQuestionIndex = newIndex;
        renderMissionQ();
    }
}

async function checkMQ() {
            const sel = document.querySelector('input[name="mq"]:checked');
            if (!sel) return;

            // Save answer for review
            gameState.missionAnswers[gameState.currentQuestionIndex] = sel.value;

            const mData = itemBank.find(i => i.id === gameState.currentMission.passageId);
            const q = selectNextQuestion(mData);
            const isCorrect = sel.value === q.correct_answer;

            // Update Standards Report
            if (!gameState.user.standardsReport[q.standard]) {
                gameState.user.standardsReport[q.standard] = { correct: 0, total: 0 };
            }
            gameState.user.standardsReport[q.standard].total++;

            if (isCorrect) {
                gameState.user.standardsReport[q.standard].correct++;
                gameState.missionScore++;
                gameState.consecutiveCorrect++;
                
                // --- COMBO LOGIC ---
                let multiplier = 1;
                let comboMsg = "Verified";
                
                if (gameState.consecutiveCorrect >= 3) {
                    multiplier = 3;
                    comboMsg = "üî• OVERDRIVE (3x Tokens)";
                    triggerConfetti();
                } else if (gameState.consecutiveCorrect === 2) {
                    multiplier = 2;
                    comboMsg = "‚ö° FLOW STATE (2x Tokens)";
                }
                
                const earned = 10 * multiplier; 
                gameState.user.tokens += earned;

                // Rank Up Logic
                if (gameState.consecutiveCorrect >= 5 && gameState.user.elaLevel < 3) {
                    gameState.user.elaLevel++;
                    gameState.consecutiveCorrect = 0; 
                    await showModal("SYSTEM UPGRADE", "Rank Up! Intelligence evolved.", 'success');
                } else {
                    await showModal(comboMsg, `${q.rationale}<br><br><b class="text-amber-600">+${earned} Tokens</b>`, 'success');
                }

            } else {
                // Combo Breaker
                if (gameState.consecutiveCorrect > 1) {
                    await showModal("COMBO BROKEN", "Streak lost. Resetting multipliers.", 'error');
                }
                gameState.consecutiveCorrect = 0;
                
                if (q.difficulty <= 4 && gameState.user.elaLevel > 1) {
                    gameState.user.elaLevel--;
                    await showModal("Recalibration", "Efficiency drop detected. Rank reduced.", 'info');
                }
                gameState.user.missedQuestions.push(q);
                await showModal("Logic Conflict", q.rationale, 'error');
            }

            gameState.currentQuestionIndex++;
            renderMissionQ();
        }

async function endMission(total) {
    const xp = Math.round((gameState.missionScore / total) * 100);
    gameState.user.tokens += gameState.missionScore * 25;
    addXp(xp);
    
    gameState.user.history.push({ missionTitle: gameState.currentMission.title, score: `${gameState.missionScore}/${total}`, date: new Date().toLocaleDateString() });

    // Mark as Complete
    if (!gameState.user.completedIds) gameState.user.completedIds = [];
    if (!gameState.user.completedIds.includes(gameState.currentMission.id)) {
        gameState.user.completedIds.push(gameState.currentMission.id);
    }

    // Save Best Score
    if (!gameState.user.missionBestScores) gameState.user.missionBestScores = {};
    
    const currentVal = gameState.missionScore;
    const prevStr = gameState.user.missionBestScores[gameState.currentMission.id];
    const prevVal = prevStr ? parseInt(prevStr.split('/')[0]) : -1;

    // Update if new score is better or equal
    if (currentVal >= prevVal) {
        gameState.user.missionBestScores[gameState.currentMission.id] = `${gameState.missionScore}/${total}`;
    }

    // S-Rank Check
    if(gameState.missionScore === total && !gameState.user.stickers.includes(gameState.currentMission.sticker)) {
        gameState.user.stickers.push(gameState.currentMission.sticker);
        triggerConfetti(); 
        await showModal("SYNCHRONIZED", `S-Rank achieved! Earned: ${gameState.currentMission.sticker}`, 'success');
    }
    
    saveProgress();
    updateUI();

    let msg = `Rewards: +${xp} XP | +${gameState.missionScore * 25} Tokens<br><h3 class="text-xl font-bold mt-2">Final Score: ${gameState.missionScore}/${total}</h3>`;
    msg += "<br><br><b>Mission Complete. Returning to Sector Map...</b>";

    await showModal("Mission End", msg, 'success');
    
    // FIX: Re-render the map to show the new score immediately
    renderMissions(); 
}

        // --- UTILS ---
function startCalibration() {
    // UPDATED: Randomize the diagnostic passages every time
    // 1. Get all unique passage IDs from the itemBank
    const allPassageIds = itemBank.map(i => i.id);
    
    // 2. Shuffle the array of IDs
    const shuffled = allPassageIds.sort(() => 0.5 - Math.random());
    
    // 3. Pick the first 3 items
    const selectedIds = shuffled.slice(0, 3);

    calProg = { 
        questions: itemBank.filter(i => selectedIds.includes(i.id)), 
        idx: 0, 
        score: 0 
    };

    document.getElementById('calibration-content').classList.remove('hidden');
    document.getElementById('calibration-results').classList.add('hidden');
    navigate('calibration-screen');
    renderCal();
}

function renderCal() {
            const qSet = calProg.questions[calProg.idx];
            if (!qSet) { endCal(); return; }
            const q = qSet.items[0];
            
            // --- NEW: RANDOMIZE OPTIONS ---
            const displayOptions = [...q.options].sort(() => Math.random() - 0.5);

            document.getElementById('question-area').innerHTML = `
                <div class="mb-6 bg-blue-50 dark:bg-gray-700 p-6 rounded-2xl border-l-8 border-blue-500">
                    <p class="italic font-serif dark:text-white text-sm">${qSet.passage}</p>
                </div>
                <p class="text-xl font-bold mb-6 dark:text-white">${q.stem}</p>
                <div class="space-y-3">
                    ${displayOptions.map(o => `
                        <label class="flex items-center p-4 border-2 rounded-xl bg-white dark:bg-gray-900 cursor-pointer hover:border-blue-500 transition-all">
                            <input type="radio" name="cal" value="${o.replace(/"/g, '&quot;')}" class="mr-3 w-5 h-5"> 
                            <span class="font-medium dark:text-white">${o}</span>
                        </label>
                    `).join('')}
                </div>`;
        }

        async function submitCal() {
            const sel = document.querySelector('input[name="cal"]:checked');
            if (!sel) return;
            const qSet = calProg.questions[calProg.idx];
            if (sel.value === qSet.items[0].correct_answer) { calProg.score += qSet.items[0].difficulty; }
            calProg.idx++; renderCal();
        }

function endCal() {
            const s = calProg.score;
            
            // 1. Determine Skill Rank (1, 2, or 3)
            const skillRank = s >= 12 ? 3 : (s >= 6 ? 2 : 1);
            gameState.user.elaLevel = skillRank;

            // 2. APPLY GAMEPLAY IMPACT (The Fix)
            let msg = "";
            
            if (skillRank === 3) {
                // Legend: Skip to Level 3, Unlock Sectors 1-3
                gameState.user.level = 3; 
                gameState.user.tokens += 500;
                msg = "<b>Result: LEGEND.</b><br>You demonstrated mastery.<br>Skipping to <b>Level 3</b>.<br>+500 Tokens awarded.";
            } else if (skillRank === 2) {
                // Scholar: Skip to Level 2, Unlock Sectors 1-2
                gameState.user.level = 2;
                gameState.user.tokens += 250;
                msg = "<b>Result: SCHOLAR.</b><br>Strong foundation detected.<br>Skipping to <b>Level 2</b>.<br>+250 Tokens awarded.";
            } else {
                // Rookie: Standard Start
                gameState.user.level = 1;
                gameState.user.tokens += 100;
                msg = "<b>Result: ROOKIE.</b><br>Baseline established.<br>Starting at <b>Level 1</b>.<br>+100 Tokens awarded.";
            }

            // 3. UI Cleanup
            document.getElementById('calibration-content').classList.add('hidden');
            document.getElementById('calibration-results').classList.remove('hidden');
            
            // Update the display text inside the results div
            document.getElementById('ela-level-display').textContent = skillRank === 3 ? "LEGEND" : (skillRank === 2 ? "SCHOLAR" : "ROOKIE");
            
            // Show the popup explaining the skip
            showModal("Calibration Complete", msg, 'success');

            saveProgress(); 
            updateUI();
        }

function startSurvival() {
            // Flatten all items into one giant array
            gameState.survivalQueue = itemBank.flatMap(i => i.items.map(it => ({...it, passage: i.passage}))).sort(() => Math.random() - 0.5);
            
            gameState.currentQuestionIndex = 0; 
            gameState.missionScore = 0;
            
            navigate('game-play-screen'); 
            
            // NEW: Start the timer for Gauntlet mode
            startTimer();
            
            renderSurvivalQ();
        }

        function renderSurvivalQ() {
            const q = gameState.survivalQueue[gameState.currentQuestionIndex];
            if (!q) { navigate('welcome-screen'); return; }
            document.getElementById('game-title').innerHTML = `<span class="text-red-600 font-black">üíÄ GAUNTLET MODE</span>`;
            document.getElementById('game-passage').innerHTML = `<div class="dark:text-white">${q.passage}</div>`;
            document.getElementById('game-questions-area').innerHTML = `<p class="font-bold mb-6 dark:text-white text-xl">${q.stem}</p><div class="space-y-3">${q.options.map(o => `<button onclick="checkSQ('${o.replace(/'/g, "\\'")}')" class="w-full text-left p-4 border-2 rounded-2xl bg-white dark:bg-gray-700 dark:text-white font-bold hover:border-red-500 transition-all uppercase tracking-tighter text-sm">${o}</button>`).join('')}</div>`;
        }

        async function checkSQ(ans) {
            const q = gameState.survivalQueue[gameState.currentQuestionIndex];
            if (ans === q.correct_answer) {
                gameState.missionScore++; gameState.currentQuestionIndex++;
                await showModal("Threat Neutralized", "Deep scanning next query...", 'success'); renderSurvivalQ();
            } else {
                if(gameState.user.inventory.shield > 0) {
                    gameState.user.inventory.shield--; updateUI();
                    await showModal("Shield Active", "The logic spike was absorbed.", "success"); renderSurvivalQ();
                } else {
                    await showModal("CRITICAL ERROR", `Correct: ${q.correct_answer}`, 'error'); navigate('welcome-screen');
                }
            }
        }

function renderStickerBook() {
            const grid = document.getElementById('sticker-grid');
            grid.innerHTML = '';
            
            // SECTION 1: MISSION TROPHIES (Generated from allMissions)
            const trophyHeader = document.createElement('h3');
            trophyHeader.className = "col-span-full text-xl font-black text-indigo-600 dark:text-indigo-400 mt-2 mb-4 uppercase tracking-widest border-b border-indigo-200 pb-2";
            trophyHeader.innerHTML = "üèÜ Mission Trophies";
            grid.appendChild(trophyHeader);

            allMissions.forEach(m => {
                const isUnlocked = gameState.user.stickers.includes(m.sticker);
                
                const card = document.createElement('div');
                // Green/Gold style for Trophies
                const baseClass = isUnlocked 
                    ? 'bg-gradient-to-br from-yellow-50 to-amber-100 dark:from-slate-800 dark:to-slate-700 border-amber-400 shadow-lg scale-100' 
                    : 'bg-slate-100 dark:bg-slate-900/50 border-dashed border-slate-300 dark:border-slate-700 opacity-60 scale-95';

                card.className = `sticker-card aspect-square rounded-xl flex flex-col items-center justify-center border-2 transition-all duration-300 relative group ${baseClass}`;
                
                // Show Sticker if unlocked, otherwise show '?'
                card.innerHTML = `
                    <div class="text-4xl mb-1">${isUnlocked ? m.sticker : '<span class="text-slate-300 text-2xl font-bold">?</span>'}</div>
                    <div class="text-[10px] font-bold text-slate-500 uppercase tracking-wide text-center px-1 leading-tight">
                        ${isUnlocked ? m.title : 'LOCKED'}
                    </div>
                `;
                
                if(isUnlocked) {
                    // Shiny effect for earned trophies
                    card.innerHTML += `<div class="absolute inset-0 bg-white/20 rounded-xl pointer-events-none"></div>`;
                }

                grid.appendChild(card);
            });

            // SECTION 2: SHOP COLLECTION (Generated from shopCatalog)
            const shopHeader = document.createElement('h3');
            shopHeader.className = "col-span-full text-xl font-black text-pink-600 dark:text-pink-400 mt-8 mb-4 uppercase tracking-widest border-b border-pink-200 pb-2";
            shopHeader.innerHTML = "üõçÔ∏è Personal Collection";
            grid.appendChild(shopHeader);

            shopCatalog.stickers.forEach(item => {
                const isOwned = gameState.user.stickers.includes(item.icon);

                const card = document.createElement('div');
                // Pink/Purple style for Shop Items
                const baseClass = isOwned 
                    ? 'bg-white dark:bg-slate-800 border-pink-400 shadow-md scale-100' 
                    : 'bg-slate-50 dark:bg-slate-900/30 border-slate-200 dark:border-slate-800 grayscale opacity-40';

                card.className = `sticker-card aspect-square rounded-xl flex items-center justify-center text-4xl border-2 transition-all duration-300 ${baseClass}`;
                
                card.innerHTML = item.icon;
                
                // Tooltip for shop items
                if(!isOwned) {
                    card.title = `Buy in Shop: ${item.cost} Tokens`;
                }

                grid.appendChild(card);
            });

            navigate('sticker-book-screen');
        }

        function renderInventory() {
            const bar = document.getElementById('inventory-bar');
            bar.innerHTML = '';
            const inv = gameState.user.inventory;
            if(inv.lens > 0) bar.innerHTML += `<button onclick="useLens()" class="bg-blue-600 text-white px-3 py-2 rounded-xl flex items-center gap-2 font-bold shadow-lg h-10 text-[10px]">üîç Lens (${inv.lens})</button>`;
            if(inv.freezer > 0) bar.innerHTML += `<button onclick="useFreezer()" class="bg-cyan-500 text-white px-3 py-2 rounded-xl flex items-center gap-2 font-bold shadow-lg h-10 text-[10px]">‚ùÑÔ∏è Reset (${inv.freezer})</button>`;
        }

        function useLens() {
            const options = document.querySelectorAll('input[name="mq"]');
            const mData = itemBank.find(i => i.id === gameState.currentMission.passageId);
            const q = selectNextQuestion(mData);
            let found = false;
            options.forEach(opt => {
                if(!found && opt.value !== q.correct_answer && !opt.parentElement.classList.contains('opacity-20')) {
                    opt.parentElement.classList.add('opacity-20', 'pointer-events-none');
                    found = true;
                }
            });
            if(found) { gameState.user.inventory.lens--; updateUI(); renderInventory(); }
        }

        function useFreezer() { gameState.user.inventory.freezer--; startTimer(); updateUI(); renderInventory(); showModal("Freezer Active", "Timer reset.", "success"); }
        function addXp(amt) { gameState.user.xp += amt; while(gameState.user.xp >= 100) { gameState.user.xp -= 100; gameState.user.level++; } updateUI(); }
        
function updateUI() {
            // Safe update helper
            const setText = (id, text) => {
                const el = document.getElementById(id);
                if (el) el.textContent = text;
            };

            // Update Avatar & Basic Stats
            setText('player-avatar', gameState.user.avatar);
            setText('main-level-display', "Level " + gameState.user.level);
            setText('main-token-display', gameState.user.tokens);
            setText('shop-token-display', gameState.user.tokens);
            
            // Profile Screen Updates
            setText('profile-tokens', gameState.user.tokens);
            setText('profile-level', gameState.user.level);
            
            const rankName = gameState.user.elaLevel === 3 ? "Legend" : (gameState.user.elaLevel === 2 ? "Scholar" : "Rookie");
            setText('profile-rank', rankName);
            
            // Calculate Accuracy for Profile
            let totalQ = 0; let totalC = 0;
            if (gameState.user.standardsReport) {
                Object.values(gameState.user.standardsReport).forEach(s => { totalQ += s.total; totalC += s.correct; });
            }
            const acc = totalQ > 0 ? Math.round((totalC / totalQ) * 100) : 0;
            setText('profile-accuracy', acc + '%');

            // Handle XP Bar (Only if it exists in the HTML)
            const xpText = document.getElementById('main-xp-current');
            const xpBar = document.getElementById('main-xp-bar');
            if (xpText) xpText.textContent = gameState.user.xp;
            if (xpBar) xpBar.style.width = gameState.user.xp + '%';
            
            // Save Progress
            localStorage.setItem('elaLegendsSaveV9', JSON.stringify(gameState.user));
        }

        let timerInt;
        function startTimer() {
            let s = 0; const d = document.getElementById('game-timer'); clearInterval(timerInt);
            timerInt = setInterval(() => { s++; const m = Math.floor(s/60).toString().padStart(2, '0'); const sc = (s%60).toString().padStart(2, '0'); d.textContent = `${m}:${sc}`; }, 1000);
        }

        function saveProgress() { localStorage.setItem('elaLegendsSaveV9', JSON.stringify(gameState.user)); }
function loadProgress() { 
            const saved = localStorage.getItem('elaLegendsSaveV9'); 
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    
                    // 1. Load the saved data
                    gameState.user = parsed;

                    // 2. CRITICAL: Inject missing arrays for old save files
                    // This prevents the "undefined" error you just saw
                    if (!gameState.user.avatars) gameState.user.avatars = [];
                    if (!gameState.user.stickers) gameState.user.stickers = [];
                    if (!gameState.user.inventory) gameState.user.inventory = {};
                    if (!gameState.user.completedIds) gameState.user.completedIds = [];
                    if (!gameState.user.missionBestScores) gameState.user.missionBestScores = {};
                    if (!gameState.user.standardsReport) gameState.user.standardsReport = {};

                    // 3. Migration: Fix the Boss ID if they played the old version
                    if (gameState.user.completedIds.includes('inf-ash-borer') && !gameState.user.completedIds.includes('m-boss')) {
                        gameState.user.completedIds.push('m-boss');
                    }

                } catch (e) {
                    console.error("Save file corrupted, resetting.", e);
                    localStorage.removeItem('elaLegendsSaveV9');
                }
            }
            // Always update UI after loading
            updateUI(); 
        }     
        
        function openArchive() {
            const l = document.getElementById('archive-list'); const msg = document.getElementById('archive-empty-msg'); l.innerHTML = '';
            if (gameState.user.missedQuestions.length === 0) msg.classList.remove('hidden');
            else {
                msg.classList.add('hidden');
                gameState.user.missedQuestions.forEach((q, idx) => {
                    const c = document.createElement('div');
                    c.className = "bg-white p-6 rounded-3xl border-l-8 border-red-500 shadow-md";
                    c.innerHTML = `<p class="font-bold mb-4 dark:text-white uppercase tracking-tighter">${q.stem}</p><div class="space-y-2">${q.options.map(o => `<button onclick="fixGlitch(${idx}, '${o.replace(/'/g, "\\'")}')" class="w-full text-left p-3 border-2 rounded-xl hover:bg-gray-100 font-bold">${o}</button>`).join('')}</div>`;
                    l.appendChild(c);
                });
            }
            navigate('archive-screen');
        }

        async function fixGlitch(idx, ans) {
            const q = gameState.user.missedQuestions[idx];
            if (ans === q.correct_answer) { gameState.user.missedQuestions.splice(idx, 1); addXp(20); await showModal("Integrity Restored", "Data anomaly repaired.", 'success'); openArchive(); }
            else { await showModal("Repair Failed", "Incorrect logic. Glitch persistent.", 'error'); }
        }

        function triggerConfetti() { confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } }); }
        function resetGame() { if(confirm('Erase all protocol data?')) { localStorage.removeItem('elaLegendsSaveV9'); location.reload(); } }

        function generateReport() {
            const d = new Date().toLocaleDateString();
            const rank = gameState.user.elaLevel === 3 ? "Legend" : (gameState.user.elaLevel === 2 ? "Scholar" : "Rookie");
            const win = window.open('', '_blank');
            let totalQ = 0; let totalC = 0;
            Object.values(gameState.user.standardsReport).forEach(s => { totalQ += s.total; totalC += s.correct; });
            const acc = totalQ > 0 ? Math.round((totalC / totalQ) * 100) : 0;
            win.document.write(`<html><body style="font-family:sans-serif; padding:40px; color:#333;"><h1 style="color:#4f46e5;">ELA Legends Mastery Matrix</h1><p><b>Date:</b> ${d}</p><p><b>Level:</b> ${gameState.user.level} | <b>Rank:</b> ${rank}</p><p><b>Accuracy:</b> ${acc}%</p><hr><h2>Standards Mastery</h2><ul>${Object.keys(gameState.user.standardsReport).map(std => { const s = gameState.user.standardsReport[std]; return `<li><b>${std}:</b> ${Math.round((s.correct/s.total)*100)}% (${s.correct}/${s.total})</li>`; }).join('')}</ul><hr><h2>History</h2><ul>${gameState.user.history.map(h => `<li>${h.date}: ${h.missionTitle} - ${h.score}</li>`).join('')}</ul></body></html>`);
            win.document.close(); win.print();
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadProgress();
            document.querySelectorAll('.home-button').forEach(b => b.onclick = () => { clearInterval(timerInt); navigate('welcome-screen'); });
            document.getElementById('start-calibration-button').onclick = startCalibration;
            document.getElementById('submit-answer-button').onclick = submitCal;
            document.getElementById('start-missions-button').onclick = renderMissions;
            document.getElementById('missions-button').onclick = renderMissions;
            document.getElementById('progress-button').onclick = renderStickerBook;
            document.getElementById('shop-button').onclick = renderShop;
            document.getElementById('profile-button').onclick = renderProfile;
        });
    </script>
</body>
</html>