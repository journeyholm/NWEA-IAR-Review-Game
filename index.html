<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic ELA Assessment-Prep Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
            touch-action: manipulation; 
        }
        .dark body {
            background: linear-gradient(-45deg, #1a1a2e, #16213e, #0f3460, #533483);
            background-size: 400% 400%;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .screen { animation: fadeSlideUp 0.5s ease-out; }
        @keyframes fadeSlideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .button { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; border: none; -webkit-tap-highlight-color: transparent; }
        .button:hover { transform: translateY(-2px); }
        
        .sticker-card { transition: transform 0.2s; cursor: pointer; }
        .sticker-card:hover { transform: scale(1.05) rotate(1deg); }

        .shop-tab-active { border-bottom: 4px solid #f59e0b; color: #f59e0b; }
        
        .item-card {
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .item-card:hover {
            transform: translateY(-4px);
            border-color: #6366f1;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: transform 0.2s;
        }
        .dark .stat-card {
            background: rgba(31, 41, 55, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .difficulty-tag {
            font-size: 0.6rem;
            padding: 2px 8px;
            border-radius: 99px;
            text-transform: uppercase;
            font-weight: 800;
        }
        .diff-low { background: #d1fae5; color: #065f46; }
        .diff-med { background: #fef3c7; color: #92400e; }
        .diff-high { background: #fee2e2; color: #991b1b; }
        
        /* Custom scrollbar for long passages */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
    </style>
</head>
<body class="transition-colors duration-300">

    <div id="welcome-screen" class="screen flex flex-col items-center justify-start text-center px-4 md:px-8 pb-8 pt-8 min-h-screen relative">
        <div class="w-full max-w-5xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6 bg-white/60 dark:bg-gray-800/60 backdrop-blur-lg border border-white/40 p-4 rounded-3xl shadow-lg mb-12">
            <div class="flex items-center gap-4">
                <div class="relative group">
                    <div id="player-avatar" class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center text-3xl shadow-lg border-2 border-white dark:border-gray-700">
                        üßô‚Äç‚ôÇÔ∏è
                    </div>
                    <div class="absolute -bottom-2 -right-2 w-8 h-8 bg-white dark:bg-gray-700 rounded-lg flex items-center justify-center text-xs font-bold border border-gray-200 shadow-sm" id="main-level-display">1</div>
                </div>
                <div class="flex flex-col items-start text-left">
                    <div class="flex justify-between w-48 text-[10px] font-bold text-gray-500 uppercase tracking-widest">
                        <span>XP Progress</span>
                        <span><span id="main-xp-current">0</span> / 100</span>
                    </div>
                    <div class="w-48 h-2 bg-gray-200 rounded-full overflow-hidden border border-black/5 mt-1">
                        <div id="main-xp-bar" class="bg-indigo-500 h-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <div class="bg-yellow-100 dark:bg-yellow-900/40 px-5 py-2 rounded-2xl border-2 border-yellow-200">
                    <span class="font-bold text-yellow-800 dark:text-yellow-100 uppercase tracking-tighter">üí∞ <span id="main-token-display">0</span></span>
                </div>
                <button onclick="document.documentElement.classList.toggle('dark')" class="p-3 rounded-xl bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600">üåì</button>
            </div>
        </div>

        <h1 class="text-5xl md:text-8xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 mb-2 tracking-tight uppercase">ELA Legends</h1>
        <div class="bg-white/60 dark:bg-black/40 backdrop-blur-md py-3 px-8 rounded-full mb-10 border border-white/20 shadow-sm">
            <p class="text-xl md:text-2xl text-slate-900 dark:text-white font-bold italic">Master Grade 8 Standards. Defeat the System Glitch.</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 w-full max-w-5xl mb-8">
            <button id="start-calibration-button" class="button bg-blue-600 text-white font-bold py-6 rounded-2xl text-xl shadow-lg">üßô‚Äç‚ôÇÔ∏è Calibration</button>
            <button onclick="startSurvival()" class="button bg-red-600 text-white font-bold py-6 rounded-2xl text-xl shadow-lg">üíÄ The Gauntlet</button>
            <button id="missions-button" class="button bg-emerald-600 text-white font-bold py-6 rounded-2xl text-xl shadow-lg">üìú Missions</button>
            <button id="shop-button" class="button bg-amber-500 text-white font-bold py-6 rounded-2xl text-xl shadow-lg">üõçÔ∏è Token Shop</button>
            <button id="progress-button" class="button bg-violet-600 text-white font-bold py-6 rounded-2xl text-xl shadow-lg">üìí Sticker Book</button>
            <button id="profile-button" class="button bg-indigo-600 text-white font-bold py-6 rounded-2xl text-xl shadow-lg">üìä Player Profile</button>
            <button id="archive-button" onclick="openArchive()" class="col-span-1 md:col-span-2 lg:col-span-3 button bg-rose-600 text-white font-bold py-6 rounded-2xl text-xl shadow-lg">‚ö†Ô∏è Glitch Archive</button>
        </div>
        <button onclick="resetGame()" class="text-gray-400 text-xs hover:text-red-500 transition-colors">Reset Save State</button>
    </div>

    <!-- Screen Containers -->
    <div id="calibration-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        <h2 class="text-3xl font-bold mb-8 text-center mt-12 text-gray-800 dark:text-white uppercase tracking-tighter">Diagnostic Calibration</h2>
        <div id="calibration-content" class="max-w-4xl mx-auto bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-xl">
            <div id="question-area"></div>
            <div class="flex justify-end mt-6">
                <button id="submit-answer-button" class="button bg-blue-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg uppercase tracking-widest">Analyze Protocol</button>
            </div>
        </div>
        <div id="calibration-results" class="hidden text-center mt-8">
            <h3 class="text-4xl font-bold text-green-600 mb-4 uppercase">Rank Attained!</h3>
            <p class="text-2xl mb-6 dark:text-white">Your Rank: <span id="ela-level-display" class="font-black text-indigo-600"></span></p>
            <button id="start-missions-button" class="button bg-green-500 text-white font-bold py-4 px-12 rounded-xl text-xl shadow-xl">Proceed to Mission Hub</button>
        </div>
    </div>

    <div id="missions-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        <h2 class="text-4xl font-black mb-8 text-center mt-12 text-gray-800 dark:text-white uppercase">Mission Hub</h2>
        <div id="missions-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto pb-12"></div>
    </div>

    <div id="game-play-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 max-w-6xl mx-auto pt-12">
            <h2 id="game-title" class="text-2xl font-black text-gray-800 dark:text-white uppercase">Mission</h2>
            <div class="flex items-center gap-4">
                <div id="inventory-bar" class="flex gap-2"></div>
                <div class="bg-white dark:bg-gray-800 px-6 py-2 rounded-full shadow-lg border border-gray-100 dark:border-gray-700 flex items-center gap-6">
                    <span id="game-timer" class="font-mono font-bold text-indigo-600">00:00</span>
                    <span class="font-bold text-gray-700 dark:text-gray-300">Score: <span id="mission-score-display">0</span>/10</span>
                </div>
            </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-6xl mx-auto">
            <div id="game-passage" class="bg-white/80 dark:bg-gray-800/80 p-8 rounded-2xl shadow-xl border border-white/20 text-lg leading-relaxed font-serif overflow-y-auto max-h-[60vh]"></div>
            <div id="game-questions-area" class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-2xl border-t-8 border-indigo-500"></div>
        </div>
    </div>

    <div id="profile-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        <div class="max-w-5xl mx-auto mt-12">
            <div class="flex flex-col md:flex-row items-center gap-8 mb-12 bg-white/40 dark:bg-gray-800/40 p-8 rounded-3xl backdrop-blur-md border border-white/20 shadow-xl">
                <div id="profile-avatar" class="w-32 h-32 bg-white dark:bg-gray-700 rounded-3xl flex items-center justify-center text-6xl shadow-2xl border-4 border-indigo-500">üßô‚Äç‚ôÇÔ∏è</div>
                <div class="text-center md:text-left flex-1">
                    <h2 class="text-4xl font-black text-gray-800 dark:text-white uppercase tracking-tighter mb-1">Scholar Profile</h2>
                    <p class="text-xl text-indigo-600 dark:text-indigo-400 font-bold mb-4">Mastery Rank: <span id="profile-rank">Uncalibrated</span></p>
                    <div class="flex flex-wrap justify-center md:justify-start gap-3">
                        <div class="bg-white dark:bg-gray-800 px-4 py-2 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
                            <span class="text-[10px] text-gray-500 block uppercase font-bold tracking-widest">Total Tokens</span>
                            <span id="profile-tokens" class="text-xl font-black">0</span>
                        </div>
                        <div class="bg-white dark:bg-gray-800 px-4 py-2 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
                            <span class="text-[10px] text-gray-500 block uppercase font-bold tracking-widest">Protocol Level</span>
                            <span id="profile-level" class="text-xl font-black">1</span>
                        </div>
                        <div id="profile-accuracy-badge" class="bg-green-100 dark:bg-green-900/40 text-green-700 dark:text-green-300 px-4 py-2 rounded-xl border border-green-200">
                             <span class="text-[10px] block uppercase font-bold tracking-widest">Efficiency</span>
                             <span id="profile-accuracy" class="text-xl font-black">0%</span>
                        </div>
                    </div>
                </div>
                <button onclick="generateReport()" class="bg-indigo-600 text-white font-black px-8 py-4 rounded-2xl shadow-lg hover:bg-indigo-700 transition-all uppercase tracking-widest text-xs">Print Diagnostic Report</button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pb-10">
                <div class="stat-card p-6 rounded-3xl shadow-lg">
                    <h3 class="text-xl font-black mb-4 uppercase tracking-tighter dark:text-white">Standards Mastery</h3>
                    <div id="standards-grid" class="space-y-4"></div>
                </div>
                <div class="stat-card p-6 rounded-3xl shadow-lg">
                    <h3 class="text-xl font-black mb-4 uppercase tracking-tighter dark:text-white">Mission History</h3>
                    <div id="history-list" class="space-y-3 max-h-[400px] overflow-y-auto pr-2"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="sticker-book-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        <h2 class="text-4xl font-black mb-2 text-center mt-12 text-gray-800 dark:text-white uppercase tracking-tighter">Legendary Archive</h2>
        <p class="text-center text-gray-600 dark:text-gray-400 mb-8">Full collection acquired through mission mastery.</p>
        <div id="sticker-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 max-w-5xl mx-auto bg-white/20 p-8 rounded-3xl backdrop-blur-md"></div>
    </div>

    <div id="shop-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        <div class="max-w-5xl mx-auto mt-12">
            <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
                <div>
                    <h2 class="text-5xl font-black text-gray-800 dark:text-white uppercase">The Vault</h2>
                    <p class="text-gray-600 dark:text-gray-400 font-bold italic">restricted upgrades for high-level legends.</p>
                </div>
                <div class="bg-yellow-400 text-yellow-900 px-8 py-3 rounded-2xl font-black text-2xl shadow-lg flex items-center gap-3">
                    üí∞ <span id="shop-token-display">0</span>
                </div>
            </div>
            
            <div class="flex border-b border-gray-300 dark:border-gray-700 mb-8 overflow-x-auto whitespace-nowrap">
                <button onclick="switchShopTab('avatars')" id="tab-avatars" class="px-6 py-3 font-bold uppercase tracking-widest shop-tab-active">Avatars</button>
                <button onclick="switchShopTab('stickers')" id="tab-stickers" class="px-6 py-3 font-bold uppercase tracking-widest text-gray-500">Stickers</button>
                <button onclick="switchShopTab('items')" id="tab-items" class="px-6 py-3 font-bold uppercase tracking-widest text-gray-500">Items</button>
            </div>

            <div id="shop-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 pb-20"></div>
        </div>
    </div>

    <div id="archive-screen" class="screen hidden p-4 md:p-8 relative min-h-screen">
        <button class="home-button absolute top-4 left-4 p-2 rounded-full bg-white shadow-md z-50">üè†</button>
        <h2 class="text-3xl font-bold mb-2 text-red-600 text-center mt-12 uppercase tracking-tighter">System Glitches</h2>
        <div id="archive-list" class="max-w-3xl mx-auto space-y-6"></div>
        <div id="archive-empty-msg" class="hidden text-center mt-12 bg-white/40 p-12 rounded-2xl border-2 border-dashed border-white">
            <span class="text-6xl mb-4 block">‚ú®</span>
            <h3 class="text-2xl font-bold">System Integrity: 100%</h3>
            <p class="text-gray-600">No logical discrepancies detected in the protocol memory.</p>
        </div>
    </div>

    <!-- Modals -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black/60 flex items-center justify-center p-4 hidden z-[100] backdrop-blur-sm">
        <div id="modal-box" class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-md w-full text-center border-t-8 transition-all duration-300 scale-100">
            <h3 id="modal-title" class="text-2xl font-black mb-4 dark:text-white uppercase tracking-tighter"></h3>
            <p id="modal-message" class="text-gray-700 dark:text-gray-300 mb-6 leading-relaxed"></p>
            <button id="modal-ok-btn" class="button bg-indigo-600 text-white font-bold py-3 px-12 rounded-xl shadow-lg uppercase tracking-widest text-xs">Verify Data</button>
        </div>
    </div>

    <script>
        let gameState = {
            currentScreen: 'welcome',
            currentMission: null,
            currentQuestionIndex: 0,
            missionScore: 0,
            consecutiveCorrect: 0,
            currentShopTab: 'avatars',
            user: {
                xp: 0, level: 1, elaLevel: 1, tokens: 0, history: [],
                missedQuestions: [], stickers: [], avatar: 'üßô‚Äç‚ôÇÔ∏è', 
                inventory: { lens: 0, freezer: 0, shield: 0 },
                standardsReport: {}
            }
        };

const shopCatalog = {
            avatars: [
                { id: 'av_ninja', name: 'Word Ninja', icon: 'ü•∑', cost: 200, type: 'avatar' },
                { id: 'av_robot', name: 'Logic Bot', icon: 'ü§ñ', cost: 500, type: 'avatar' },
                { id: 'av_alien', name: 'Cosmic Scholar', icon: 'üëΩ', cost: 1000, type: 'avatar' },
                { id: 'av_poet', name: 'Cyber Poet', icon: '‚úçÔ∏è', cost: 1500, type: 'avatar' },
                { id: 'av_sorcerer', name: 'Syntax Sorcerer', icon: 'üßô‚Äç‚ôÇÔ∏è', cost: 3500, type: 'avatar' },
                { id: 'av_king', name: 'Lit Regent', icon: 'üëë', cost: 7500, type: 'avatar' },
                { id: 'av_detective', name: 'Text Detective', icon: 'üïµÔ∏è‚Äç‚ôÄÔ∏è', cost: 1200, type: 'avatar' },
                { id: 'av_dino', name: 'Dino Reader', icon: 'ü¶ñ', cost: 2500, type: 'avatar' },
                { id: 'av_ghost', name: 'Ghost Writer', icon: 'üëª', cost: 3000, type: 'avatar' },
                { id: 'av_cat', name: 'Cool Cat', icon: 'üòé', cost: 5000, type: 'avatar' }
            ],
            stickers: [
                { id: 'st_crate', name: 'Mystery Box', description: 'Contains 1 Random Sticker!', icon: 'üéÅ', cost: 150, type: 'crate' },
                // STATUS
                { id: 'st_fire', name: 'Fire Streak', icon: 'üî•', cost: 300, type: 'sticker' },
                { id: 'st_brain', name: 'Brain Power', icon: 'üß†', cost: 500, type: 'sticker' },
                { id: 'st_gem', name: 'Syntax Gem', icon: 'üíé', cost: 800, type: 'sticker' },
                { id: 'st_star', name: 'Super Star', icon: '‚≠ê', cost: 1000, type: 'sticker' },
                { id: 'st_100', name: '100% Club', icon: 'üíØ', cost: 1200, type: 'sticker' },
                // ANIMALS
                { id: 'st_panda', name: 'Panda Pal', icon: 'üêº', cost: 400, type: 'sticker' },
                { id: 'st_koala', name: 'Koala Typer', icon: 'üê®', cost: 400, type: 'sticker' },
                { id: 'st_lion', name: 'Lion Heart', icon: 'ü¶Å', cost: 600, type: 'sticker' },
                { id: 'st_uni', name: 'Unicorn', icon: 'ü¶Ñ', cost: 900, type: 'sticker' },
                { id: 'st_octo', name: 'Octo-Mind', icon: 'üêô', cost: 1000, type: 'sticker' },
                { id: 'st_fox', name: 'Clever Fox', icon: 'ü¶ä', cost: 450, type: 'sticker' },
                { id: 'st_tiger', name: 'Tiger Eye', icon: 'üêØ', cost: 650, type: 'sticker' },
                { id: 'st_monk', name: 'Code Monkey', icon: 'üêµ', cost: 350, type: 'sticker' },
                { id: 'st_sloth', name: 'Slow & Steady', icon: 'ü¶•', cost: 300, type: 'sticker' },
                { id: 'st_owl', name: 'Wise Owl', icon: 'ü¶â', cost: 550, type: 'sticker' },
                // FOOD
                { id: 'st_pizza', name: 'Study Snack', icon: 'üçï', cost: 250, type: 'sticker' },
                { id: 'st_taco', name: 'Brain Food', icon: 'üåÆ', cost: 250, type: 'sticker' },
                { id: 'st_donut', name: 'Sweet Success', icon: 'üç©', cost: 300, type: 'sticker' },
                { id: 'st_cookie', name: 'Smart Cookie', icon: 'üç™', cost: 300, type: 'sticker' },
                { id: 'st_burg', name: 'Cheeseburger', icon: 'üçî', cost: 350, type: 'sticker' },
                { id: 'st_fries', name: 'Salty Fries', icon: 'üçü', cost: 200, type: 'sticker' },
                { id: 'st_sushi', name: 'Sushi Roll', icon: 'üç£', cost: 500, type: 'sticker' },
                { id: 'st_ice', name: 'Chill Cone', icon: 'üç¶', cost: 250, type: 'sticker' },
                { id: 'st_pop', name: 'Movie Night', icon: 'üçø', cost: 300, type: 'sticker' },
                { id: 'st_apple', name: 'Teacher Pet', icon: 'üçé', cost: 150, type: 'sticker' },
                // SPOOKY
                { id: 'st_skull', name: 'Dead Wrong', icon: 'üíÄ', cost: 666, type: 'sticker' },
                { id: 'st_alien', name: 'Area 51', icon: 'üõ∏', cost: 1500, type: 'sticker' },
                { id: 'st_game', name: 'Gamer Mode', icon: 'üéÆ', cost: 2000, type: 'sticker' },
                { id: 'st_ghost', name: 'Boo!', icon: 'üëª', cost: 700, type: 'sticker' },
                { id: 'st_zom', name: 'Brain Eater', icon: 'üßü', cost: 750, type: 'sticker' },
                { id: 'st_bat', name: 'Night Wing', icon: 'ü¶á', cost: 400, type: 'sticker' },
                { id: 'st_pump', name: 'Jack-O', icon: 'üéÉ', cost: 500, type: 'sticker' },
                { id: 'st_web', name: 'Web Master', icon: 'üï∏Ô∏è', cost: 450, type: 'sticker' },
                { id: 'st_robot', name: 'Domo Arigato', icon: 'ü§ñ', cost: 800, type: 'sticker' },
                { id: 'st_ninja', name: 'Stealth Mode', icon: 'ü•∑', cost: 850, type: 'sticker' },
                // SCHOOL
                { id: 'st_book', name: 'Book Worm', icon: 'üìö', cost: 200, type: 'sticker' },
                { id: 'st_pen', name: 'Mightier Pen', icon: '‚úèÔ∏è', cost: 150, type: 'sticker' },
                { id: 'st_lap', name: 'Tech Whiz', icon: 'üíª', cost: 1000, type: 'sticker' },
                { id: 'st_bulb', name: 'Bright Idea', icon: 'üí°', cost: 300, type: 'sticker' },
                { id: 'st_grad', name: 'Scholar', icon: 'üéì', cost: 2000, type: 'sticker' },
                { id: 'st_globe', name: 'Explorer', icon: 'üåé', cost: 400, type: 'sticker' },
                { id: 'st_scope', name: 'Scientist', icon: 'üî¨', cost: 600, type: 'sticker' },
                // LEGENDARY
                { id: 'st_rocket', name: 'NWEA Rocket', icon: 'üöÄ', cost: 2500, type: 'sticker' },
                { id: 'st_trophy', name: 'IAR MVP', icon: 'üèÜ', cost: 5000, type: 'sticker' },
                { id: 'st_crown', name: 'Vocab King', icon: 'üëë', cost: 7500, type: 'sticker' },
                { id: 'st_dragon', name: 'Mythic Dragon', icon: 'üêâ', cost: 10000, type: 'sticker' },
                { id: 'st_diam', name: 'Flawless', icon: 'üíç', cost: 8000, type: 'sticker' },
                { id: 'st_medal', name: 'Gold Medal', icon: 'ü•á', cost: 4500, type: 'sticker' },
                { id: 'st_cast', name: 'Fortress', icon: 'üè∞', cost: 6000, type: 'sticker' }
            ],
            items: [
                { id: 'item_lens', name: 'Logic Lens', description: 'Removes one wrong answer.', icon: 'üîé', cost: 150, type: 'consumable', key: 'lens' },
                { id: 'item_freezer', name: 'Time Freezer', description: 'Resets the mission clock.', icon: '‚ùÑÔ∏è', cost: 300, type: 'consumable', key: 'freezer' },
                { id: 'item_shield', name: 'Streak Saver', description: 'One extra life in Gauntlet.', icon: 'üõ°Ô∏è', cost: 600, type: 'consumable', key: 'shield' }
            ]
        };

const itemBank = [
            // ORIGINAL CONTENT
            { 
                id: 'rok-lit-confetti', 
                passage: "from Confetti Girl: Dad wears a green frog apron that says KISS THE COOK and tube socks over his hands... I put the book on my nightstand and use it as a coaster.", 
                items: [
                    { id: 'c1', stem: "Why does the narrator use the book as a coaster?", options: ["Resentment of her father", "Carelessness", "Worry about homework", "Dishonesty"], correct_answer: "Resentment of her father", rationale: "Symbolic rejection of his scholarly obsessions.", standard: "RL.8.1", difficulty: 3 },
                    { id: 'c2', stem: "Which quote provides evidence for her boredom?", options: ["'I sigh, but he doesn't get the hint.'", "'I pretend it's delicious.'", "'Remember that super is a prefix.'", "'Found my copy.'"], correct_answer: "'I sigh, but he doesn't get the hint.'", rationale: "Directly illustrates her lack of interest.", standard: "RL.8.1", difficulty: 2 },
                    { id: 'c3', stem: "Point of view tension cause:", options: ["Withholding true feelings", "Hidden anger", "Fast-paced tone", "Scary settings"], correct_answer: "Withholding true feelings", rationale: "Communication barrier creates interpersonal tension.", standard: "RL.8.6", difficulty: 5 },
                    { id: 'c4', stem: "Father's dialogue suggestion:", options: ["Focused on academic achievement", "Dangerous in kitchen", "Angry at narrator", "Dislikes reading"], correct_answer: "Focused on academic achievement", rationale: "Constantly pivots to SAT prep/vocab.", standard: "RL.8.3", difficulty: 4 },
                    { id: 'c5', stem: "Evidence for academic focus:", options: ["'Remember that super is a prefix...'", "'I've got a copy somewhere.'", "'I pretend it's delicious.'", "'Dad wears tube socks.'"], correct_answer: "'Remember that super is a prefix...'", rationale: "Illustrates his teaching-first attitude.", standard: "RL.8.1", difficulty: 5 },
                    { id: 'c6', stem: "Meaning of 'supersede':", options: ["To take precedence over", "To explain clearly", "To ignore completely", "To translate"], correct_answer: "To take precedence over", rationale: "Vocabulary hierarchy context.", standard: "L.8.4", difficulty: 6 },
                    { id: 'c7', stem: "Narrator's tone vs Father's Earnestness:", options: ["She is sarcastic", "She is excited", "She is equally earnest", "She is deeply angry"], correct_answer: "She is sarcastic", rationale: "Contrast between teaching and dismissal.", standard: "RL.8.4", difficulty: 6 },
                    { id: 'c8', stem: "Central theme:", options: ["Communication gap between adults/children", "Cooking brings unity", "Reading is vital", "Sarcasm is power"], correct_answer: "Communication gap between adults/children", rationale: "The generational and interest gap is the focus.", standard: "RL.8.2", difficulty: 7 },
                    { id: 'c9', stem: "Father's 'tube socks' reveal:", options: ["Eccentric but engaging", "Poor/struggling", "Professional chef", "Careless"], correct_answer: "Eccentric but engaging", rationale: "Quirky effort to be 'handy'.", standard: "RL.8.3", difficulty: 4 },
                    { id: 'c10', stem: "Final silence implication:", options: ["Emotional distance", "Agreement", "Anger", "Hearing loss"], correct_answer: "Emotional distance", rationale: "Resignation to their lack of connection.", standard: "RL.8.6", difficulty: 8 }
                ]
            },
            { 
                id: 'rok-lit-tortilla', 
                passage: "from Tortilla Sun: Mom in the kitchen with a chisel... 'I'm going to Costa Rica'... I rolled those words around: 'for the better'... like a lost balloon.", 
                items: [
                    { id: 't1', stem: "Tone of 'invisible nothing'?", options: ["Hopelessness", "Independence", "Curiosity", "Guilt"], correct_answer: "Hopelessness", rationale: "Metaphor for powerlessness.", standard: "RL.8.4", difficulty: 4 },
                    { id: 't2', stem: "'Rolling the words' suggests:", options: ["Skeptical analysis", "Happy acceptance", "Memorization", "Boredom"], correct_answer: "Skeptical analysis", rationale: "Mental processing of difficult news.", standard: "RL.8.1", difficulty: 6 },
                    { id: 't3', stem: "Cause of conflict:", options: ["Mom's research trip", "Messy kitchen", "Grades", "Heat"], correct_answer: "Mom's research trip", rationale: "The decision creates the physical gap.", standard: "RL.8.3", difficulty: 3 },
                    { id: 't4', stem: "Chisel symbolism:", options: ["Determination", "Anger", "Laziness", "Confusion"], correct_answer: "Determination", rationale: "Mom 'digging' into her findings.", standard: "RL.8.4", difficulty: 7 },
                    { id: 't5', stem: "Part A: Izzy's feeling:", options: ["Isolated and betrayed", "Excited", "Indifferent", "Confused but happy"], correct_answer: "Isolated and betrayed", rationale: "Balloon metaphor points to isolation.", standard: "RL.8.1", difficulty: 5 },
                    { id: 't6', stem: "Part B: Evidence for isolation:", options: ["'...lost balloon...'", "'Mom with a chisel...'", "'...sounds far.'", "'I rolled words.'"], correct_answer: "'...lost balloon...'", rationale: "Illustrates her feeling of being unanchored.", standard: "RL.8.1", difficulty: 4 },
                    { id: 't7', stem: "Meaning of 'for the better':", options: ["Bitter clich√©", "Hopeful plan", "Project", "Literal truth"], correct_answer: "Bitter clich√©", rationale: "She is skeptical of the mother's framing.", standard: "RL.8.4", difficulty: 6 },
                    { id: 't8', stem: "Trip implies Mother is:", options: ["Driven/Career-focused", "Lazily retiring", "Rich/Bored", "Hiding"], correct_answer: "Driven/Career-focused", rationale: "Field research is professional development.", standard: "RL.8.3", difficulty: 5 },
                    { id: 't9', stem: "Balloon metaphor purpose:", options: ["Show fading identity", "Describe party", "Discuss travel", "Toys"], correct_answer: "Show fading identity", rationale: "Identity loss context.", standard: "RL.8.4", difficulty: 9 },
                    { id: 't10', stem: "Theme:", options: ["Change leads to isolation", "Travel is education", "Stay together", "Fragile objects"], correct_answer: "Change leads to isolation", rationale: "Emotional center of text.", standard: "RL.8.2", difficulty: 8 }
                ]
            },
            {
                id: 'inf-ash-borer',
                passage: "The emerald ash borer (EAB) is an invasive beetle from Asia. It kills ash trees. It undergoes complete metamorphosis. It was detected in Michigan in 2002.",
                items: [
                    { id: 'ab1', stem: "Structure style:", options: ["General facts then problem", "Chronology", "Solution/Problem", "Random"], correct_answer: "General facts then problem", rationale: "Standard info structure.", standard: "RI.8.5", difficulty: 4 },
                    { id: 'ab2', stem: "'Not native' significance:", options: ["Lacks predators", "Small", "Pretty", "Eats ash"], correct_answer: "Lacks predators", rationale: "Biological concept.", standard: "RI.8.4", difficulty: 7 },
                    { id: 'ab3', stem: "Detection date:", options: ["2002", "1999", "2010", "1950"], correct_answer: "2002", rationale: "Recall.", standard: "RI.8.1", difficulty: 2 },
                    { id: 'ab4', stem: "'Metamorphosis':", options: ["Transformation", "Tree type", "Chemical", "Diet"], correct_answer: "Transformation", rationale: "Technical vocab.", standard: "L.8.4", difficulty: 3 },
                    { id: 'ab5', stem: "Primary threat:", options: ["Ash destruction", "Bites humans", "Eats crops", "Fumes"], correct_answer: "Ash destruction", rationale: "Stated threat.", standard: "RI.8.2", difficulty: 4 },
                    { id: 'ab6', stem: "Spread speed:", options: ["Fast", "Slow", "Beneficial", "Unknown"], correct_answer: "Fast", rationale: "Millions dead context.", standard: "RI.8.1", difficulty: 5 },
                    { id: 'ab7', stem: "Origin evidence:", options: ["'...not native...'", "'...Michigan.'", "'...Bark.'", "'...Small.'"], correct_answer: "'...not native...'", rationale: "Explicit evidence.", standard: "RI.8.1", difficulty: 3 },
                    { id: 'ab8', stem: "Purpose:", options: ["Inform", "Sell traps", "Entertain", "Tax hike"], correct_answer: "Inform", rationale: "Educational tone.", standard: "RI.8.6", difficulty: 5 },
                    { id: 'ab9', stem: "Initial location:", options: ["Michigan", "Florida", "California", "Texas"], correct_answer: "Michigan", rationale: "Recall.", standard: "RI.8.1", difficulty: 2 },
                    { id: 'ab10', stem: "Central idea:", options: ["Invasive threat", "Beetles are small", "Michigan trees", "Ash cost"], correct_answer: "Invasive threat", rationale: "Main point.", standard: "RI.8.2", difficulty: 6 }
                ]
            },
            {
                id: 'inf-snow-sand',
                passage: "Snowboarding vs Sandboarding. Sandboarding is arguably less risky. trudging Great Dunes requires fitness. Sandboards are cheaper.",
                items: [
                    { id: 'ss1', stem: "Which is 'less risky'?", options: ["Sandboarding", "Snowboarding", "Skiing", "Surfing"], correct_answer: "Sandboarding", rationale: "Direct comparison.", standard: "RI.8.9", difficulty: 4 },
                    { id: 'ss2', stem: "Shared requirement:", options: ["Physical fitness", "Snow tires", "Tickets", "Summer"], correct_answer: "Physical fitness", rationale: "Trudging context.", standard: "RI.8.1", difficulty: 5 },
                    { id: 'ss3', stem: "'Shredding' mention:", options: ["Connect with culture", "Dangers", "Winter", "Paper"], correct_answer: "Connect with culture", rationale: "Slang usage.", standard: "L.8.4", difficulty: 6 },
                    { id: 'ss4', stem: "Part A: 'Niche' sport?", options: ["Specialized audience", "Illegal", "High tech", "Children"], correct_answer: "Specialized audience", rationale: "Context meaning.", standard: "L.8.4", difficulty: 7 },
                    { id: 'ss5', stem: "Part B: Niche evidence:", options: ["'...unknown outside state.'", "'...similar.'", "'...requires fitness.'", "'...online.'"], correct_answer: "'...unknown outside state.'", rationale: "Limited appeal indicator.", standard: "RI.8.1", difficulty: 5 },
                    { id: 'ss6', stem: "Sandboarding advantage:", options: ["Lower cost", "Speed", "Fame", "Lifts"], correct_answer: "Lower cost", rationale: "Cheaper context.", standard: "RI.8.1", difficulty: 3 },
                    { id: 'ss7', stem: "Sandboarding tone:", options: ["Adventurous/Informative", "Fearful", "Technical", "Dismissive"], correct_answer: "Adventurous/Informative", rationale: "Joy focus.", standard: "RI.8.6", difficulty: 6 },
                    { id: 'ss8', stem: "'Edge control':", options: ["Maneuvering", "Standing", "Buying", "Falling"], correct_answer: "Maneuvering", rationale: "Technical context.", standard: "L.8.4", difficulty: 5 },
                    { id: 'ss9', stem: "Joy detail:", options: ["Quiet/Empty space", "Music", "People", "Shops"], correct_answer: "Quiet/Empty space", rationale: "Quote recall.", standard: "RI.8.1", difficulty: 4 },
                    { id: 'ss10', stem: "Summary:", options: ["Cheaper alternative", "Summer vs Winter", "Dangerous", "Skiing better"], correct_answer: "Cheaper alternative", rationale: "Synthesizes comparison.", standard: "RI.8.2", difficulty: 8 }
                ]
            },
            {
                id: 'inf-elephant-master',
                passage: "Asian elephants console others. Emotional contagion. Thailand study: Mahouts turned away to minimize cuing. Pachyderms wait for partners.",
                items: [
                    { id: 'e1', stem: "Why use invisible signals?", options: ["Ensure independent choice", "Quiet", "Time", "Safety"], correct_answer: "Ensure independent choice", rationale: "Scientific control.", standard: "RI.8.8", difficulty: 8 },
                    { id: 'e2', stem: "Distress sign:", options: ["Flares ears", "Closes eyes", "Lies down", "Fast"], correct_answer: "Flares ears", rationale: "Factual detail.", standard: "RI.8.1", difficulty: 2 },
                    { id: 'e3', stem: "'Emotional contagion':", options: ["Spread to others", "Virus", "Learned", "Human only"], correct_answer: "Spread to others", rationale: "Contagion meaning.", standard: "RI.8.4", difficulty: 7 },
                    { id: 'e4', stem: "'Anecdotal' meaning:", options: ["Personal stories", "High speed", "Math", "Maps"], correct_answer: "Personal stories", rationale: "Meaning in research.", standard: "L.8.4", difficulty: 6 },
                    { id: 'e5', stem: "Part A: Main conclusion?", options: ["Understand cooperation", "Better than humans", "Prefer eating", "Hate ropes"], correct_answer: "Understand cooperation", rationale: "Study proof.", standard: "RI.8.2", difficulty: 7 },
                    { id: 'e6', stem: "Part B: Quote supporting A?", options: ["'...fail without assistance.'", "'...mahouts turned away.'", "'...ears.'", "'...Thai researchers.'"], correct_answer: "'...fail without assistance.'", rationale: "States logic of success.", standard: "RI.8.1", difficulty: 6 },
                    { id: 'e7', stem: "Why study them?", options: ["Advanced social traits", "Only ones left", "Easier catch", "Fast"], correct_answer: "Advanced social traits", rationale: "Empathy context.", standard: "RI.8.3", difficulty: 5 },
                    { id: 'e8', stem: "'Cognition':", options: ["Knowing processes", "Speed", "Size", "Color"], correct_answer: "Knowing processes", rationale: "Definition.", standard: "L.8.4", difficulty: 4 },
                    { id: 'e9', stem: "Bias solution:", options: ["Stress vs Quiet compare", "Higher pay", "Bigger ropes", "Ending early"], correct_answer: "Stress vs Quiet compare", rationale: "Control detail.", standard: "RI.8.8", difficulty: 9 },
                    { id: 'e10', stem: "Most objective author?", options: ["Researchers", "Confetti narrator", "Tortilla narrator", "Boarding fan"], correct_answer: "Researchers", rationale: "Info vs Literary focus.", standard: "RI.8.6", difficulty: 10 }
                ]
            },
            {
                id: 'lit-balabad-matrix',
                passage: "Bahauddin Shah was the keeper of Balabad‚Äôs secrets. Below the fortress was a world he alone knew. He held the seven keys. One must never be lost.",
                items: [
                    { id: 'b1', stem: "Bahauddin's primary role:", options: ["Guardian of secrets", "Fortress cook", "Lost traveler", "Enemy spy"], correct_answer: "Guardian of secrets", rationale: "Explicitly keeper of secrets.", standard: "RL.8.3", difficulty: 3 },
                    { id: 'b2', stem: "Setting's mood:", options: ["Mysterious/Ancient", "Modern/Bright", "Scary/Loud", "Funny/Light"], correct_answer: "Mysterious/Ancient", rationale: "Fortress/secrets context.", standard: "RL.8.1", difficulty: 4 },
                    { id: 'b3', stem: "Importance of the keys:", options: ["Hold the power of Balabad", "Unlock the pantry", "Are toys for children", "Are gifts from guests"], correct_answer: "Hold the power of Balabad", rationale: "Symbolic protective objects.", standard: "RL.8.2", difficulty: 6 },
                    { id: 'b4', stem: "Bahauddin's relationship to the caverns:", options: ["Deeply knowledgeable/Connected", "Afraid/Lost", "Interested in selling them", "Wants to flood them"], correct_answer: "Deeply knowledgeable/Connected", rationale: "He 'alone knew' them.", standard: "RL.8.3", difficulty: 5 },
                    { id: 'b5', stem: "Part A: Significance of 'he alone knew'?", options: ["Emphasizes his heavy responsibility", "Shows he is lonely", "Proves he is selfish", "Suggests he is the last person alive"], correct_answer: "Emphasizes his heavy responsibility", rationale: "Weight of unique knowledge.", standard: "RL.8.1", difficulty: 6 },
                    { id: 'b6', stem: "Part B: Quote supporting responsibility?", options: ["' keeper of Balabad‚Äôs secrets.'", "'Below the fortress...'", "'...he alone knew.'", "'One must never be lost.'"], correct_answer: "' keeper of Balabad‚Äôs secrets.'", rationale: "Defines his duty.", standard: "RL.8.1", difficulty: 5 },
                    { id: 'b7', stem: "Meaning of 'fortress' in context:", options: ["Stronghold", "Garden", "Beach house", "Ruins"], correct_answer: "Stronghold", rationale: "Standard definition.", standard: "L.8.4", difficulty: 4 },
                    { id: 'b8', stem: "Author's word choice (grip, stumbled) creates:", options: ["A sense of urgency", "A feeling of joy", "A scientific tone", "Boredom"], correct_answer: "A sense of urgency", rationale: "Physical struggle indicates importance.", standard: "RL.8.4", difficulty: 6 },
                    { id: 'b9', stem: "Why is Bahauddin 'stumbling'?", options: ["The environment is difficult to navigate", "He is very old and tired", "He is being chased by guards", "He is drunk on power"], correct_answer: "The environment is difficult to navigate", rationale: "Passageway context.", standard: "RL.8.3", difficulty: 5 },
                    { id: 'b10', stem: "Theme of guardianship:", options: ["Duty requires great personal knowledge and sacrifice.", "Secrets are meant to be shared.", "Caves are safe places to hide treasure.", "Fortresses are always eventually captured."], correct_answer: "Duty requires great personal knowledge and sacrifice.", rationale: "Synthesizes Bahauddin's character and mission.", standard: "RL.8.2", difficulty: 9 }
                ]
            },
            {
                id: 'lit-frost-road',
                passage: "The Road Not Taken by Robert Frost: Two roads diverged in a yellow wood... I took the one less traveled by... And that has made all the difference.",
                items: [
                    { id: 'f1', stem: "Metaphor for 'roads'?", options: ["Life choices", "Hiking trails", "River paths", "Train tracks"], correct_answer: "Life choices", rationale: "Standard poetic analysis.", standard: "RL.8.4", difficulty: 3 },
                    { id: 'f2', stem: "Meaning of 'diverged'?", options: ["Split into two", "Merged together", "Disappeared", "Was paved"], correct_answer: "Split into two", rationale: "Vocabulary context.", standard: "L.8.4", difficulty: 4 },
                    { id: 'f3', stem: "Narrator's tone toward the future:", options: ["Reflective", "Terrified", "Happy", "Bored"], correct_answer: "Reflective", rationale: "Sigh context.", standard: "RL.8.4", difficulty: 5 },
                    { id: 'f4', stem: "Why take the one 'less traveled'?", options: ["Desire for unique experience", "It was easier", "It was shorter", "The other was scary"], correct_answer: "Desire for unique experience", rationale: "Inferred motivation.", standard: "RL.8.3", difficulty: 5 },
                    { id: 'f5', stem: "Part A: Narrator's feelings on the split?", options: ["Slight regret at not choosing both", "Complete happiness", "Boredom", "Anger at the wood"], correct_answer: "Slight regret at not choosing both", rationale: "Sigh and 'long I stood' context.", standard: "RL.8.1", difficulty: 6 },
                    { id: 'f6', stem: "Part B: Quote for regret/longing?", options: ["'And sorry I could not travel both'", "'And be one traveler'", "'Two roads diverged'", "'Made all the difference'"], correct_answer: "'And sorry I could not travel both'", rationale: "Explicit expression of longing.", standard: "RL.8.1", difficulty: 5 },
                    { id: 'f7', stem: "What is the 'yellow wood'?", options: ["Autumn forest", "Desert", "City at night", "Painted scenery"], correct_answer: "Autumn forest", rationale: "Seasonal metaphor.", standard: "RL.8.4", difficulty: 4 },
                    { id: 'f8', stem: "Structure of poem (rhyme):", options: ["ABAAB", "AABB", "ABBA", "Free verse"], correct_answer: "ABAAB", rationale: "Technical recall.", standard: "RL.8.5", difficulty: 7 },
                    { id: 'f9', stem: "Meaning of 'undergrowth'?", options: ["Low-growing plants", "Dirt", "Roots", "Sky"], correct_answer: "Low-growing plants", rationale: "Context.", standard: "L.8.4", difficulty: 3 },
                    { id: 'f10', stem: "Theme of individuality:", options: ["The choices we make define our unique path.", "Nature is dangerous.", "Always take the safe road.", "People should walk together."], correct_answer: "The choices we make define our unique path.", rationale: "Overall message.", standard: "RL.8.2", difficulty: 8 }
                ]
            },
            {
                id: 'lit-whitman-captain',
                passage: "O Captain! My Captain! by Walt Whitman: Our fearful trip is done... The ship has weather‚Äôd every rack... But O heart! heart! heart! ... Where on the deck my Captain lies, Fallen cold and dead.",
                items: [
                    { id: 'w1', stem: "Who is the 'Captain' a metaphor for?", options: ["Abraham Lincoln", "George Washington", "Walt Whitman", "A pirate"], correct_answer: "Abraham Lincoln", rationale: "Historical literary context.", standard: "RL.8.4", difficulty: 6 },
                    { id: 'w2', stem: "The 'fearful trip' represents:", options: ["The Civil War", "A vacation", "A storm at sea", "A dream"], correct_answer: "The Civil War", rationale: "Historical context.", standard: "RL.8.4", difficulty: 7 },
                    { id: 'w3', stem: "Mood shift in the poem:", options: ["Triumph to Grief", "Sadness to Joy", "Boredom to Anger", "Fear to Peace"], correct_answer: "Triumph to Grief", rationale: "Winning the prize vs dead captain.", standard: "RL.8.4", difficulty: 5 },
                    { id: 'w4', stem: "Meaning of 'weather‚Äôd every rack'?", options: ["Survived every struggle", "Fixed the boat", "Ignored the wind", "Painted the ship"], correct_answer: "Survived every struggle", rationale: "Metaphorical survival.", standard: "L.8.4", difficulty: 6 },
                    { id: 'w5', stem: "Part A: Narrator's emotional state?", options: ["Deep personal mourning", "Professional duty", "Excitement", "Indifference"], correct_answer: "Deep personal mourning", rationale: "Heart! heart! repetition.", standard: "RL.8.1", difficulty: 6 },
                    { id: 'w6', stem: "Part B: Quote for mourning?", options: ["'But O heart! heart! heart!'", "'The prize we sought is won'", "'The port is near'", "'Rise up and hear the bells'"], correct_answer: "'But O heart! heart! heart!'", rationale: "Intense emotional outburst.", standard: "RL.8.1", difficulty: 5 },
                    { id: 'w7', stem: "Significance of 'bells' and 'bugle'?", options: ["Celebrate victory", "Warn of danger", "Call for food", "Start a dance"], correct_answer: "Celebrate victory", rationale: "Context of port arrival.", standard: "RL.8.4", difficulty: 5 },
                    { id: 'w8', stem: "Contrasting images:", options: ["Bells ringing vs Fallen cold", "Ship moving vs Ship anchored", "Water vs Wood", "Sun vs Moon"], correct_answer: "Bells ringing vs Fallen cold", rationale: "Juxtaposition of victory/death.", standard: "RL.8.4", difficulty: 8 },
                    { id: 'w9', stem: "Role of the Narrator:", options: ["A crew member", "The Captain", "A civilian on shore", "A ghost"], correct_answer: "A crew member", rationale: "Addressing 'My Captain' on the deck.", standard: "RL.8.3", difficulty: 5 },
                    { id: 'w10', stem: "Theme of loss in victory:", options: ["Great achievements often come with profound personal loss.", "Winning is the only thing that matters.", "Ships are safer than land.", "Captaincy is a dangerous job."], correct_answer: "Great achievements often come with profound personal loss.", rationale: "Synthesizes the victory of war/death of leader.", standard: "RL.8.2", difficulty: 9 }
                ]
            },
            {
                id: 'lit-london-wild',
                passage: "from The Call of the Wild by Jack London: Buck did not read the newspapers... He was king over all creeping, crawling, flying things of Judge Miller's place... He had a fine pride in himself, was even a trifle egotistical.",
                items: [
                    { id: 'l1', stem: "Buck's status in his home:", options: ["Dominant and proud", "Afraid and hidden", "Lazy and hungry", "A working farm dog"], correct_answer: "Dominant and proud", rationale: "'King over all things'.", standard: "RL.8.3", difficulty: 3 },
                    { id: 'l2', stem: "Meaning of 'egotistical'?", options: ["Self-important", "Very fast", "Hungry", "Loud"], correct_answer: "Self-important", rationale: "Vocabulary context.", standard: "L.8.4", difficulty: 4 },
                    { id: 'l3', stem: "Contrast between Buck and 'newspapers'?", options: ["He is unaware of the outside world's danger.", "He reads better than the judge.", "He is a famous dog.", "He delivers the mail."], correct_answer: "He is unaware of the outside world's danger.", rationale: "Irony of coming danger.", standard: "RL.8.1", difficulty: 6 },
                    { id: 'l4', stem: "Setting's initial tone:", options: ["Comfortable and peaceful", "Harsh and cold", "Busy city life", "Scary and dark"], correct_answer: "Comfortable and peaceful", rationale: "Judge Miller's place context.", standard: "RL.8.1", difficulty: 2 },
                    { id: 'l5', stem: "Part A: Buck's personality?", options: ["Noble but naive", "Mean and aggressive", "Small and weak", "Intelligent and cautious"], correct_answer: "Noble but naive", rationale: "King status vs newspaper ignorance.", standard: "RL.8.3", difficulty: 5 },
                    { id: 'l6', stem: "Part B: Quote for naivety?", options: ["'Buck did not read the newspapers.'", "'King over all...'", "'Fine pride...'", "'Sun-kissed Santa Clara Valley.'"], correct_answer: "'Buck did not read the newspapers.'", rationale: "He doesn't know what's coming.", standard: "RL.8.1", difficulty: 4 },
                    { id: 'l7', stem: "Role of the 'Judge'?", options: ["Owner/Authority figure", "A literal judge of dogs", "A criminal", "Buck's father"], correct_answer: "Owner/Authority figure", rationale: "Provides the protected setting.", standard: "RL.8.3", difficulty: 4 },
                    { id: 'l8', stem: "Point of View:", options: ["Third-person limited (Buck)", "First-person (Judge)", "Third-person omniscient", "Second-person"], correct_answer: "Third-person limited (Buck)", rationale: "Focus on Buck's thoughts.", standard: "RL.8.6", difficulty: 7 },
                    { id: 'l9', stem: "Meaning of 'trifle'?", options: ["Small amount", "Large meal", "Type of gun", "A dog toy"], correct_answer: "Small amount", rationale: "Vocabulary context.", standard: "L.8.4", difficulty: 5 },
                    { id: 'l10', stem: "Theme of protected life:", options: ["Comfort can leave one unprepared for harsh realities.", "Newspapers are only for humans.", "Dogs should never leave home.", "Kings are always safe."], correct_answer: "Comfort can leave one unprepared for harsh realities.", rationale: "Captures the tension of the intro.", standard: "RL.8.2", difficulty: 8 }
                ]
            },
            {
                id: 'lit-poe-heart',
                passage: "from The Tell-Tale Heart by Edgar Allan Poe: True!‚Äînervous‚Äîvery, very dreadfully nervous I had been and am; but why will you say that I am mad? Hearken! and observe how healthily‚Äîhow calmly I can tell you the whole story.",
                items: [
                    { id: 'p1', stem: "Narrator's goal in telling the story:", options: ["To prove he is not insane", "To confess to a friend", "To describe a dream", "To teach a lesson"], correct_answer: "To prove he is not insane", rationale: "Explicit 'why will you say that I am mad?'", standard: "RL.8.3", difficulty: 4 },
                    { id: 'p2', stem: "Narrator's tone:", options: ["Agitated and defensive", "Peaceful and calm", "Funny and light", "Bored"], correct_answer: "Agitated and defensive", rationale: "Dreadfully nervous / but why...?", standard: "RL.8.4", difficulty: 5 },
                    { id: 'p3', stem: "Effect of 'very, very' repetition:", options: ["Shows his extreme agitation", "Shows he is slow at speaking", "Indicates he is lying", "Helps him sound normal"], correct_answer: "Shows his extreme agitation", rationale: "Standard Poe technique for intensity.", standard: "RL.8.4", difficulty: 6 },
                    { id: 'p4', stem: "Meaning of 'mad' here:", options: ["Insane", "Angry", "Fast", "Brave"], correct_answer: "Insane", rationale: "Context of sanity/story.", standard: "L.8.4", difficulty: 2 },
                    { id: 'p5', stem: "Part A: Narrator's reliability?", options: ["Unreliable/Mentally unstable", "Deeply honest", "Scientific and factual", "Brave"], correct_answer: "Unreliable/Mentally unstable", rationale: "Admits nervousness while claiming health.", standard: "RL.8.3", difficulty: 7 },
                    { id: 'p6', stem: "Part B: Quote for instability?", options: ["'True!‚Äînervous‚Äîvery, very dreadfully nervous...'", "'...how calmly I can tell you...'", "'Hearken!'", "'...whole story.'"], correct_answer: "'True!‚Äînervous‚Äîvery, very dreadfully nervous...'", rationale: "Contradicts his claim of 'calm'.", standard: "RL.8.1", difficulty: 5 },
                    { id: 'p7', stem: "Meaning of 'Hearken!'?", options: ["Listen carefully", "Be quiet", "Look over there", "Run away"], correct_answer: "Listen carefully", rationale: "Archaic command.", standard: "L.8.4", difficulty: 5 },
                    { id: 'p8', stem: "How he intends to tell the story:", options: ["Calmly", "Loudly", "In code", "To the police"], correct_answer: "Calmly", rationale: "His stated intention.", standard: "RL.8.1", difficulty: 3 },
                    { id: 'p9', stem: "Poe's pacing style here:", options: ["Choppy/Interrupted", "Flowing/Long", "Boring/Slow", "Informational"], correct_answer: "Choppy/Interrupted", rationale: "Use of dashes and short phrases.", standard: "RL.8.4", difficulty: 8 },
                    { id: 'p10', stem: "Theme of sanity:", options: ["The desperate need to appear rational can reveal true mental break.", "Storytelling is easy for everyone.", "Nervousness is the same as madness.", "Health is better than sickness."], correct_answer: "The desperate need to appear rational can reveal true mental break.", rationale: "Synthesizes narrator's intent vs reality.", standard: "RL.8.2", difficulty: 10 }
                ]
            },
            // NEW CONTENT (Argument, Grammar, Comparison)
            {
                id: 'arg-school-start',
                passage: "<b>Editorial: Sleep, Schools, and Success</b><br>Adolescents have different circadian rhythms than adults. Studies show that melatonin secretion shifts later in teenagers. <br><br>Therefore, forcing an 8:00 AM start time is akin to asking an adult to start work at 4:00 AM. Opponents argue that bus schedules would be too expensive to change. However, the cost of sleep-deprived students‚Äîlost productivity and mental health crises‚Äîis far higher.",
                items: [
                    { id: 'arg1', stem: "What is the author's primary claim?", options: ["School start times should be later.", "Busses are too expensive.", "Melatonin is a hormone.", "Adults work too early."], correct_answer: "School start times should be later.", rationale: "The central argument supported by the evidence.", standard: "RI.8.8", difficulty: 4 },
                    { id: 'arg2', stem: "How does the author respond to the counterclaim about bus schedules?", options: ["By admitting it is a problem.", "By comparing it to the higher cost of health crises.", "By suggesting students walk.", "By ignoring it."], correct_answer: "By comparing it to the higher cost of health crises.", rationale: "Rebuttal technique.", standard: "RI.8.8", difficulty: 6 },
                    { id: 'arg3', stem: "The phrase 'akin to asking' suggests:", options: ["A direct comparison/analogy", "A scientific fact", "A humorous joke", "A legal demand"], correct_answer: "A direct comparison/analogy", rationale: "Analogy used for rhetorical effect.", standard: "RI.8.4", difficulty: 5 },
                    { id: 'arg4', stem: "Part A: Is the evidence regarding melatonin relevant?", options: ["Yes, it provides biological proof.", "No, it is about biology, not school.", "Yes, but it is outdated.", "No, because teens stay up late by choice."], correct_answer: "Yes, it provides biological proof.", rationale: "Evaluates the soundness of reasoning.", standard: "RI.8.8", difficulty: 7 },
                    { id: 'arg5', stem: "Part B: Which quote supports Part A?", options: ["'...shifts later in teenagers.'", "'...bus schedules...'", "'...akin to asking...'", "'...mental health crises.'"], correct_answer: "'...shifts later in teenagers.'", rationale: "Direct evidence linkage.", standard: "RI.8.1", difficulty: 5 },
                    { id: 'arg6', stem: "The author uses the word 'forcing' to create a tone of:", options: ["Injustice/Urgency", "Happiness", "Neutrality", "Confusion"], correct_answer: "Injustice/Urgency", rationale: "Connotative word choice.", standard: "RI.8.4", difficulty: 6 },
                    { id: 'arg7', stem: "Which piece of evidence would weaken the argument?", options: ["Data showing later starts do not improve grades.", "Quotes from tired students.", "Doctor testimony on sleep.", "Bus driver schedules."], correct_answer: "Data showing later starts do not improve grades.", rationale: "Evaluating conflicting evidence.", standard: "RI.8.8", difficulty: 9 },
                    { id: 'arg8', stem: "Standard: Active vs Passive Voice. Select the Passive sentence:", options: ["The decision was made by the board.", "The board made the decision.", "Students hate early mornings.", "Teachers drink coffee."], correct_answer: "The decision was made by the board.", rationale: "Subject receives the action.", standard: "L.8.3", difficulty: 5 },
                    { id: 'arg9', stem: "Identify the mood of this verb: 'If schools *were* to start later...'", options: ["Subjunctive (Hypothetical)", "Imperative (Command)", "Indicative (Fact)", "Interrogative (Question)"], correct_answer: "Subjunctive (Hypothetical)", rationale: "Grammar mood identification.", standard: "L.8.1", difficulty: 8 },
                    { id: 'arg10', stem: "Author's purpose:", options: ["To persuade", "To entertain", "To inform", "To narrate"], correct_answer: "To persuade", rationale: "Argumentative text purpose.", standard: "RI.8.6", difficulty: 3 }
                ]
            },
            {
                id: 'lang-editor-desk',
                passage: "<b>The Editor's Desk (Grammar Challenge)</b><br>Read the draft: (1) Running through the park, the trees looked beautiful. (2) I stopped to tie my shoe. (3) The dog, who was barking loudly, chased the squirrel.",
                items: [
                    { id: 'gr1', stem: "Sentence 1 contains which error?", options: ["Dangling Modifier", "Comma Splice", "Run-on Sentence", "Spelling"], correct_answer: "Dangling Modifier", rationale: "The trees were not running.", standard: "L.8.1", difficulty: 6 },
                    { id: 'gr2', stem: "How should Sentence 1 be fixed?", options: ["Running through the park, I saw beautiful trees.", "The trees looked beautiful, running through the park.", "Running, the trees were park-like.", "Leave as is."], correct_answer: "Running through the park, I saw beautiful trees.", rationale: "Corrects the modifier target.", standard: "L.8.1", difficulty: 5 },
                    { id: 'gr3', stem: "What is the function of the gerund 'Running'?", options: ["It acts as a noun/subject.", "It is the main verb.", "It is an adjective describing trees.", "It is a preposition."], correct_answer: "It acts as a noun/subject.", rationale: "Function of verbals.", standard: "L.8.1", difficulty: 7 },
                    { id: 'gr4', stem: "Sentence 3: The phrase 'who was barking loudly' is...", options: ["Non-restrictive (requires commas)", "Restrictive (no commas)", "An independent clause", "A passive verb"], correct_answer: "Non-restrictive (requires commas)", rationale: "Extra information rule.", standard: "L.8.2", difficulty: 6 },
                    { id: 'gr5', stem: "Choose the correct spelling:", options: ["Necessary", "Neccessary", "Necesary", "Neccesary"], correct_answer: "Necessary", rationale: "Spelling conventions.", standard: "L.8.2", difficulty: 5 },
                    { id: 'gr6', stem: "Identify the Infinitive:", options: ["To tie", "Stopped", "Running", "Barking"], correct_answer: "To tie", rationale: "To + Verb form.", standard: "L.8.1", difficulty: 4 },
                    { id: 'gr7', stem: "Ellipsis (...) usage:", options: ["Indicates a pause or omission", "Ends a sentence", "Shows excitement", "Lists items"], correct_answer: "Indicates a pause or omission", rationale: "Punctuation function.", standard: "L.8.2", difficulty: 5 },
                    { id: 'gr8', stem: "Meaning of the root 'spec' (spectator, inspect):", options: ["To look/see", "To build", "To write", "To hear"], correct_answer: "To look/see", rationale: "Greek/Latin roots.", standard: "L.8.4", difficulty: 4 },
                    { id: 'gr9', stem: "Which sentence uses the Active Voice?", options: ["The dog chased the squirrel.", "The squirrel was chased by the dog.", "The shoe was tied.", "The park was run through."], correct_answer: "The dog chased the squirrel.", rationale: "Subject does the action.", standard: "L.8.3", difficulty: 4 },
                    { id: 'gr10', stem: "Analogy -> Writer : Pen :: Painter : ?", options: ["Brush", "Canvas", "Paint", "Museum"], correct_answer: "Brush", rationale: "Tool to Worker relationship.", standard: "L.8.5", difficulty: 6 }
                ]
            },
            {
                id: 'lit-myth-remix',
                passage: "<b>Myth: Prometheus</b> stole fire from the gods to give to humanity, suffering eternal punishment for his gift.<br><b>Modern: Frankenstein</b> by Mary Shelley. Dr. Frankenstein assembles a creature from old parts and uses electricity to give it life, but is horrified by his own creation.",
                items: [
                    { id: 'comp1', stem: "Both passages explore the theme of:", options: ["The dangers of creating life/knowledge", "Hiking mountains", "Stealing money", "Electrical engineering"], correct_answer: "The dangers of creating life/knowledge", rationale: "Shared theme of forbidden creation.", standard: "RL.8.9", difficulty: 6 },
                    { id: 'comp2', stem: "How does the Modern text transform the Myth?", options: ["Replaces gods/magic with science", "Changes the hero to a villain", "Makes it a comedy", "Removes the punishment"], correct_answer: "Replaces gods/magic with science", rationale: "Standard RL.8.9 transformation analysis.", standard: "RL.8.9", difficulty: 7 },
                    { id: 'comp3', stem: "Prometheus is motivated by:", options: ["Helping humanity", "Greed", "Boredom", "Hunger"], correct_answer: "Helping humanity", rationale: "Character motivation.", standard: "RL.8.3", difficulty: 3 },
                    { id: 'comp4', stem: "Frankenstein's reaction to his creation:", options: ["Horror/Regret", "Joy", "Pride", "Indifference"], correct_answer: "Horror/Regret", rationale: "Textual evidence.", standard: "RL.8.1", difficulty: 4 },
                    { id: 'comp5', stem: "Prometheus 'stole fire'. What is the 'fire' in Frankenstein?", options: ["Electricity/Life", "Actual fire", "A torch", "The sun"], correct_answer: "Electricity/Life", rationale: "Symbolic comparison.", standard: "RL.8.4", difficulty: 6 },
                    { id: 'comp6', stem: "Part A: Tone difference?", options: ["Myth is heroic; Modern is gothic/fearful", "Both are funny", "Myth is sad; Modern is happy", "No difference"], correct_answer: "Myth is heroic; Modern is gothic/fearful", rationale: "Tone analysis.", standard: "RL.8.4", difficulty: 7 },
                    { id: 'comp7', stem: "Part B: Evidence for 'Gothic/Fearful'?", options: ["'...horrified by his own creation.'", "'...stole fire...'", "'...give to humanity.'", "'...old parts.'"], correct_answer: "'...horrified by his own creation.'", rationale: "Support for tone.", standard: "RL.8.1", difficulty: 5 },
                    { id: 'comp8', stem: "Who acts as the 'God' figure in the modern text?", options: ["Dr. Frankenstein", "The Creature", "Prometheus", "The electricity"], correct_answer: "Dr. Frankenstein", rationale: "Archetypal analysis.", standard: "RL.8.9", difficulty: 8 },
                    { id: 'comp9', stem: "The structure of the Myth summary is:", options: ["Cause and Effect", "Chronological", "Compare/Contrast", "Problem/Solution"], correct_answer: "Cause and Effect", rationale: "Action (theft) -> Consequence (punishment).", standard: "RL.8.5", difficulty: 5 },
                    { id: 'comp10', stem: "Modern relevance:", options: ["Questions the ethics of technology", "Teaches how to build fires", "Warns against stealing", "Promotes exercise"], correct_answer: "Questions the ethics of technology", rationale: "Synthesizing theme for modern day.", standard: "RL.8.2", difficulty: 8 }
                ]
            },
            // NEW CONTENT (Vocab, Media, Bio)
            {
                id: 'voc-roots-lab',
                passage: "<b>The Etymology Lab</b><br>Dr. Morpheme studies words. (1) The <i>benevolent</i> king smiled. (2) The <i>chronometer</i> broke. (3) The <i>cacophony</i> in the cafeteria was unbearable. (4) The politician's speech was <i>ambiguous</i>.",
                items: [
                    { id: 'v1', stem: "Based on the root 'bene', 'benevolent' means:", options: ["Kind/Good-willed", "Evil", "Wealthy", "Sick"], correct_answer: "Kind/Good-willed", rationale: "Bene = Good (Latin).", standard: "L.8.4.b", difficulty: 3 },
                    { id: 'v2', stem: "The root 'chron' in 'chronometer' refers to:", options: ["Time", "Distance", "Heat", "Color"], correct_answer: "Time", rationale: "Chronos = Time (Greek).", standard: "L.8.4.b", difficulty: 4 },
                    { id: 'v3', stem: "If 'phon' means sound, 'cacophony' suggests:", options: ["Harsh/Bad noise", "Beautiful music", "Silence", "Whispering"], correct_answer: "Harsh/Bad noise", rationale: "Caco = Bad + Phon = Sound.", standard: "L.8.4.b", difficulty: 6 },
                    { id: 'v4', stem: "The prefix 'ambi' in 'ambiguous' means:", options: ["Both/Around", "One", "None", "Against"], correct_answer: "Both/Around", rationale: "Ambi = Both (unclear because it could be two things).", standard: "L.8.4.b", difficulty: 5 },
                    { id: 'v5', stem: "Which word shares a root with 'spectacle'?", options: ["Inspect", "Special", "Speed", "Space"], correct_answer: "Inspect", rationale: "Spec = To look.", standard: "L.8.4.b", difficulty: 3 },
                    { id: 'v6', stem: "Analogy -> Microscope : Small :: Telescope : ?", options: ["Distant", "Large", "Hot", "Space"], correct_answer: "Distant", rationale: "Tool function relationship.", standard: "L.8.5.b", difficulty: 5 },
                    { id: 'v7', stem: "Irony Check: A fire station burns down. This is:", options: ["Situational Irony", "Verbal Irony", "Dramatic Irony", "Coincidence"], correct_answer: "Situational Irony", rationale: "The opposite of what is expected happens.", standard: "L.8.5.a", difficulty: 6 },
                    { id: 'v8', stem: "Nuance: Which word implies the strongest anger?", options: ["Furious", "Annoyed", "Upset", "Displeased"], correct_answer: "Furious", rationale: "Degrees of meaning.", standard: "L.8.5.c", difficulty: 2 },
                    { id: 'v9', stem: "Suffix '-logy' (Biology, Geology) means:", options: ["Study of", "Fear of", "Love of", "Made of"], correct_answer: "Study of", rationale: "Logy = Study.", standard: "L.8.4.b", difficulty: 3 },
                    { id: 'v10', stem: "Prefix 'anti-' vs 'ante-':", options: ["Against vs Before", "Before vs Against", "Small vs Big", "Love vs Hate"], correct_answer: "Against vs Before", rationale: "Confusing prefix distinction.", standard: "L.8.4.b", difficulty: 7 }
                ]
            },
            {
                id: 'media-shark-week',
                passage: "<b>Media Analysis: Shark Safety</b><br><b>Text Article:</b> Lists statistics showing shark attacks are rare (1 in 3 million). Explains shark behavior is usually investigative, not predatory.<br><b>Video Clip Description:</b> Shows a Great White breaching the water in slow motion with ominous music. A narrator shouts, 'Nature's perfect killer!'",
                items: [
                    { id: 'med1', stem: "How does the video differ from the text?", options: ["Video relies on fear/drama; Text relies on facts.", "Video is boring.", "Text is scary.", "They are exactly the same."], correct_answer: "Video relies on fear/drama; Text relies on facts.", rationale: "Contrasting medium approaches.", standard: "RI.8.7", difficulty: 4 },
                    { id: 'med2', stem: "What advantage does the video have over the text?", options: ["Visual impact of power/size.", "More accurate statistics.", "Better vocabulary.", "Easier to carry."], correct_answer: "Visual impact of power/size.", rationale: "Advantages of visual media.", standard: "RI.8.7", difficulty: 5 },
                    { id: 'med3', stem: "The music in the video is intended to:", options: ["Create a mood of suspense/danger.", "Help sharks dance.", "Relax the viewer.", "Sell boats."], correct_answer: "Create a mood of suspense/danger.", rationale: "Audio techniques in media.", standard: "RI.8.7", difficulty: 3 },
                    { id: 'med4', stem: "The text's purpose is likely:", options: ["To inform/de-escalate fear.", "To scare tourists.", "To sell shark cages.", "To protect fish."], correct_answer: "To inform/de-escalate fear.", rationale: "Author's purpose in text.", standard: "RI.8.6", difficulty: 4 },
                    { id: 'med5', stem: "Which source is more objective (unbiased)?", options: ["The Text", "The Video", "Neither", "Both"], correct_answer: "The Text", rationale: "Evaluating bias.", standard: "RI.8.6", difficulty: 6 },
                    { id: 'med6', stem: "The phrase 'Nature's perfect killer' is:", options: ["Subjective opinion", "Objective fact", "A statistic", "A lie"], correct_answer: "Subjective opinion", rationale: "Distinguishing fact vs opinion.", standard: "RI.8.8", difficulty: 5 },
                    { id: 'med7', stem: "If you wanted to write a research paper on safety, you would use:", options: ["The Text", "The Video", "A movie poster", "A toy shark"], correct_answer: "The Text", rationale: "Selecting sources.", standard: "RI.8.8", difficulty: 2 },
                    { id: 'med8', stem: "How does the slow motion affect the viewer?", options: ["Emphasizes power and detail.", "Makes the shark look slow.", "Saves time.", "Blurs the image."], correct_answer: "Emphasizes power and detail.", rationale: "Visual techniques.", standard: "RI.8.7", difficulty: 6 },
                    { id: 'med9', stem: "What information is likely missing from the video?", options: ["Statistical context of rarity.", "The color of the shark.", "The sound of water.", "The shark's teeth."], correct_answer: "Statistical context of rarity.", rationale: "Evaluating missing info in media.", standard: "RI.8.7", difficulty: 7 },
                    { id: 'med10', stem: "Theme shared by both:", options: ["Sharks are powerful creatures.", "Swimming is safe.", "Oceans are cold.", "Music is good."], correct_answer: "Sharks are powerful creatures.", rationale: "Synthesis.", standard: "RI.8.9", difficulty: 3 }
                ]
            },
            {
                id: 'bio-douglass',
                passage: "<b>from Narrative of the Life of Frederick Douglass</b><br>I set out with high hope, and a fixed purpose, at whatever cost of trouble, to learn how to read... The plan which I adopted, and the one by which I was most successful, was that of making friends of all the little white boys whom I met in the street. As many of these as I could, I converted into teachers.",
                items: [
                    { id: 'bio1', stem: "Douglass's 'fixed purpose' was:", options: ["To learn to read.", "To make friends.", "To escape immediately.", "To buy books."], correct_answer: "To learn to read.", rationale: "Explicit text detail.", standard: "RI.8.1", difficulty: 2 },
                    { id: 'bio2', stem: "The phrase 'converted into teachers' implies:", options: ["Resourcefulness and strategy.", "Religious conversion.", "Magic.", "Payment."], correct_answer: "Resourcefulness and strategy.", rationale: "Analyzing word choice.", standard: "RI.8.4", difficulty: 5 },
                    { id: 'bio3', stem: "What is the irony in his method?", options: ["He used the oppressors' children to gain freedom.", "He didn't like reading.", "The boys were mean.", "He was already a teacher."], correct_answer: "He used the oppressors' children to gain freedom.", rationale: "Situational irony in history.", standard: "RI.8.6", difficulty: 7 },
                    { id: 'bio4', stem: "Tone of the passage:", options: ["Determined and reflective.", "Angry and loud.", "Sad and hopeless.", "Funny."], correct_answer: "Determined and reflective.", rationale: "Tone analysis.", standard: "RI.8.6", difficulty: 4 },
                    { id: 'bio5', stem: "This text is an example of:", options: ["Autobiography/Memoir", "Fantasy", "Science Fiction", "Persuasive Essay"], correct_answer: "Autobiography/Memoir", rationale: "Genre identification.", standard: "RI.8.1", difficulty: 3 },
                    { id: 'bio6', stem: "Which character trait best describes Douglass here?", options: ["Perseverant", "Lucky", "Passive", "Fearful"], correct_answer: "Perseverant", rationale: "Characterization in nonfiction.", standard: "RI.8.3", difficulty: 4 },
                    { id: 'bio7', stem: "'High hope' contrasts with:", options: ["The reality of his enslavement.", "The weather.", "His age.", "The cost of books."], correct_answer: "The reality of his enslavement.", rationale: "Context clues.", standard: "RI.8.4", difficulty: 6 },
                    { id: 'bio8', stem: "Structure: The passage moves from:", options: ["Goal to Strategy.", "Strategy to Failure.", "Past to Future.", "Anger to Joy."], correct_answer: "Goal to Strategy.", rationale: "Text structure.", standard: "RI.8.5", difficulty: 5 },
                    { id: 'bio9', stem: "Why mention 'whatever cost of trouble'?", options: ["To show the risk involved.", "To complain.", "To mention money.", "To scare the reader."], correct_answer: "To show the risk involved.", rationale: "Analyzing stakes.", standard: "RI.8.3", difficulty: 5 },
                    { id: 'bio10', stem: "Central Idea:", options: ["Knowledge is the path to freedom.", "Making friends is good.", "Streets are dangerous.", "Reading is hard."], correct_answer: "Knowledge is the path to freedom.", rationale: "Main theme.", standard: "RI.8.2", difficulty: 6 }
                ]
            },

            // START GAP FILLER: WRITING & RHETORIC
            {
                id: 'wrt-urban-garden',
                passage: "<b>Student Draft: City Gardens</b><br>(1) Urban gardening is becoming popular in big cities. (2) It turns empty lots into green spaces. (3) My uncle has a farm in Ohio with cows. (4) Furthermore, these gardens provide fresh produce to neighborhoods that lack grocery stores. (5) ________, they bring communities together.",
                items: [
                    { id: 'w1', stem: "Which sentence is irrelevant and should be deleted?", options: ["Sentence 1", "Sentence 2", "Sentence 3", "Sentence 4"], correct_answer: "Sentence 3", rationale: "The uncle's farm is off-topic for 'Urban Gardening'.", standard: "W.8.2", difficulty: 3 },
                    { id: 'w2', stem: "Select the best transition word for the blank in Sentence 5:", options: ["However", "In addition", "Therefore", "On the other hand"], correct_answer: "In addition", rationale: "Adds another benefit (community) to the list.", standard: "W.8.2.c", difficulty: 4 },
                    { id: 'w3', stem: "Which sentence would best conclude this paragraph?", options: ["City gardens are hard work.", "Gardens are great for the environment and the people.", "I hate tomatoes.", "Farms are bigger than gardens."], correct_answer: "Gardens are great for the environment and the people.", rationale: "Summarizes the main points.", standard: "W.8.2.f", difficulty: 4 },
                    { id: 'w4', stem: "Where should the sentence 'Plants also help clean the city air.' be placed?", options: ["After Sentence 1", "After Sentence 2", "After Sentence 5", "Before Sentence 1"], correct_answer: "After Sentence 2", rationale: "Groups environmental benefits together.", standard: "W.8.2.c", difficulty: 6 },
                    { id: 'w5', stem: "What is the best way to combine Sentences 1 and 2?", options: ["Urban gardening is popular because it turns empty lots into green spaces.", "Urban gardening is popular, it turns lots green.", "Turning empty lots into green spaces and becoming popular.", "Urban gardening is popular; however, it turns lots green."], correct_answer: "Urban gardening is popular because it turns empty lots into green spaces.", rationale: "Shows the correct cause/effect relationship.", standard: "L.8.3.a", difficulty: 5 },
                    { id: 'w6', stem: "Identify the author's claim:", options: ["Urban gardens are beneficial.", "Cows are important.", "Grocery stores are far away.", "Cities are dirty."], correct_answer: "Urban gardens are beneficial.", rationale: "Main argument of the draft.", standard: "W.8.1", difficulty: 2 },
                    { id: 'w7', stem: "Which word is too vague in Sentence 1 ('big cities')?", options: ["Big", "Popular", "Gardening", "None"], correct_answer: "Big", rationale: "Could be replaced with 'metropolitan' or specific names.", standard: "L.8.3", difficulty: 7 },
                    { id: 'w8', stem: "Tone analysis: The draft is written in a...", options: ["Formal, informative style", "Angry, persuasive style", "Sad, narrative style", "Funny, joking style"], correct_answer: "Formal, informative style", rationale: "Objective presentation of facts.", standard: "W.8.2.e", difficulty: 4 },
                    { id: 'w9', stem: "Standard English: Is 'produce' used as a noun or verb in Sentence 4?", options: ["Noun (vegetables)", "Verb (to make)", "Adjective", "Adverb"], correct_answer: "Noun (vegetables)", rationale: "Context clues.", standard: "L.8.4", difficulty: 5 },
                    { id: 'w10', stem: "Antonym for 'lack' (Sentence 4):", options: ["Possess", "Want", "Need", "Miss"], correct_answer: "Possess", rationale: "Opposite meaning.", standard: "L.8.5", difficulty: 3 }
                ]
            },
            {
                id: 'tech-drone-manual',
                passage: "<b>User Manual: X-200 Drone</b><br><b>Step 1:</b> Charge battery fully (LED turns green).<br><b>Step 2:</b> Sync controller by holding 'Power' for 3 seconds.<br><b>Warning:</b> Do not fly near power lines. Signal interference may cause crash.",
                items: [
                    { id: 'tc1', stem: "What must happen before you sync the controller?", options: ["Charge the battery.", "Fly the drone.", "Crash the drone.", "Buy a new battery."], correct_answer: "Charge the battery.", rationale: "Sequential order (Step 1 vs Step 2).", standard: "RI.8.3", difficulty: 2 },
                    { id: 'tc2', stem: "What is the consequence of ignoring the Warning?", options: ["Signal interference/Crash", "The LED turns red", "The drone flies faster", "The battery explodes"], correct_answer: "Signal interference/Crash", rationale: "Cause and effect in technical text.", standard: "RI.8.5", difficulty: 3 },
                    { id: 'tc3', stem: "The word 'Sync' most nearly means:", options: ["Connect/Pair", "Wash", "Throw", "Destroy"], correct_answer: "Connect/Pair", rationale: "Technical vocabulary.", standard: "L.8.4", difficulty: 4 },
                    { id: 'tc4', stem: "Why is the text organized into numbered steps?", options: ["To show correct sequence", "To look pretty", "To confuse the user", "To save paper"], correct_answer: "To show correct sequence", rationale: "Text structure purpose.", standard: "RI.8.5", difficulty: 3 },
                    { id: 'tc5', stem: "Who is the intended audience?", options: ["New owners of the X-200", "Bird watchers", "Pilots of real planes", "Babies"], correct_answer: "New owners of the X-200", rationale: "Audience analysis.", standard: "RI.8.6", difficulty: 2 },
                    { id: 'tc6', stem: "If the LED is red, you should:", options: ["Keep charging", "Fly immediately", "Throw it away", "Press Power"], correct_answer: "Keep charging", rationale: "Inference from 'LED turns green'.", standard: "RI.8.1", difficulty: 5 },
                    { id: 'tc7', stem: "The 'Warning' section serves to:", options: ["Ensure safety and prevent damage", "Scare people", "Fill space", "Sell insurance"], correct_answer: "Ensure safety and prevent damage", rationale: "Function of text features.", standard: "RI.8.5", difficulty: 4 },
                    { id: 'tc8', stem: "Which text feature helps you find the charging info?", options: ["Bold headings/Steps", "The glossary", "The index", "The author's name"], correct_answer: "Bold headings/Steps", rationale: "Text features.", standard: "RI.8.5", difficulty: 3 },
                    { id: 'tc9', stem: "Meaning of 'interference':", options: ["Disruption/Blocking", "Help", "Speed", "Color"], correct_answer: "Disruption/Blocking", rationale: "Context clue (cause crash).", standard: "L.8.4", difficulty: 5 },
                    { id: 'tc10', stem: "Mode of writing:", options: ["Procedural/Technical", "Persuasive", "Narrative", "Poetic"], correct_answer: "Procedural/Technical", rationale: "Genre identification.", standard: "RI.8.1", difficulty: 3 }
                ]
            },
            {
                id: 'rhet-speech-liberty',
                passage: "<b>Speech: The Torch of Liberty</b><br>We do not ask for favor. We do not ask for pity. We ask only for justice. Like a mountain standing against the wind, we shall not be moved. The future is not a gift; it is a prize to be won.",
                items: [
                    { id: 'rh1', stem: "Identify the rhetorical device in 'We do not... We do not... We ask...':", options: ["Parallelism/Repetition", "Simile", "Personification", "Irony"], correct_answer: "Parallelism/Repetition", rationale: "Repeating sentence structures for effect.", standard: "L.8.5", difficulty: 6 },
                    { id: 'rh2', stem: "The simile 'Like a mountain' suggests:", options: ["Strength and stability", "Coldness", "Height", "Nature"], correct_answer: "Strength and stability", rationale: "Figurative language analysis.", standard: "L.8.5.a", difficulty: 4 },
                    { id: 'rh3', stem: "Speaker's tone:", options: ["Resolute and determined", "Sad and begging", "Happy and light", "Confused"], correct_answer: "Resolute and determined", rationale: "Tone analysis.", standard: "RI.8.6", difficulty: 5 },
                    { id: 'rh4', stem: "What distinction is made about 'the future'?", options: ["It must be earned (prize), not given (gift).", "It is expensive.", "It is scary.", "It is boring."], correct_answer: "It must be earned (prize), not given (gift).", rationale: "Analyzing comparisons.", standard: "RI.8.3", difficulty: 6 },
                    { id: 'rh5', stem: "The phrase 'shall not be moved' implies:", options: ["Refusal to surrender", "Physical paralysis", "Laziness", "Being stuck in traffic"], correct_answer: "Refusal to surrender", rationale: "Connotative meaning.", standard: "RI.8.4", difficulty: 5 },
                    { id: 'rh6', stem: "Main Claim:", options: ["We deserve justice.", "Mountains are windy.", "Gifts are bad.", "Don't ask questions."], correct_answer: "We deserve justice.", rationale: "Central idea.", standard: "RI.8.2", difficulty: 3 },
                    { id: 'rh7', stem: "Who is the 'We' likely representing?", options: ["A marginalized/oppressed group", "The mountains", "Rich kings", "Children"], correct_answer: "A marginalized/oppressed group", rationale: "Inference from 'ask for justice'.", standard: "RI.8.1", difficulty: 5 },
                    { id: 'rh8', stem: "Function of 'The Torch' in the title:", options: ["Symbol of hope/light", "To burn things", "A flashlight", "Heat"], correct_answer: "Symbol of hope/light", rationale: "Symbolism.", standard: "L.8.5", difficulty: 6 },
                    { id: 'rh9', stem: "Which appeal is used most? (Ethos/Pathos/Logos)", options: ["Pathos (Emotional)", "Logos (Logic)", "Ethos (Credibility)", "None"], correct_answer: "Pathos (Emotional)", rationale: "Inspiring language evokes emotion.", standard: "RI.8.6", difficulty: 7 },
                    { id: 'rh10', stem: "What is the 'wind' in the mountain metaphor?", options: ["Adversity/Opposition", "Weather", "Air", "Help"], correct_answer: "Adversity/Opposition", rationale: "Metaphorical analysis.", standard: "L.8.5", difficulty: 7 }
                ]
            },

// START GAP FILLER: CONFLICT, HUMOR, PUNCTUATION
            {
                id: 'inf-conflict-zoo',
                passage: "<b>Source A (Press Release):</b> The City Zoo is proud to announce the new 'Lion Habitat.' This safe, modern enclosure mimics the savannah and promotes conservation.<br><b>Source B (Letter to Editor):</b> The new lion pit is a disaster. It is too small, and the 'savannah' is just painted concrete. The money should have been spent on protecting lions in the wild, not trapping them here.",
                items: [
                    { id: 'conf1', stem: "How do the two sources differ in their interpretation of the 'Habitat'?", options: ["Source A sees it as modern; Source B sees it as a prison.", "Both love it.", "Source A hates it; Source B loves it.", "Both hate it."], correct_answer: "Source A sees it as modern; Source B sees it as a prison.", rationale: "Contrasting viewpoints on the same subject.", standard: "RI.8.9", difficulty: 4 },
                    { id: 'conf2', stem: "Which fact is emphasized in Source B but missing from Source A?", options: ["The enclosure is made of concrete.", "The zoo is proud.", "Lions live in the savannah.", "It is a new habitat."], correct_answer: "The enclosure is made of concrete.", rationale: "Analyzing omitted details.", standard: "RI.8.9", difficulty: 5 },
                    { id: 'conf3', stem: "Source A uses the word 'Habitat' to suggest:", options: ["A natural, healthy home", "A cage", "A laboratory", "A circus"], correct_answer: "A natural, healthy home", rationale: "Connotative word choice.", standard: "RI.8.4", difficulty: 3 },
                    { id: 'conf4', stem: "Source B's tone can be described as:", options: ["Critical and indignant", "Happy and supportive", "Bored", "Scientific"], correct_answer: "Critical and indignant", rationale: "Tone analysis.", standard: "RI.8.6", difficulty: 4 },
                    { id: 'conf5', stem: "What is the shared topic of both texts?", options: ["The new lion enclosure", "Tiger food", "Ticket prices", " The weather"], correct_answer: "The new lion enclosure", rationale: "Identifying the common subject.", standard: "RI.8.9", difficulty: 2 },
                    { id: 'conf6', stem: "Source B claims the money should have been used for:", options: ["Wild conservation", "Better paint", "Buying tigers", "Cleaning the concrete"], correct_answer: "Wild conservation", rationale: "Recall of argument.", standard: "RI.8.1", difficulty: 3 },
                    { id: 'conf7', stem: "Which statement best summarizes the conflict?", options: ["Conservation vs. Captivity", "Cats vs. Dogs", "Paint vs. Wood", "Day vs. Night"], correct_answer: "Conservation vs. Captivity", rationale: "Thematic conflict.", standard: "RI.8.2", difficulty: 6 },
                    { id: 'conf8', stem: "If Source A were to respond to Source B, they would likely say:", options: ["Captivity inspires people to donate to the wild.", "You are right, we will close.", "Lions hate grass.", "Concrete is soft."], correct_answer: "Captivity inspires people to donate to the wild.", rationale: "Inferring counter-arguments.", standard: "RI.8.8", difficulty: 7 },
                    { id: 'conf9', stem: "The word 'mimics' in Source A implies:", options: ["It is an artificial copy.", "It is real.", "It is broken.", "It is invisible."], correct_answer: "It is an artificial copy.", rationale: "Vocabulary depth.", standard: "L.8.4", difficulty: 5 },
                    { id: 'conf10', stem: "Which source is likely more objective?", options: ["Neither (both are biased)", "Source A", "Source B", "A Math textbook"], correct_answer: "Neither (both are biased)", rationale: "Evaluating bias in persuasive text.", standard: "RI.8.6", difficulty: 6 }
                ]
            },
            {
                id: 'lit-satire-lunch',
                passage: "<b>The Gourmet Lunch</b><br>Today's cafeteria specialty was a delight known as 'Mystery Loaf.' It sat on the tray, sweating quietly, accompanied by a gray mush that I was told represented green beans. Truly, a meal fit for royalty‚Äîif that royalty were currently in a dungeon.",
                items: [
                    { id: 'sat1', stem: "The narrator describes the loaf as 'sweating quietly' to create a sense of:", options: ["Disgust/Revulsion", "Heat", "Excitement", "Noise"], correct_answer: "Disgust/Revulsion", rationale: "Personification used for gross effect.", standard: "RL.8.4", difficulty: 4 },
                    { id: 'sat2', stem: "The phrase 'meal fit for royalty' is an example of:", options: ["Verbal Irony (Sarcasm)", "Literal fact", "Metaphor", "Alliteration"], correct_answer: "Verbal Irony (Sarcasm)", rationale: "He means the opposite.", standard: "RL.8.6", difficulty: 5 },
                    { id: 'sat3', stem: "What is the true meaning of the last sentence?", options: ["The food is terrible/punishing.", "Kings eat here.", "The narrator is a prince.", "Dungeons are nice."], correct_answer: "The food is terrible/punishing.", rationale: "Interpreting satire.", standard: "RL.8.6", difficulty: 3 },
                    { id: 'sat4', stem: "The tone of the passage is:", options: ["Mock-serious/Humorous", "Depressed", "Angry", "Educational"], correct_answer: "Mock-serious/Humorous", rationale: "Satirical tone.", standard: "RL.8.4", difficulty: 5 },
                    { id: 'sat5', stem: "Why does the author use the word 'represented' regarding the beans?", options: ["To imply they didn't look like real beans.", "To show they were elected.", "To show they were drawings.", "To show they were tasty."], correct_answer: "To imply they didn't look like real beans.", rationale: "Word choice analysis.", standard: "RL.8.4", difficulty: 4 },
                    { id: 'sat6', stem: "The author is criticizing:", options: ["School lunch quality", "Dungeons", "Royalty", "Sweat"], correct_answer: "School lunch quality", rationale: "Object of the satire.", standard: "RL.8.2", difficulty: 2 },
                    { id: 'sat7', stem: "Hyperbole Check: Which phrase is an exaggeration?", options: ["'Fit for royalty'", "'Green beans'", "'On the tray'", "'Today's specialty'"], correct_answer: "'Fit for royalty'", rationale: "Exaggeration for effect.", standard: "L.8.5", difficulty: 3 },
                    { id: 'sat8', stem: "Narrator's point of view:", options: ["First Person (Participant)", "Third Person", "Second Person", "Omniscient"], correct_answer: "First Person (Participant)", rationale: "Uses 'I' and personal voice.", standard: "RL.8.6", difficulty: 2 },
                    { id: 'sat9', stem: "The 'gray mush' imagery appeals to the sense of:", options: ["Sight", "Sound", "Touch", "Hearing"], correct_answer: "Sight", rationale: "Sensory details.", standard: "RL.8.4", difficulty: 3 },
                    { id: 'sat10', stem: "Theme:", options: ["Humor helps cope with unpleasant situations.", "Food is fuel.", "Respect the cook.", "Beans are healthy."], correct_answer: "Humor helps cope with unpleasant situations.", rationale: "Function of humor.", standard: "RL.8.2", difficulty: 6 }
                ]
            },
            {
                id: 'lang-punct-lab',
                passage: "<b>The Punctuation Station</b><br>(1) I packed my bag with three things: a flashlight, a map, and a compass. (2) The woods‚Äîwhich were dark and scary‚Äîloomed ahead. (3) 'Wait...' I whispered. (4) I think I heard a bear.",
                items: [
                    { id: 'pun1', stem: "Sentence 1: The colon (:) is used to:", options: ["Introduce a list", "End the sentence", "Show excitement", "Separate cities"], correct_answer: "Introduce a list", rationale: "Function of colons.", standard: "L.8.2.a", difficulty: 4 },
                    { id: 'pun2', stem: "Sentence 2: The dashes (‚Äî) function to:", options: ["Set off an interruption/emphasis", "Connect words", "End the sentence", "Show dialogue"], correct_answer: "Set off an interruption/emphasis", rationale: "Function of dashes.", standard: "L.8.2.a", difficulty: 5 },
                    { id: 'pun3', stem: "Sentence 3: The ellipsis (...) indicates:", options: ["A pause or hesitation", "An omission of words", "Excitement", "A question"], correct_answer: "A pause or hesitation", rationale: "Function of ellipses in dialogue.", standard: "L.8.2.b", difficulty: 4 },
                    { id: 'pun4', stem: "How else could Sentence 2 be punctuated correctly?", options: ["The woods, which were dark and scary, loomed ahead.", "The woods which were dark and scary loomed ahead.", "The woods; which were dark and scary loomed ahead.", "The woods. Which were dark and scary loomed ahead."], correct_answer: "The woods, which were dark and scary, loomed ahead.", rationale: "Commas vs Dashes.", standard: "L.8.2", difficulty: 6 },
                    { id: 'pun5', stem: "Which sentence contains an Oxford Comma?", options: ["Sentence 1 (after 'map')", "Sentence 2", "Sentence 3", "Sentence 4"], correct_answer: "Sentence 1 (after 'map')", rationale: "Comma before the conjunction in a list.", standard: "L.8.2", difficulty: 5 },
                    { id: 'pun6', stem: "Identify the misspelled word (if any):", options: ["No error", "Flashlight", "Loomed", "Whispered"], correct_answer: "No error", rationale: "Spelling check.", standard: "L.8.2.c", difficulty: 3 },
                    { id: 'pun7', stem: "Sentence 4: 'I think I heard' is a:", options: ["Independent clause", "Fragment", "Preposition", "List"], correct_answer: "Independent clause", rationale: "Subject + Verb + Complete thought.", standard: "L.8.1", difficulty: 5 },
                    { id: 'pun8', stem: "Function of quotation marks in Sentence 3:", options: ["Indicate dialogue", "Indicate irony", "Cite a book title", "Highlight a word"], correct_answer: "Indicate dialogue", rationale: "Punctuation rule.", standard: "L.8.2", difficulty: 2 },
                    { id: 'pun9', stem: "If you removed the dashes in Sentence 2, the phrase 'which were dark and scary' would become:", options: ["A non-restrictive clause", "A main verb", "A subject", "An object"], correct_answer: "A non-restrictive clause", rationale: "Grammar terminology.", standard: "L.8.1", difficulty: 8 },
                    { id: 'pun10', stem: "Best revision for suspense:", options: ["'Wait... I think... is that a bear?'", "'I saw a bear.'", "'Bears are big.'", "'Walking is fun.'"], correct_answer: "'Wait... I think... is that a bear?'", rationale: "Using ellipses for effect.", standard: "L.8.3", difficulty: 5 }
                ]
            },

            // START GAP FILLER PHASE 4: FUNCTIONAL, IDIOMS, CROSS-GENRE
            {
                id: 'func-warranty',
                passage: "<b>Electro-Tab 5-Year Limited Warranty</b><br>1. <b>Coverage:</b> Covers defects in materials and workmanship for 5 years from purchase.<br>2. <b>Exclusions:</b> Does NOT cover damage caused by accidents, water, or unauthorized repairs. Opening the device casing immediately voids this warranty.<br>3. <b>Service:</b> To obtain service, mail the device and proof of purchase to our Repair Center.",
                items: [
                    { id: 'fw1', stem: "Which action would automatically void the warranty?", options: ["Opening the device casing.", "Using the device daily.", "Mailing it to the Repair Center.", "Losing the receipt."], correct_answer: "Opening the device casing.", rationale: "Explicit detail in 'Exclusions'.", standard: "RI.8.1", difficulty: 3 },
                    { id: 'fw2', stem: "If you drop the tablet in a pool, is it covered?", options: ["No, water damage is excluded.", "Yes, it is a material defect.", "Yes, for 5 years.", "Only if you mail it."], correct_answer: "No, water damage is excluded.", rationale: "Applying constraints to a scenario.", standard: "RI.8.2", difficulty: 4 },
                    { id: 'fw3', stem: "The word 'Exclusions' most nearly means:", options: ["Things left out/Not covered", "Bonus features", "Expensive parts", "Legal rules"], correct_answer: "Things left out/Not covered", rationale: "Vocabulary in context.", standard: "L.8.4", difficulty: 4 },
                    { id: 'fw4', stem: "What is required to get service?", options: ["The device and proof of purchase.", "Just the device.", "Money.", "A lawyer."], correct_answer: "The device and proof of purchase.", rationale: "Locating specific procedural info.", standard: "RI.8.3", difficulty: 2 },
                    { id: 'fw5', stem: "The purpose of the bold headings (Coverage, Exclusions) is to:", options: ["Help the reader scan for information.", "Make the text look pretty.", "Scare the reader.", "Hide secrets."], correct_answer: "Help the reader scan for information.", rationale: "Function of text features.", standard: "RI.8.5", difficulty: 3 },
                    { id: 'fw6', stem: "What implies this is a 'Limited' warranty?", options: ["It has specific exclusions (like water).", "It lasts forever.", "It is free.", "It is for tablets."], correct_answer: "It has specific exclusions (like water).", rationale: "Analyzing title significance.", standard: "RI.8.4", difficulty: 6 },
                    { id: 'fw7', stem: "Tone of the document:", options: ["Formal and legalistic", "Friendly and casual", "Angry", "Funny"], correct_answer: "Formal and legalistic", rationale: "Tone analysis.", standard: "RI.8.6", difficulty: 5 },
                    { id: 'fw8', stem: "Antonym for 'Authorized' (in context of unauthorized):", options: ["Permitted/Official", "Illegal", "Fast", "Broken"], correct_answer: "Permitted/Official", rationale: "Word meaning.", standard: "L.8.5", difficulty: 4 },
                    { id: 'fw9', stem: "Who is the 'Repair Center' likely run by?", options: ["The Electro-Tab company", "A random shop", "The government", "A school"], correct_answer: "The Electro-Tab company", rationale: "Inference.", standard: "RI.8.1", difficulty: 2 },
                    { id: 'fw10', stem: "Genre classification:", options: ["Functional/Technical Document", "Persuasive Essay", "Memoir", "Science Fiction"], correct_answer: "Functional/Technical Document", rationale: "Genre ID.", standard: "RI.8.1", difficulty: 2 }
                ]
            },
            {
                id: 'lit-idiom-trip',
                passage: "<b>The Road Trip</b><br>I was <i>on the fence</i> about the trip. It would cost <i>an arm and a leg</i>, and my car was <i>on its last legs</i>. But when Mark said it was a 'once in a blue moon' chance, I decided to <i>bite the bullet</i> and go.",
                items: [
                    { id: 'id1', stem: "The phrase 'on the fence' implies the narrator was:", options: ["Undecided", "Sitting on a wall", "In pain", "Excited"], correct_answer: "Undecided", rationale: "Idiom meaning.", standard: "L.8.5.a", difficulty: 3 },
                    { id: 'id2', stem: "What does 'cost an arm and a leg' mean?", options: ["Very expensive", "Physical injury", "Cheap", "Dangerous"], correct_answer: "Very expensive", rationale: "Idiom meaning.", standard: "L.8.5.a", difficulty: 2 },
                    { id: 'id3', stem: "If the car is 'on its last legs', it is:", options: ["Old and breaking down", "Brand new", "Fast", "Walking"], correct_answer: "Old and breaking down", rationale: "Personification/Idiom.", standard: "L.8.5.a", difficulty: 4 },
                    { id: 'id4', stem: "'Bite the bullet' suggests the decision was:", options: ["Difficult or brave", "Tasty", "Easy", "Violent"], correct_answer: "Difficult or brave", rationale: "Idiom meaning.", standard: "L.8.5.a", difficulty: 5 },
                    { id: 'id5', stem: "Mark uses 'once in a blue moon' to convince the narrator that:", options: ["The opportunity is rare.", " The moon is blue.", "Night driving is safe.", "He likes colors."], correct_answer: "The opportunity is rare.", rationale: "Idiom meaning.", standard: "L.8.5.a", difficulty: 3 },
                    { id: 'id6', stem: "Narrator's initial attitude:", options: ["Hesitant/Reluctant", "Eager", "Angry", "Bored"], correct_answer: "Hesitant/Reluctant", rationale: "Inference from 'on the fence'.", standard: "RL.8.3", difficulty: 4 },
                    { id: 'id7', stem: "Context Clue: Which phrase helps explain 'on the fence'?", options: ["'...But I decided to...'", "'...Mark said...'", "'...cost an arm...'", "'...car was...'"], correct_answer: "'...But I decided to...'", rationale: "Shows the shift from indecision to action.", standard: "L.8.4", difficulty: 6 },
                    { id: 'id8', stem: "Tone of the passage:", options: ["Informal/Conversational", "Formal", "Scientific", "Tragic"], correct_answer: "Informal/Conversational", rationale: "Use of idioms creates casual tone.", standard: "RL.8.4", difficulty: 3 },
                    { id: 'id9', stem: "Pun check: Is there a pun in this text?", options: ["No", "Yes, about legs", "Yes, about bullets", "Yes, about moons"], correct_answer: "No", rationale: "Distinguishing idioms from puns.", standard: "L.8.5", difficulty: 5 },
                    { id: 'id10', stem: "Theme:", options: ["Taking risks despite hesitation", "Car safety", "Saving money", "Fences are uncomfortable"], correct_answer: "Taking risks despite hesitation", rationale: "Thematic summary.", standard: "RL.8.2", difficulty: 4 }
                ]
            },
            {
                id: 'cross-storm-view',
                passage: "<b>Poem: The Fury</b><br>The wind howled a wolf's cry,<br>Shattering the silence,<br>Tearing the sky.<br><br><b>Diary: April 4th</b><br>The storm was loud. It broke a branch off the oak tree. I stayed inside and read a book until the rain stopped.",
                items: [
                    { id: 'cr1', stem: "How does the Poem's structure differ from the Diary?", options: ["Stanzas/Lines vs Sentences/Paragraphs", "It is longer.", "It has dates.", "It has no words."], correct_answer: "Stanzas/Lines vs Sentences/Paragraphs", rationale: "Structural comparison.", standard: "RL.8.5", difficulty: 2 },
                    { id: 'cr2', stem: "The Poem's tone is ________, while the Diary is ________.", options: ["Dramatic/Intense; Factual/Calm", "Boring; Fun", "Calm; Scary", "Happy; Sad"], correct_answer: "Dramatic/Intense; Factual/Calm", rationale: "Contrasting tone.", standard: "RL.8.9", difficulty: 5 },
                    { id: 'cr3', stem: "The poem uses 'wolf's cry' (Metaphor) to emphasize:", options: ["The sound and danger of the wind", "That wolves are present", "The time of day", "The forest"], correct_answer: "The sound and danger of the wind", rationale: "Figurative language analysis.", standard: "RL.8.4", difficulty: 4 },
                    { id: 'cr4', stem: "The Diary focuses on:", options: ["Events and actions", "Emotions only", "Rhyming", "Metaphors"], correct_answer: "Events and actions", rationale: "Content analysis.", standard: "RL.8.5", difficulty: 3 },
                    { id: 'cr5', stem: "Which text gives a better sense of the *feeling* of the storm?", options: ["The Poem", "The Diary", "Neither", "Both equal"], correct_answer: "The Poem", rationale: "Evaluating purpose of genre.", standard: "RL.8.9", difficulty: 6 },
                    { id: 'cr6', stem: "Personification in the poem:", options: ["'Tearing the sky'", "'April 4th'", "'Read a book'", "'Oak tree'"], correct_answer: "'Tearing the sky'", rationale: "Giving human action to wind.", standard: "L.8.5", difficulty: 5 },
                    { id: 'cr7', stem: "The 'Diary' is written in:", options: ["Prose", "Verse", "Stanzas", "Meter"], correct_answer: "Prose", rationale: "Literary terminology.", standard: "RL.8.5", difficulty: 3 },
                    { id: 'cr8', stem: "Shared topic:", options: ["A storm/Weather", "Wolves", "Reading", "Trees"], correct_answer: "A storm/Weather", rationale: "Comparison basis.", standard: "RL.8.9", difficulty: 1 },
                    { id: 'cr9', stem: "The word 'Shattering' in the poem implies:", options: ["Violent breaking", "Quiet noise", "Fixing", "Helping"], correct_answer: "Violent breaking", rationale: "Connotation.", standard: "L.8.5", difficulty: 4 },
                    { id: 'cr10', stem: "Author's intent comparison:", options: ["Poet evokes emotion; Diarist records history.", "Poet wants to sell books; Diarist wants to sleep.", "Poet informs; Diarist entertains.", "No difference."], correct_answer: "Poet evokes emotion; Diarist records history.", rationale: "Author's purpose across genres.", standard: "RL.8.6", difficulty: 7 }
                ]
            },

// START POETRY EXPANSION
            {
                id: 'lit-dickinson-hope',
                passage: "<b>Hope is the thing with feathers</b> by Emily Dickinson<br>Hope is the thing with feathers -<br>That perches in the soul -<br>And sings the tune without the words -<br>And never stops - at all -<br>And sweetest - in the Gale - is heard...",
                items: [
                    { id: 'ed1', stem: "Dickinson uses the 'bird' metaphor to describe Hope as:", options: ["Resilient and ever-present", "Loud and annoying", "Temporary", "Expensive"], correct_answer: "Resilient and ever-present", rationale: "It 'never stops at all'.", standard: "RL.8.4", difficulty: 4 },
                    { id: 'ed2', stem: "What does the 'Gale' (storm) represent?", options: ["Hard times/Adversity", "Good weather", "A party", "Bird food"], correct_answer: "Hard times/Adversity", rationale: "Symbolism for struggle.", standard: "RL.8.4", difficulty: 5 },
                    { id: 'ed3', stem: "The phrase 'sings the tune without the words' suggests:", options: ["Hope is a feeling, not a logical speech", "The bird forgot the lyrics", "Hope is silent", "Music is loud"], correct_answer: "Hope is a feeling, not a logical speech", rationale: "Abstract nature of hope.", standard: "RL.8.2", difficulty: 6 },
                    { id: 'ed4', stem: "Theme of the poem:", options: ["Hope provides comfort in the darkest times.", "Birds are pretty.", "Storms are dangerous.", "Singing is fun."], correct_answer: "Hope provides comfort in the darkest times.", rationale: "Central message.", standard: "RL.8.2", difficulty: 3 },
                    { id: 'ed5', stem: "Structure: The dashes (-) at the end of lines create:", options: ["A pause/fragmented rhythm", "A fast pace", "Confusion", "An ending"], correct_answer: "A pause/fragmented rhythm", rationale: "Dickinson's signature style.", standard: "RL.8.5", difficulty: 5 },
                    { id: 'ed6', stem: "Personification check: What human trait is given to Hope?", options: ["Singing/Perching", "Driving", "Cooking", "Reading"], correct_answer: "Singing/Perching", rationale: "attribution of living traits.", standard: "L.8.5", difficulty: 2 },
                    { id: 'ed7', stem: "Tone of the speaker:", options: ["Admiring/Reverent", "Angry", "Sad", "Bored"], correct_answer: "Admiring/Reverent", rationale: "Tone analysis.", standard: "RL.8.6", difficulty: 5 },
                    { id: 'ed8', stem: "Where does Hope 'perch'?", options: ["In the soul", "On a tree", "In a cage", "On the roof"], correct_answer: "In the soul", rationale: "Textual evidence.", standard: "RL.8.1", difficulty: 2 },
                    { id: 'ed9', stem: "What does Hope ask in return ('crumb')?", options: ["Nothing", "Food", "Money", "Attention"], correct_answer: "Nothing", rationale: "'Never asked a crumb of me'.", standard: "RL.8.1", difficulty: 4 },
                    { id: 'ed10', stem: "Why compare Hope to something 'with feathers' instead of just a 'bird'?", options: ["To focus on the sensation/softness", "She forgot the word bird", "To sound scary", "To rhyme"], correct_answer: "To focus on the sensation/softness", rationale: "Nuance in word choice.", standard: "RL.8.4", difficulty: 7 }
                ]
            },
            {
                id: 'lit-shakur-rose',
                passage: "<b>The Rose That Grew From Concrete</b> by Tupac Shakur<br>Did you hear about the rose that grew<br>from a crack in the concrete?<br>Proving nature's law is wrong it<br>learned to walk without having feet.<br>Funny it seems, but by keeping its dreams,<br>it learned to breathe fresh air.",
                items: [
                    { id: 'ts1', stem: "The 'concrete' symbolizes:", options: ["A harsh/oppressive environment", "A sidewalk", "A garden", "The city"], correct_answer: "A harsh/oppressive environment", rationale: "Symbolism of struggle.", standard: "RL.8.4", difficulty: 4 },
                    { id: 'ts2', stem: "What is the 'Rose' a metaphor for?", options: ["Someone overcoming odds to succeed", "A flower shop", "Nature", "Broken sidewalks"], correct_answer: "Someone overcoming odds to succeed", rationale: "Metaphorical meaning.", standard: "RL.8.4", difficulty: 3 },
                    { id: 'ts3', stem: "Meaning of 'Proving nature's law is wrong':", options: ["Doing the impossible", "Science class is hard", "Flowers don't walk", "Breaking rules is fun"], correct_answer: "Doing the impossible", rationale: "Hyperbole for effect.", standard: "L.8.5", difficulty: 5 },
                    { id: 'ts4', stem: "Theme:", options: ["Resilience and determination", "Gardening tips", "Urban planning", "Walking"], correct_answer: "Resilience and determination", rationale: "Central theme.", standard: "RL.8.2", difficulty: 3 },
                    { id: 'ts5', stem: "Tone of the poem:", options: ["Awestruck/Respectful", "Sarcastic", "Depressed", "Angry"], correct_answer: "Awestruck/Respectful", rationale: "Admiring the rose's feat.", standard: "RL.8.6", difficulty: 5 },
                    { id: 'ts6', stem: "What allowed the rose to survive?", options: ["Keeping its dreams", "Water", "Sunlight", "Fertilizer"], correct_answer: "Keeping its dreams", rationale: "Textual evidence.", standard: "RL.8.1", difficulty: 2 },
                    { id: 'ts7', stem: "Personification: The rose learned to...", options: ["Walk and breathe", "Talk", "Run", "Fight"], correct_answer: "Walk and breathe", rationale: "Human qualities given to rose.", standard: "L.8.5", difficulty: 3 },
                    { id: 'ts8', stem: "The phrase 'Funny it seems' suggests:", options: ["Irony/Unexpectedness", "A joke", "Laughter", "Confusion"], correct_answer: "Irony/Unexpectedness", rationale: "Reflection on the improbability.", standard: "RL.8.6", difficulty: 6 },
                    { id: 'ts9', stem: "Contrast: Rose vs Concrete represents:", options: ["Life vs Death/Hardship", "Red vs Gray", "Soft vs Hard", "All of the above"], correct_answer: "All of the above", rationale: "Layered contrast.", standard: "RL.8.5", difficulty: 5 },
                    { id: 'ts10', stem: "Why mention 'without having feet'?", options: ["To emphasize the impossibility of the struggle", "Roses don't have feet", "It is a mutant", "To rhyme"], correct_answer: "To emphasize the impossibility of the struggle", rationale: "Highlighting the miracle.", standard: "RL.8.1", difficulty: 6 }
                ]
            },
            {
                id: 'lit-tagore-boats',
                passage: "<b>Paper Boats</b> by Rabindranath Tagore<br>Day by day I float my paper boats one by one down the running stream.<br>In big black letters I write my name on them and the name of the village where I live.<br>I hope that someone in some strange land will find them and know who I am.",
                items: [
                    { id: 'rt1', stem: "The act of floating boats represents:", options: ["A desire for connection/legacy", "Littering", "Boredom", "A race"], correct_answer: "A desire for connection/legacy", rationale: "Hoping someone finds them.", standard: "RL.8.2", difficulty: 5 },
                    { id: 'rt2', stem: "Why write the name in 'big black letters'?", options: ["To be clearly understood", "He had no other pen", "To look scary", "To hide it"], correct_answer: "To be clearly understood", rationale: "Intent to communicate.", standard: "RL.8.3", difficulty: 3 },
                    { id: 'rt3', stem: "The 'strange land' suggests:", options: ["The unknown/distant places", "Mars", "The neighbor's house", "A scary place"], correct_answer: "The unknown/distant places", rationale: "Childlike wonder of distance.", standard: "RL.8.4", difficulty: 4 },
                    { id: 'rt4', stem: "Narrator's perspective:", options: ["Innocent and hopeful", "Cynical", "Old and tired", "Angry"], correct_answer: "Innocent and hopeful", rationale: "Child narrator voice.", standard: "RL.8.6", difficulty: 4 },
                    { id: 'rt5', stem: "Symbolism: The 'running stream' is:", options: ["The flow of time/life", "Just water", "A dangerous river", "A bathtub"], correct_answer: "The flow of time/life", rationale: "River archetype.", standard: "RL.8.4", difficulty: 7 },
                    { id: 'rt6', stem: "What is the narrator's main hope?", options: ["To be known/remembered", "To win a prize", "To sink the boats", "To swim"], correct_answer: "To be known/remembered", rationale: "Text evidence.", standard: "RL.8.1", difficulty: 3 },
                    { id: 'rt7', stem: "Imagery: 'Blooms of the dawn' implies:", options: ["Flowers picked early in the morning", "Fake flowers", "Drawings", "Candy"], correct_answer: "Flowers picked early in the morning", rationale: "Sensory detail.", standard: "RL.8.4", difficulty: 5 },
                    { id: 'rt8', stem: "Tone shift:", options: ["Playful to philosophical", "Sad to happy", "Angry to calm", "None"], correct_answer: "Playful to philosophical", rationale: "Starts with play, moves to hope for connection.", standard: "RL.8.5", difficulty: 8 },
                    { id: 'rt9', stem: "Cultural context: The poem reflects:", options: ["Universal childhood imagination", "War", "School", "Farming"], correct_answer: "Universal childhood imagination", rationale: "Thematic scope.", standard: "RL.8.9", difficulty: 6 },
                    { id: 'rt10', stem: "Grammar: 'Day by day' functions as:", options: ["An adverbial phrase (frequency)", "A subject", "A verb", "An adjective"], correct_answer: "An adverbial phrase (frequency)", rationale: "Grammar function.", standard: "L.8.1", difficulty: 6 }
                ]
            },
            {
                id: 'lit-silver-garbage',
                passage: "<b>Sarah Cynthia Sylvia Stout</b> by Shel Silverstein<br>Sarah Cynthia Sylvia Stout<br>Would not take the garbage out!<br>She'd scour the pots and scrape the pans,<br>Candy the yams and spice the hams...<br>And though her daddy would scream and shout,<br>She simply would not take the garbage out.",
                items: [
                    { id: 'ss1', stem: "The poem uses 'Hyperbole' (Exaggeration) to:", options: ["Create humor and a warning", "Scare children", "Teach cooking", "Describe a real event"], correct_answer: "Create humor and a warning", rationale: "The garbage reaches the sky.", standard: "L.8.5", difficulty: 3 },
                    { id: 'ss2', stem: "The rhyme scheme (Stout/Out/Shout) creates a:", options: ["Playful/Musical rhythm", "Serious tone", "Scary mood", "Boring list"], correct_answer: "Playful/Musical rhythm", rationale: "Effect of rhyme.", standard: "RL.8.5", difficulty: 4 },
                    { id: 'ss3', stem: "Theme:", options: ["Procrastination has consequences", "Cooking is fun", "Garbage smells good", "Dads are loud"], correct_answer: "Procrastination has consequences", rationale: "The piling up is the consequence.", standard: "RL.8.2", difficulty: 3 },
                    { id: 'ss4', stem: "Sensory Imagery: Which sense is appealed to most?", options: ["Smell/Sight", "Sound", "Touch", "Taste"], correct_answer: "Smell/Sight", rationale: "Descriptions of rotting food.", standard: "RL.8.4", difficulty: 3 },
                    { id: 'ss5', stem: "The list of foods (yams, hams, clams) serves to:", options: ["Emphasize the mounting mess", "Make you hungry", "Show she is a chef", "Rhyme with Stout"], correct_answer: "Emphasize the mounting mess", rationale: "Accumulation technique.", standard: "RL.8.5", difficulty: 5 },
                    { id: 'ss6', stem: "Tone:", options: ["Humorous and cautionary", "Sad", "Scientific", "Romantic"], correct_answer: "Humorous and cautionary", rationale: "Silverstein's style.", standard: "RL.8.6", difficulty: 4 },
                    { id: 'ss7', stem: "What is Sarah's fatal flaw?", options: ["Stubbornness/Laziness", "Greed", "Anger", "Fear"], correct_answer: "Stubbornness/Laziness", rationale: "Character flaw.", standard: "RL.8.3", difficulty: 4 },
                    { id: 'ss8', stem: "The ending implies Sarah was:", options: ["Consumed by the garbage", "Happy", "Moving away", "Cleaning up"], correct_answer: "Consumed by the garbage", rationale: "Inference 'met an awful fate'.", standard: "RL.8.1", difficulty: 5 },
                    { id: 'ss9', stem: "Alliteration example:", options: ["'Sarah Cynthia Sylvia Stout'", "'Garbage out'", "'Daddy would scream'", "'Scrape the pans'"], correct_answer: "'Sarah Cynthia Sylvia Stout'", rationale: "Repetition of 'S'.", standard: "L.8.5", difficulty: 3 },
                    { id: 'ss10', stem: "Why did she do other chores (scour pots) but not the garbage?", options: ["To show her specific refusal/obstinance", "She liked pots", "The garbage was heavy", "She forgot"], correct_answer: "To show her specific refusal/obstinance", rationale: "Character motivation.", standard: "RL.8.3", difficulty: 6 }
                ]
            },

            // START EXPANSION: FAMOUS SHORT STORIES
            {
                id: 'lit-jacobs-paw',
                passage: "<b>The Monkey's Paw</b> by W.W. Jacobs<br>\"To look at,\" said the Sergeant-Major, fumbling in his pocket, \"it's just an ordinary little paw, dried to a mummy.\"<br>He took the paw, and dangling it between his forefinger and thumb, suddenly threw it upon the fire. White, with a slight cry, stooped down and snatched it off.<br>\"Better let it burn,\" said the soldier solemnly.",
                items: [
                    { id: 'mp1', stem: "The Sergeant-Major's action of throwing the paw into the fire suggests:", options: ["It is dangerous/cursed", "He is cold", "It is trash", "He hates monkeys"], correct_answer: "It is dangerous/cursed", rationale: "Action implies he wants to destroy it to protect them.", standard: "RL.8.3", difficulty: 3 },
                    { id: 'mp2', stem: "White's reaction ('snatched it off') reveals his:", options: ["Curiosity and recklessness", "Fear", "Wisdom", "Hunger"], correct_answer: "Curiosity and recklessness", rationale: "He saves the dangerous object.", standard: "RL.8.3", difficulty: 4 },
                    { id: 'mp3', stem: "The description 'dried to a mummy' creates a mood of:", options: ["Unease/Macabre", "Joy", "Boredom", "Scientific interest"], correct_answer: "Unease/Macabre", rationale: "Grotesque imagery.", standard: "RL.8.4", difficulty: 5 },
                    { id: 'mp4', stem: "Foreshadowing: The soldier's warning 'Better let it burn' predicts:", options: ["The tragedy that will follow", "The fire going out", "Dinner being cooked", "Nothing"], correct_answer: "The tragedy that will follow", rationale: "Warning of future negative events.", standard: "RL.8.5", difficulty: 4 },
                    { id: 'mp5', stem: "Theme:", options: ["Be careful what you wish for.", "Fire is hot.", "Soldiers are brave.", "Travel is fun."], correct_answer: "Be careful what you wish for.", rationale: "Central theme of the story.", standard: "RL.8.2", difficulty: 2 },
                    { id: 'mp6', stem: "The word 'solemnly' implies the soldier is:", options: ["Serious/Grave", "Joking", "Tired", "Angry"], correct_answer: "Serious/Grave", rationale: "Vocabulary context.", standard: "L.8.4", difficulty: 4 },
                    { id: 'mp7', stem: "Irony: The object that ruins their lives is introduced as:", options: ["'Ordinary little paw'", "A weapon", "A monster", "A jewel"], correct_answer: "'Ordinary little paw'", rationale: "Contrast between appearance and power.", standard: "RL.8.6", difficulty: 6 },
                    { id: 'mp8', stem: "Point of View:", options: ["Third-Person Omniscient", "First-Person", "Second-Person", "Unreliable"], correct_answer: "Third-Person Omniscient", rationale: "Narrator observes all characters.", standard: "RL.8.6", difficulty: 5 },
                    { id: 'mp9', stem: "The interaction between the men creates tension through:", options: ["Conflicting actions (throwing vs snatching)", "Yelling", "Fighting", "Silence"], correct_answer: "Conflicting actions (throwing vs snatching)", rationale: "Dynamic conflict.", standard: "RL.8.3", difficulty: 5 },
                    { id: 'mp10', stem: "Genre classification:", options: ["Horror/Suspense", "Comedy", "Romance", "Biography"], correct_answer: "Horror/Suspense", rationale: "Genre characteristics.", standard: "RL.8.9", difficulty: 2 }
                ]
            },
            {
                id: 'lit-jackson-lottery',
                passage: "<b>The Lottery</b> by Shirley Jackson<br>The morning of June 27th was clear and sunny, with the fresh warmth of a full-summer day; the flowers were blossoming profusely and the grass was richly green. The people of the village began to gather in the square... Bobby Martin had already stuffed his pockets full of stones.",
                items: [
                    { id: 'lot1', stem: "The setting description ('clear and sunny', 'flowers') creates:", options: ["A false sense of peace/safety", "A scary mood", "A stormy mood", "A winter scene"], correct_answer: "A false sense of peace/safety", rationale: "Juxtaposition with the violence to come.", standard: "RL.8.6", difficulty: 6 },
                    { id: 'lot2', stem: "The mention of 'stones' in the first paragraph is an example of:", options: ["Foreshadowing", "Flashback", "Metaphor", "Simile"], correct_answer: "Foreshadowing", rationale: "Hints at the ending execution.", standard: "RL.8.5", difficulty: 5 },
                    { id: 'lot3', stem: "The mood shift depends on the contrast between:", options: ["The beautiful day and the dark ritual", "Boys and girls", "Summer and Winter", "Rich and poor"], correct_answer: "The beautiful day and the dark ritual", rationale: "Irony of setting.", standard: "RL.8.6", difficulty: 7 },
                    { id: 'lot4', stem: "Meaning of 'profusely':", options: ["Abundantly/In large amounts", "Rarely", "Slowly", "Red"], correct_answer: "Abundantly/In large amounts", rationale: "Vocabulary context.", standard: "L.8.4", difficulty: 5 },
                    { id: 'lot5', stem: "Theme:", options: ["Blindly following tradition can be dangerous.", "Summer is the best season.", "Lotteries are fun.", "Gardening is hard work."], correct_answer: "Blindly following tradition can be dangerous.", rationale: "Central message.", standard: "RL.8.2", difficulty: 6 },
                    { id: 'lot6', stem: "The tone of the narrator is:", options: ["Detached/Objective", "Horrified", "Angry", "Excited"], correct_answer: "Detached/Objective", rationale: "The narrator reports calmly, increasing the horror.", standard: "RL.8.6", difficulty: 8 },
                    { id: 'lot7', stem: "Why mention the specific date (June 27th)?", options: ["To ground the ritual in reality/tradition", "It is the author's birthday", "To rhyme", "No reason"], correct_answer: "To ground the ritual in reality/tradition", rationale: "Realism technique.", standard: "RL.8.4", difficulty: 4 },
                    { id: 'lot8', stem: "The boys gathering stones implies the violence is:", options: ["Normalized/Learned early", "A surprise", "An accident", "Self-defense"], correct_answer: "Normalized/Learned early", rationale: "Even children participate.", standard: "RL.8.3", difficulty: 7 },
                    { id: 'lot9', stem: "The word 'Lottery' usually suggests winning a prize. Here it means:", options: ["Selection for death", "Money", "Vacation", "Candy"], correct_answer: "Selection for death", rationale: "Situational Irony.", standard: "RL.8.6", difficulty: 3 },
                    { id: 'lot10', stem: "Conflict type:", options: ["Individual vs. Society", "Man vs. Nature", "Man vs. Self", "Man vs. Technology"], correct_answer: "Individual vs. Society", rationale: "Tessie vs the Village.", standard: "RL.8.3", difficulty: 5 }
                ]
            },
            {
                id: 'bio-strayed-wild',
                passage: "<b>Wild</b> by Cheryl Strayed<br>I gasped when I saw it. My boot... It was gone. I looked down at the river, my heart thumping... The boot was floating away, bobbing in the white water. I clutched its mate to my chest... and then I held it up and threw it too. They had to be together.",
                items: [
                    { id: 'wild1', stem: "Why did the narrator throw the second boot?", options: ["It was useless without the other.", "She was angry.", "She wanted to litter.", "She slipped."], correct_answer: "It was useless without the other.", rationale: "Pragmatic but emotional decision.", standard: "RI.8.3", difficulty: 4 },
                    { id: 'wild2', stem: "The phrase 'bobbing in the white water' emphasizes:", options: ["The helplessness of the situation", "The fun of swimming", "The cleanliness of the boot", "The weather"], correct_answer: "The helplessness of the situation", rationale: "Imagery of loss.", standard: "RI.8.4", difficulty: 5 },
                    { id: 'wild3', stem: "Narrator's reaction ('gasped', 'heart thumping') shows:", options: ["Panic/Shock", "Joy", "Boredom", "Sickness"], correct_answer: "Panic/Shock", rationale: "Physical symptoms of stress.", standard: "RI.8.3", difficulty: 3 },
                    { id: 'wild4', stem: "Theme of this excerpt:", options: ["Accepting loss and moving on", "Rivers are dangerous", "Boots are expensive", "Hiking is easy"], correct_answer: "Accepting loss and moving on", rationale: "Symbolic release.", standard: "RI.8.2", difficulty: 6 },
                    { id: 'wild5', stem: "Symbolism: Throwing the second boot represents:", options: ["Letting go of what you can't save", "giving up completely", "Hating shoes", "A game"], correct_answer: "Letting go of what you can't save", rationale: "Symbolic action.", standard: "RI.8.4", difficulty: 7 },
                    { id: 'wild6', stem: "Genre:", options: ["Memoir/Nonfiction", "Fantasy", "Science Fiction", "Myth"], correct_answer: "Memoir/Nonfiction", rationale: "First person account of real events.", standard: "RI.8.1", difficulty: 2 },
                    { id: 'wild7', stem: "Meaning of 'clutched':", options: ["Held tightly/desperately", "Dropped", "Threw", "Sold"], correct_answer: "Held tightly/desperately", rationale: "Vocabulary context.", standard: "L.8.4", difficulty: 3 },
                    { id: 'wild8', stem: "The pacing of the scene is:", options: ["Fast and urgent", "Slow and dreamy", "Boring", "Repetitive"], correct_answer: "Fast and urgent", rationale: "Short sentences, action.", standard: "RI.8.4", difficulty: 5 },
                    { id: 'wild9', stem: "The decision to throw the boot is:", options: ["Impulsive but logical", "Planned for days", "Accidental", "Funny"], correct_answer: "Impulsive but logical", rationale: "Character analysis.", standard: "RI.8.3", difficulty: 6 },
                    { id: 'wild10', stem: "What does 'mate' refer to?", options: ["The matching boot", "A friend", "A captain", "The river"], correct_answer: "The matching boot", rationale: "Context clue.", standard: "L.8.4", difficulty: 2 }
                ]
            },
            {
                id: 'lit-poe-cask',
                passage: "<b>The Cask of Amontillado</b> by Edgar Allan Poe<br>The thousand injuries of Fortunato I had borne as I best could, but when he ventured upon insult, I vowed revenge. You, who so well know the nature of my soul, will not suppose, however, that I gave utterance to a threat.",
                items: [
                    { id: 'cask1', stem: "The narrator's motivation is:", options: ["Revenge for an insult", "Money", "Jealousy of a job", "Fear"], correct_answer: "Revenge for an insult", rationale: "Explicit text: 'vowed revenge'.", standard: "RL.8.3", difficulty: 2 },
                    { id: 'cask2', stem: "The phrase 'ventured upon insult' suggests:", options: ["Fortunato crossed a line", "Fortunato visited", "Fortunato tripped", "Fortunato died"], correct_answer: "Fortunato crossed a line", rationale: "Vocabulary context.", standard: "L.8.4", difficulty: 5 },
                    { id: 'cask3', stem: "What does the narrator mean by 'gave utterance to a threat'?", options: ["He never spoke the threat aloud", "He screamed", "He wrote a letter", "He whispered"], correct_answer: "He never spoke the threat aloud", rationale: "Vocabulary (utterance).", standard: "RL.8.4", difficulty: 6 },
                    { id: 'cask4', stem: "Narrator's character:", options: ["Calculated and deceptive", "Impulsive and loud", "Forgiving", "Honest"], correct_answer: "Calculated and deceptive", rationale: "He hides his plan.", standard: "RL.8.3", difficulty: 5 },
                    { id: 'cask5', stem: "Point of View:", options: ["First-Person (Unreliable)", "Third-Person", "Omniscient", "Second-Person"], correct_answer: "First-Person (Unreliable)", rationale: "Uses 'I'; subjective view of 'injuries'.", standard: "RL.8.6", difficulty: 6 },
                    { id: 'cask6', stem: "Irony: How does the narrator likely treat Fortunato before the revenge?", options: ["Kindly/With a smile", "Meanly", "Ignoring him", "Punching him"], correct_answer: "Kindly/With a smile", rationale: "Inferred: He didn't threaten him.", standard: "RL.8.6", difficulty: 7 },
                    { id: 'cask7', stem: "Tone:", options: ["Chilling/Malicious", "Happy", "Sad", "Funny"], correct_answer: "Chilling/Malicious", rationale: "Tone analysis.", standard: "RL.8.4", difficulty: 4 },
                    { id: 'cask8', stem: "Meaning of 'borne':", options: ["Tolereated/Endured", "Born (birth)", "Carried", "Drilled"], correct_answer: "Tolereated/Endured", rationale: "Vocabulary context.", standard: "L.8.4", difficulty: 5 },
                    { id: 'cask9', stem: "Who is the 'You' the narrator addresses?", options: ["A confidant/reader", "Fortunato", "The police", "God"], correct_answer: "A confidant/reader", rationale: "'You who so well know...'", standard: "RL.8.6", difficulty: 6 },
                    { id: 'cask10', stem: "Theme:", options: ["Revenge can consume a person", "Wine is good", "Parties are fun", "Insults are funny"], correct_answer: "Revenge can consume a person", rationale: "Central theme.", standard: "RL.8.2", difficulty: 3 }
                ]
            },

            {
                id: 'boss-constitution',
                passage: "<b>BOSS LEVEL: The Preamble (Glitch in the System)</b><br>We the People of the United States, in Order to form a more perfect Union, establish Justice, insure domestic Tranquility, provide for the common defence, promote the general Welfare, and secure the Blessings of Liberty to ourselves and our Posterity, do ordain and establish this Constitution for the United States of America.",
                items: [
                    { id: 'boss1', stem: "The phrase 'form a more perfect Union' implies that:", options: ["The previous government was flawed.", "Perfection is impossible.", "Unions are expensive.", "Math is perfect."], correct_answer: "The previous government was flawed.", rationale: "Historical Context/Inference (RI.8.3).", standard: "RI.8.3", difficulty: 8 },
                    { id: 'boss2', stem: "What is the grammatical function of the capitalized words (Justice, Tranquility, Welfare)?", options: ["They are abstract concepts personified/emphasized.", "They are proper nouns (names of people).", "They are typos.", "They are verbs."], correct_answer: "They are abstract concepts personified/emphasized.", rationale: "18th Century mechanics (L.8.2).", standard: "L.8.2", difficulty: 9 },
                    { id: 'boss3', stem: "Which phrase best matches the meaning of 'domestic Tranquility'?", options: ["Peace within the country", "Quiet houses", "No wars with other countries", "Sleeping pets"], correct_answer: "Peace within the country", rationale: "Vocab/History (RI.8.4).", standard: "RI.8.4", difficulty: 7 },
                    { id: 'boss4', stem: "The word 'Posterity' means:", options: ["Future generations/Descendants", "Posters", "The past", "Rich people"], correct_answer: "Future generations/Descendants", rationale: "Advanced Vocabulary (L.8.4).", standard: "L.8.4", difficulty: 8 },
                    { id: 'boss5', stem: "Tone Analysis: The tone of this single sentence is:", options: ["Authoritative and aspiring", "Sad and lonely", "Funny and light", "Confused"], correct_answer: "Authoritative and aspiring", rationale: "Tone (RI.8.6).", standard: "RI.8.6", difficulty: 6 },
                    { id: 'boss6', stem: "Structure: The entire Preamble is one long sentence. This structure suggests:", options: ["Unity and continuous purpose.", "The author forgot periods.", "It is a list of groceries.", "Panic."], correct_answer: "Unity and continuous purpose.", rationale: "Syntax/Structure (L.8.3).", standard: "L.8.3", difficulty: 9 },
                    { id: 'boss7', stem: "The 'common defence' refers to:", options: ["Protecting the nation as a whole", "Building fences", "Self-defense classes", "Soccer goalies"], correct_answer: "Protecting the nation as a whole", rationale: "Textual Evidence (RI.8.1).", standard: "RI.8.1", difficulty: 5 },
                    { id: 'boss8', stem: "By listing 'We the People' first, the authors establish:", options: ["Popular Sovereignty (power comes from people)", "That they are people", "A greeting", "A story"], correct_answer: "Popular Sovereignty (power comes from people)", rationale: "Author's Purpose (RI.8.6).", standard: "RI.8.6", difficulty: 7 },
                    { id: 'boss9', stem: "Antonym for 'Tranquility':", options: ["Chaos/Turmoil", "Peace", "Sleep", "Water"], correct_answer: "Chaos/Turmoil", rationale: "Vocabulary (L.8.5).", standard: "L.8.5", difficulty: 6 },
                    { id: 'boss10', stem: "Central Idea:", options: [" The goals and purpose of the new government.", "War is bad.", "Liberty is a blessing.", "Writing laws is hard."], correct_answer: " The goals and purpose of the new government.", rationale: "Main Idea (RI.8.2).", standard: "RI.8.2", difficulty: 5 }
                ]
            }

        ];

const allMissions = [
            { id: 'm-confetti', title: 'The Root Cellar', description: 'RL.8.1: Confetti Girl Protocols', minLevel: 1, passageId: 'rok-lit-confetti', sticker: 'üìö' },
            { id: 'm-tortilla', title: 'The Lost Balloon', description: 'RL.8.4: Tortilla Sun Metaphors', minLevel: 1, passageId: 'rok-lit-tortilla', sticker: 'üéà' },
            { id: 'm-borer', title: 'Beetle Invasion', description: 'RI.8.5: Ash Borer Structure', minLevel: 1, passageId: 'inf-ash-borer', sticker: 'ü™≤' },
            { id: 'm-snow', title: 'Boarder Protocol', description: 'RI.8.9: Comparative Boarding', minLevel: 1, passageId: 'inf-snow-sand', sticker: 'üèÇ' },
            { id: 'm-grammar', title: 'The Editor\'s Desk', description: 'L.8.1: Grammar Gauntlet', minLevel: 1, passageId: 'lang-editor-desk', sticker: 'üìù' },
            { id: 'm-logic', title: 'Pachyderm Logic', description: 'RI.8.8: Elephant Empathy Research', minLevel: 2, passageId: 'inf-elephant-master', sticker: 'üêò' },
            { id: 'm-keys', title: 'Balabad Secrets', description: 'RL.8.3: Keeper of Keys', minLevel: 2, passageId: 'lit-balabad-matrix', sticker: 'üóùÔ∏è' },
            { id: 'm-road', title: 'Yellow Woods', description: 'RL.8.4: Poetry & Frost', minLevel: 2, passageId: 'lit-frost-road', sticker: 'üçÇ' },
            { id: 'm-vocab', title: 'The Root Lab', description: 'L.8.4: Latin & Greek Roots', minLevel: 2, passageId: 'voc-roots-lab', sticker: 'üß™' },
            { id: 'm-captain', title: 'Port of Call', description: 'RL.8.2: Whitman & Lincoln', minLevel: 3, passageId: 'lit-whitman-captain', sticker: '‚öì' },
            { id: 'm-wild', title: 'Northern Pride', description: 'RL.8.3: Call of the Wild', minLevel: 3, passageId: 'lit-london-wild', sticker: 'üêæ' },
            { id: 'm-bio', title: 'Freedom Reader', description: 'RI.8.3: Narrative Nonfiction', minLevel: 3, passageId: 'bio-douglass', sticker: 'üïØÔ∏è' },
            { id: 'm-heart', title: 'Dreadful Paces', description: 'RL.8.6: Gothic Reliability', minLevel: 4, passageId: 'lit-poe-heart', sticker: 'üíì' },
            { id: 'm-argue', title: 'The Debate Stage', description: 'RI.8.8: Argument & Claims', minLevel: 4, passageId: 'arg-school-start', sticker: '‚öñÔ∏è' },
            { id: 'm-media', title: 'Shark Signal', description: 'RI.8.7: Video vs Text', minLevel: 4, passageId: 'media-shark-week', sticker: 'ü¶à' },
            { id: 'm-compare', title: 'Myth vs. Machine', description: 'RL.8.9: Modern Prometheus', minLevel: 5, passageId: 'lit-myth-remix', sticker: '‚ö°' },
            { id: 'm-write', title: 'The Newsroom', description: 'W.8.2: Editing Strategy', minLevel: 2, passageId: 'wrt-urban-garden', sticker: 'üì∞' },
            { id: 'm-tech', title: 'Drone Manual', description: 'RI.8.5: Technical Procedures', minLevel: 3, passageId: 'tech-drone-manual', sticker: 'üöÅ' },
            { id: 'm-rhet', title: 'The Podium', description: 'L.8.5: Rhetorical Devices', minLevel: 5, passageId: 'rhet-speech-liberty', sticker: 'üéôÔ∏è' },
            { id: 'm-conflict', title: 'The Zoo Debate', description: 'RI.8.9: Conflicting Views', minLevel: 3, passageId: 'inf-conflict-zoo', sticker: 'ü¶Å' },
            { id: 'm-satire', title: 'Mystery Loaf', description: 'RL.8.6: Satire & Tone', minLevel: 3, passageId: 'lit-satire-lunch', sticker: 'ü§¢' },
            { id: 'm-punct', title: 'Code Breaker', description: 'L.8.2: Punctuation Lab', minLevel: 2, passageId: 'lang-punct-lab', sticker: 'üìü' },
            // START GAP MISSIONS PHASE 4
            { id: 'm-func', title: 'The Warranty', description: 'RI.8.5: Functional Text', minLevel: 2, passageId: 'func-warranty', sticker: 'üìú' },
            { id: 'm-idiom', title: 'Idiom Island', description: 'L.8.5: Figurative Language', minLevel: 3, passageId: 'lit-idiom-trip', sticker: 'üèùÔ∏è' },
            { id: 'm-cross', title: 'Storm Chaser', description: 'RL.8.5: Poem vs Prose', minLevel: 4, passageId: 'cross-storm-view', sticker: 'üå™Ô∏è' },
            // START POETRY MISSIONS
            { id: 'm-dickinson', title: 'Soul Perch', description: 'RL.8.2: Dickinson\'s Hope', minLevel: 2, passageId: 'lit-dickinson-hope', sticker: 'üïäÔ∏è' },
            { id: 'm-shakur', title: 'Concrete Rose', description: 'RL.8.4: Tupac\'s Symbolism', minLevel: 3, passageId: 'lit-shakur-rose', sticker: 'üåπ' },
            { id: 'm-tagore', title: 'Paper Boats', description: 'RL.8.6: Tagore\'s Voice', minLevel: 2, passageId: 'lit-tagore-boats', sticker: '‚õµ' },
            { id: 'm-silver', title: 'Garbage King', description: 'RL.8.5: Silverstein\'s Hyperbole', minLevel: 1, passageId: 'lit-silver-garbage', sticker: 'üóëÔ∏è' },

// START STORY MISSIONS
            { id: 'm-paw', title: 'Three Wishes', description: 'RL.8.3: Mood & Tension', minLevel: 2, passageId: 'lit-jacobs-paw', sticker: 'üêí' },
            { id: 'm-lottery', title: 'The Black Box', description: 'RL.8.6: Irony & Tradition', minLevel: 3, passageId: 'lit-jackson-lottery', sticker: 'ü™®' },
            { id: 'm-wild-boot', title: 'Lost Boot', description: 'RI.8.3: Memoir Resilience', minLevel: 2, passageId: 'bio-strayed-wild', sticker: 'ü•æ' },
            { id: 'm-cask', title: 'The Catacombs', description: 'RL.8.6: Unreliable Narrator', minLevel: 4, passageId: 'lit-poe-cask', sticker: 'üß±' },

            { id: 'm-boss', title: 'üî¥ SYSTEM CORE', description: 'BOSS: The Preamble', minLevel: 5, passageId: 'boss-constitution', sticker: 'üèõÔ∏è' }
            // END STORY MISSIONS

        ];

        // --- DASHBOARD & NAVIGATION ---
        function navigate(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            const target = document.getElementById(screenId);
            if(target) target.classList.remove('hidden');
            gameState.currentScreen = screenId;
            window.scrollTo(0,0);
        }

        async function showModal(title, message, type = 'info') {
            const backdrop = document.getElementById('modal-backdrop');
            const box = document.getElementById('modal-box');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').innerHTML = message;
            box.className = `bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-md w-full text-center border-t-8 border-${type === 'success' ? 'green' : (type === 'error' ? 'red' : 'blue')}-500 transition-all duration-300`;
            backdrop.classList.remove('hidden');
            return new Promise(resolve => {
                document.getElementById('modal-ok-btn').onclick = () => {
                    backdrop.classList.add('hidden');
                    resolve();
                };
            });
        }

        // --- ADAPTIVE SYSTEM ---
        function getDifficultyTag(diff) {
            if (diff <= 4) return '<span class="difficulty-tag diff-low">Foundation</span>';
            if (diff <= 7) return '<span class="difficulty-tag diff-med">Standard</span>';
            return '<span class="difficulty-tag diff-high">Legendary</span>';
        }

        function selectNextQuestion(mData) {
            const unanswered = mData.items.filter((item, index) => index >= gameState.currentQuestionIndex);
            if (unanswered.length === 0) return null;
            const targetMin = (gameState.user.elaLevel - 1) * 3 + 1;
            const targetMax = gameState.user.elaLevel * 3 + (gameState.user.elaLevel === 3 ? 2 : 0);
            let pool = unanswered.filter(q => q.difficulty >= targetMin && q.difficulty <= targetMax);
            return pool.length > 0 ? pool[0] : unanswered[0];
        }

        // --- PROFILE ---
        function renderProfile() {
            document.getElementById('profile-avatar').textContent = gameState.user.avatar;
            document.getElementById('profile-rank').textContent = gameState.user.elaLevel === 3 ? "Legend" : (gameState.user.elaLevel === 2 ? "Scholar" : "Rookie");
            document.getElementById('profile-tokens').textContent = gameState.user.tokens;
            document.getElementById('profile-level').textContent = gameState.user.level;
            
            let totalQ = 0; let totalC = 0;
            Object.values(gameState.user.standardsReport).forEach(s => { totalQ += s.total; totalC += s.correct; });
            const acc = totalQ > 0 ? Math.round((totalC / totalQ) * 100) : 0;
            document.getElementById('profile-accuracy').textContent = acc + '%';

            const grid = document.getElementById('standards-grid');
            grid.innerHTML = '';
            Object.keys(gameState.user.standardsReport).forEach(std => {
                const data = gameState.user.standardsReport[std];
                const percent = Math.round((data.correct / data.total) * 100);
                grid.innerHTML += `<div><div class="flex justify-between text-[10px] font-black mb-1 uppercase dark:text-gray-400"><span>${std}</span><span>${percent}%</span></div><div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"><div class="h-full bg-indigo-500" style="width: ${percent}%"></div></div></div>`;
            });

            const hList = document.getElementById('history-list');
            hList.innerHTML = '';
            [...gameState.user.history].reverse().forEach(h => {
                if(!h.missionTitle) return;
                hList.innerHTML += `<div class="p-3 bg-white dark:bg-gray-700 rounded-xl border border-gray-100 dark:border-gray-600 flex justify-between items-center text-sm dark:text-white"><div><span class="font-bold block">${h.missionTitle}</span><span class="text-[10px] text-gray-500">${h.date}</span></div><span class="font-black text-indigo-600">${h.score}</span></div>`;
            });
            navigate('profile-screen');
        }

        // --- SHOP ---
        function switchShopTab(tab) {
            gameState.currentShopTab = tab;
            document.querySelectorAll('#shop-screen button[id^="tab-"]').forEach(btn => {
                btn.classList.remove('shop-tab-active');
                btn.classList.add('text-gray-500');
            });
            document.getElementById(`tab-${tab}`).classList.add('shop-tab-active');
            renderShop();
        }

        function renderShop() {
            const grid = document.getElementById('shop-grid');
            grid.innerHTML = '';
            document.getElementById('shop-token-display').textContent = gameState.user.tokens;
            shopCatalog[gameState.currentShopTab].forEach(item => {
                const isOwned = (item.type === 'avatar' && gameState.user.history.some(h => h.boughtId === item.id)) || 
                               (item.type === 'sticker' && gameState.user.stickers.includes(item.icon));
                const card = document.createElement('div');
                card.className = `item-card bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-lg flex flex-col items-center text-center`;
                card.innerHTML = `<div class="text-6xl mb-6 bg-gray-50 dark:bg-gray-900 w-24 h-24 flex items-center justify-center rounded-2xl shadow-inner">${item.icon}</div><h3 class="text-xl font-bold dark:text-white mb-1 uppercase tracking-tighter">${item.name}</h3><p class="text-sm text-gray-500 mb-6 h-10">${item.description || 'Exclusive collectible.'}</p><button onclick="buyItem('${item.id}')" class="w-full button font-black py-4 rounded-2xl ${isOwned ? 'bg-gray-300 dark:bg-gray-700 text-gray-400' : 'bg-yellow-500 text-yellow-950 shadow-md'}" ${isOwned ? 'disabled' : ''}>${isOwned ? 'OWNED' : 'üí∞ ' + item.cost}</button>`;
                grid.appendChild(card);
            });
            navigate('shop-screen');
        }

async function buyItem(id) {
            const allItems = [...shopCatalog.avatars, ...shopCatalog.stickers, ...shopCatalog.items];
            const item = allItems.find(i => i.id === id);

            if(gameState.user.tokens >= item.cost) {
                // MYSTERY CRATE LOGIC
                if (item.type === 'crate') {
                    // Find stickers the user does NOT have yet
                    const unowned = shopCatalog.stickers.filter(s => s.type === 'sticker' && !gameState.user.stickers.includes(s.icon));
                    
                    if (unowned.length === 0) {
                        await showModal("Sold Out", "You have collected every single sticker! Amazing!", 'info');
                        return;
                    }

                    gameState.user.tokens -= item.cost;
                    // Pick a random prize
                    const prize = unowned[Math.floor(Math.random() * unowned.length)];
                    gameState.user.stickers.push(prize.icon);
                    
                    triggerConfetti();
                    await showModal("Mystery Crate Opened!", `You found a Rare Sticker:<br><br><span style="font-size: 4rem;">${prize.icon}</span><br><b>${prize.name}</b>`, 'success');
                }
                // STANDARD ITEM LOGIC
                else {
                    gameState.user.tokens -= item.cost;
                    if(item.type === 'avatar') { 
                        gameState.user.avatar = item.icon; 
                        gameState.user.history.push({ boughtId: item.id });
                    }
                    else if(item.type === 'sticker') { 
                        gameState.user.stickers.push(item.icon);
                    }
                    else if(item.type === 'consumable') { 
                        gameState.user.inventory[item.key]++;
                    }
                    triggerConfetti();
                    await showModal("Sync Success", `${item.name} added to protocol.`, 'success');
                }
                
                renderShop(); 
                updateUI(); 
                saveProgress();
            } else { 
                await showModal("Insufficient Funds", "Complete objectives to earn credits.", 'error');
            }
        }

        // --- MISSIONS ---
        function renderMissions() {
            const list = document.getElementById('missions-list');
            list.innerHTML = '';
            allMissions.forEach(m => {
                const isLocked = gameState.user.level < m.minLevel;
                const card = document.createElement('button');
                card.className = `p-6 rounded-3xl shadow-lg border-2 text-left ${isLocked ? 'opacity-50 border-gray-300' : 'bg-white dark:bg-gray-800 border-indigo-100 hover:border-indigo-500 transition-all'}`;
                card.innerHTML = `<div class="flex justify-between items-center mb-2"><h3 class="text-xl font-bold dark:text-white uppercase tracking-tighter">${isLocked ? 'üîí ' : ''}${m.title}</h3><span class="text-2xl">${gameState.user.stickers.includes(m.sticker) ? '‚úÖ' : ''}</span></div><p class="text-xs text-gray-500 font-medium">${m.description}</p>`;
                if (!isLocked) card.onclick = () => startMission(m.id);
                list.appendChild(card);
            });
            navigate('missions-screen');
        }

        function startMission(id) {
            gameState.currentMission = allMissions.find(m => m.id === id);
            gameState.currentQuestionIndex = 0;
            gameState.missionScore = 0;
            gameState.consecutiveCorrect = 0;
            navigate('game-play-screen');
            startTimer(); 
            renderInventory();
            renderMissionQ();
        }

        function renderMissionQ() {
            const mData = itemBank.find(i => i.id === gameState.currentMission.passageId);
            const q = selectNextQuestion(mData);
            if (!q || gameState.currentQuestionIndex >= 10) { endMission(10); return; }
            document.getElementById('game-title').textContent = gameState.currentMission.title;
            document.getElementById('mission-score-display').textContent = gameState.missionScore;
            document.getElementById('game-passage').innerHTML = `<div class="dark:text-white"><b class="uppercase tracking-widest text-indigo-500 text-[10px]">Reference Matrix:</b><br>${mData.passage}</div>`;
            document.getElementById('game-questions-area').innerHTML = `<div class="flex justify-between items-center mb-4"><p class="text-[10px] font-black uppercase text-gray-400">Standard: ${q.standard}</p>${getDifficultyTag(q.difficulty)}</div><p class="font-bold text-lg mb-6 dark:text-white">${q.stem}</p><div class="space-y-3">${q.options.map(o => `<label class="flex items-center p-4 border rounded-xl bg-white dark:bg-gray-700 cursor-pointer transition-all hover:bg-gray-50"><input type="radio" name="mq" value="${o}" class="mr-3 w-5 h-5"> <span class="dark:text-white">${o}</span></label>`).join('')}</div><button onclick="checkMQ()" class="w-full mt-8 bg-indigo-600 text-white font-black py-4 rounded-2xl shadow-lg uppercase tracking-widest hover:bg-indigo-700 transition-all">Submit Protocol</button>`;
        }

        async function checkMQ() {
            const sel = document.querySelector('input[name="mq"]:checked');
            if (!sel) return;
            const mData = itemBank.find(i => i.id === gameState.currentMission.passageId);
            const q = selectNextQuestion(mData);
            const isCorrect = sel.value === q.correct_answer;
            if(!gameState.user.standardsReport[q.standard]) gameState.user.standardsReport[q.standard] = { correct: 0, total: 0 };
            gameState.user.standardsReport[q.standard].total++;
            if(isCorrect) gameState.user.standardsReport[q.standard].correct++;
            if (isCorrect) {
                gameState.missionScore++; gameState.consecutiveCorrect++;
                if(gameState.consecutiveCorrect >= 3 && gameState.user.elaLevel < 3) {
                    gameState.user.elaLevel++; gameState.consecutiveCorrect = 0;
                    triggerConfetti(); await showModal("SYNC OVERDRIVE", "Rank Up! Intelligence evolved.", 'success');
                } else { await showModal("Verified", q.rationale, 'success'); }
            } else {
                gameState.consecutiveCorrect = 0;
                if(q.difficulty <= 4 && gameState.user.elaLevel > 1) {
                    gameState.user.elaLevel--; await showModal("Recalibration", "Efficiency drop detected. Rank reduced.", 'info');
                }
                gameState.user.missedQuestions.push(q); await showModal("Logic Conflict", q.rationale, 'error');
            }
            gameState.currentQuestionIndex++; renderMissionQ();
        }

        async function endMission(total) {
            const xp = Math.round((gameState.missionScore / total) * 100);
            gameState.user.tokens += gameState.missionScore * 25;
            addXp(xp);
            gameState.user.history.push({ missionTitle: gameState.currentMission.title, score: `${gameState.missionScore}/${total}`, date: new Date().toLocaleDateString() });
            if(gameState.missionScore === total && !gameState.user.stickers.includes(gameState.currentMission.sticker)) {
                gameState.user.stickers.push(gameState.currentMission.sticker);
                triggerConfetti(); await showModal("SYNCHRONIZED", `S-Rank achieved! Earned: ${gameState.currentMission.sticker}`, 'success');
            }
            saveProgress(); updateUI();
            await showModal("Mission End", `Rewards: +${xp} XP | +${gameState.missionScore * 25} Tokens`, 'success');
            navigate('welcome-screen');
        }

        // --- UTILS ---
function startCalibration() {
            // FIX: Use 3 diverse existing passages for the diagnostic
            const diagnosticIds = ['inf-ash-borer', 'rok-lit-confetti', 'lang-editor-desk'];
            
            calProg = { 
                questions: itemBank.filter(i => diagnosticIds.includes(i.id)), 
                idx: 0, 
                score: 0 
            };
            
            document.getElementById('calibration-content').classList.remove('hidden');
            document.getElementById('calibration-results').classList.add('hidden');
            navigate('calibration-screen');
            renderCal();
        }

        function renderCal() {
            const qSet = calProg.questions[calProg.idx];
            if (!qSet) { endCal(); return; }
            const q = qSet.items[0];
            document.getElementById('question-area').innerHTML = `<div class="mb-6 bg-blue-50 dark:bg-gray-700 p-6 rounded-2xl border-l-8 border-blue-500"><p class="italic font-serif dark:text-white text-sm">${qSet.passage}</p></div><p class="text-xl font-bold mb-6 dark:text-white">${q.stem}</p><div class="space-y-3">${q.options.map(o => `<label class="flex items-center p-4 border-2 rounded-xl bg-white dark:bg-gray-900 cursor-pointer hover:border-blue-500 transition-all"><input type="radio" name="cal" value="${o}" class="mr-3 w-5 h-5"> <span class="font-medium dark:text-white">${o}</span></label>`).join('')}</div>`;
        }

        async function submitCal() {
            const sel = document.querySelector('input[name="cal"]:checked');
            if (!sel) return;
            const qSet = calProg.questions[calProg.idx];
            if (sel.value === qSet.items[0].correct_answer) { calProg.score += qSet.items[0].difficulty; }
            calProg.idx++; renderCal();
        }

        function endCal() {
            const s = calProg.score;
            gameState.user.elaLevel = s >= 12 ? 3 : (s >= 6 ? 2 : 1);
            document.getElementById('ela-level-display').textContent = gameState.user.elaLevel === 3 ? "Legend" : (gameState.user.elaLevel === 2 ? "Scholar" : "Rookie");
            document.getElementById('calibration-content').classList.add('hidden');
            document.getElementById('calibration-results').classList.remove('hidden');
            saveProgress(); updateUI();
        }

        function startSurvival() {
            gameState.survivalQueue = itemBank.flatMap(i => i.items.map(it => ({...it, passage: i.passage}))).sort(() => Math.random() - 0.5);
            gameState.currentQuestionIndex = 0; gameState.missionScore = 0;
            navigate('game-play-screen'); renderSurvivalQ();
        }

        function renderSurvivalQ() {
            const q = gameState.survivalQueue[gameState.currentQuestionIndex];
            if (!q) { navigate('welcome-screen'); return; }
            document.getElementById('game-title').innerHTML = `<span class="text-red-600 font-black">üíÄ GAUNTLET MODE</span>`;
            document.getElementById('game-passage').innerHTML = `<div class="dark:text-white">${q.passage}</div>`;
            document.getElementById('game-questions-area').innerHTML = `<p class="font-bold mb-6 dark:text-white text-xl">${q.stem}</p><div class="space-y-3">${q.options.map(o => `<button onclick="checkSQ('${o.replace(/'/g, "\\'")}')" class="w-full text-left p-4 border-2 rounded-2xl bg-white dark:bg-gray-700 dark:text-white font-bold hover:border-red-500 transition-all uppercase tracking-tighter text-sm">${o}</button>`).join('')}</div>`;
        }

        async function checkSQ(ans) {
            const q = gameState.survivalQueue[gameState.currentQuestionIndex];
            if (ans === q.correct_answer) {
                gameState.missionScore++; gameState.currentQuestionIndex++;
                await showModal("Threat Neutralized", "Deep scanning next query...", 'success'); renderSurvivalQ();
            } else {
                if(gameState.user.inventory.shield > 0) {
                    gameState.user.inventory.shield--; updateUI();
                    await showModal("Shield Active", "The logic spike was absorbed.", "success"); renderSurvivalQ();
                } else {
                    await showModal("CRITICAL ERROR", `Correct: ${q.correct_answer}`, 'error'); navigate('welcome-screen');
                }
            }
        }

function renderStickerBook() {
            const grid = document.getElementById('sticker-grid');
            grid.innerHTML = '';
            // Increased to 50 slots to accommodate the full collection
            for(let i=0; i<50; i++) {
                const s = gameState.user.stickers[i];
                const card = document.createElement('div');
                card.className = `sticker-card aspect-square rounded-2xl flex items-center justify-center text-5xl shadow-inner border-2 transition-all duration-300 ${s ?
                'bg-white dark:bg-gray-800 border-indigo-400 shadow-xl scale-100' : 'bg-white/10 border-dashed border-gray-400 opacity-20 scale-95'}`;
                card.innerHTML = s || '';
                
                if(s) card.title = "Collected!";
                
                grid.appendChild(card);
            }
            navigate('sticker-book-screen');
        }

        function renderInventory() {
            const bar = document.getElementById('inventory-bar');
            bar.innerHTML = '';
            const inv = gameState.user.inventory;
            if(inv.lens > 0) bar.innerHTML += `<button onclick="useLens()" class="bg-blue-600 text-white px-3 py-2 rounded-xl flex items-center gap-2 font-bold shadow-lg h-10 text-[10px]">üîç Lens (${inv.lens})</button>`;
            if(inv.freezer > 0) bar.innerHTML += `<button onclick="useFreezer()" class="bg-cyan-500 text-white px-3 py-2 rounded-xl flex items-center gap-2 font-bold shadow-lg h-10 text-[10px]">‚ùÑÔ∏è Reset (${inv.freezer})</button>`;
        }

        function useLens() {
            const options = document.querySelectorAll('input[name="mq"]');
            const mData = itemBank.find(i => i.id === gameState.currentMission.passageId);
            const q = selectNextQuestion(mData);
            let found = false;
            options.forEach(opt => {
                if(!found && opt.value !== q.correct_answer && !opt.parentElement.classList.contains('opacity-20')) {
                    opt.parentElement.classList.add('opacity-20', 'pointer-events-none');
                    found = true;
                }
            });
            if(found) { gameState.user.inventory.lens--; updateUI(); renderInventory(); }
        }

        function useFreezer() { gameState.user.inventory.freezer--; startTimer(); updateUI(); renderInventory(); showModal("Freezer Active", "Timer reset.", "success"); }
        function addXp(amt) { gameState.user.xp += amt; while(gameState.user.xp >= 100) { gameState.user.xp -= 100; gameState.user.level++; } updateUI(); }
        
        function updateUI() {
            document.getElementById('player-avatar').textContent = gameState.user.avatar;
            document.getElementById('main-level-display').textContent = gameState.user.level;
            document.getElementById('main-xp-current').textContent = gameState.user.xp;
            document.getElementById('main-xp-bar').style.width = gameState.user.xp + '%';
            document.getElementById('main-token-display').textContent = gameState.user.tokens;
            const shopT = document.getElementById('shop-token-display'); if(shopT) shopT.textContent = gameState.user.tokens;
        }

        let timerInt;
        function startTimer() {
            let s = 0; const d = document.getElementById('game-timer'); clearInterval(timerInt);
            timerInt = setInterval(() => { s++; const m = Math.floor(s/60).toString().padStart(2, '0'); const sc = (s%60).toString().padStart(2, '0'); d.textContent = `${m}:${sc}`; }, 1000);
        }

        function saveProgress() { localStorage.setItem('elaLegendsSaveV9', JSON.stringify(gameState.user)); }
        function loadProgress() { const saved = localStorage.getItem('elaLegendsSaveV9'); if (saved) gameState.user = JSON.parse(saved); updateUI(); }
        function openArchive() {
            const l = document.getElementById('archive-list'); const msg = document.getElementById('archive-empty-msg'); l.innerHTML = '';
            if (gameState.user.missedQuestions.length === 0) msg.classList.remove('hidden');
            else {
                msg.classList.add('hidden');
                gameState.user.missedQuestions.forEach((q, idx) => {
                    const c = document.createElement('div');
                    c.className = "bg-white p-6 rounded-3xl border-l-8 border-red-500 shadow-md";
                    c.innerHTML = `<p class="font-bold mb-4 dark:text-white uppercase tracking-tighter">${q.stem}</p><div class="space-y-2">${q.options.map(o => `<button onclick="fixGlitch(${idx}, '${o.replace(/'/g, "\\'")}')" class="w-full text-left p-3 border-2 rounded-xl hover:bg-gray-100 font-bold">${o}</button>`).join('')}</div>`;
                    l.appendChild(c);
                });
            }
            navigate('archive-screen');
        }

        async function fixGlitch(idx, ans) {
            const q = gameState.user.missedQuestions[idx];
            if (ans === q.correct_answer) { gameState.user.missedQuestions.splice(idx, 1); addXp(20); await showModal("Integrity Restored", "Data anomaly repaired.", 'success'); openArchive(); }
            else { await showModal("Repair Failed", "Incorrect logic. Glitch persistent.", 'error'); }
        }

        function triggerConfetti() { confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } }); }
        function resetGame() { if(confirm('Erase all protocol data?')) { localStorage.removeItem('elaLegendsSaveV9'); location.reload(); } }

        function generateReport() {
            const d = new Date().toLocaleDateString();
            const rank = gameState.user.elaLevel === 3 ? "Legend" : (gameState.user.elaLevel === 2 ? "Scholar" : "Rookie");
            const win = window.open('', '_blank');
            let totalQ = 0; let totalC = 0;
            Object.values(gameState.user.standardsReport).forEach(s => { totalQ += s.total; totalC += s.correct; });
            const acc = totalQ > 0 ? Math.round((totalC / totalQ) * 100) : 0;
            win.document.write(`<html><body style="font-family:sans-serif; padding:40px; color:#333;"><h1 style="color:#4f46e5;">ELA Legends Mastery Matrix</h1><p><b>Date:</b> ${d}</p><p><b>Level:</b> ${gameState.user.level} | <b>Rank:</b> ${rank}</p><p><b>Accuracy:</b> ${acc}%</p><hr><h2>Standards Mastery</h2><ul>${Object.keys(gameState.user.standardsReport).map(std => { const s = gameState.user.standardsReport[std]; return `<li><b>${std}:</b> ${Math.round((s.correct/s.total)*100)}% (${s.correct}/${s.total})</li>`; }).join('')}</ul><hr><h2>History</h2><ul>${gameState.user.history.map(h => `<li>${h.date}: ${h.missionTitle} - ${h.score}</li>`).join('')}</ul></body></html>`);
            win.document.close(); win.print();
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadProgress();
            document.querySelectorAll('.home-button').forEach(b => b.onclick = () => { clearInterval(timerInt); navigate('welcome-screen'); });
            document.getElementById('start-calibration-button').onclick = startCalibration;
            document.getElementById('submit-answer-button').onclick = submitCal;
            document.getElementById('start-missions-button').onclick = renderMissions;
            document.getElementById('missions-button').onclick = renderMissions;
            document.getElementById('progress-button').onclick = renderStickerBook;
            document.getElementById('shop-button').onclick = renderShop;
            document.getElementById('profile-button').onclick = renderProfile;
        });
    </script>
</body>
</html>